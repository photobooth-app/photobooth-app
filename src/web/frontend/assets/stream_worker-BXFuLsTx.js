(function(){"use strict";function Lt(t){const e=Object.create(null);for(const n of t.split(","))e[n]=1;return n=>n in e}const Ut=Object.assign,zt=Object.prototype.hasOwnProperty,it=(t,e)=>zt.call(t,e),N=Array.isArray,Z=t=>It(t)==="[object Map]",$t=t=>typeof t=="function",Gt=t=>typeof t=="string",q=t=>typeof t=="symbol",L=t=>t!==null&&typeof t=="object",Vt=Object.prototype.toString,It=t=>Vt.call(t),Jt=t=>It(t).slice(8,-1),ct=t=>Gt(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,U=(t,e)=>!Object.is(t,e);let Qt,Mt=0,lt;function ft(){Mt++}function ut(){if(--Mt>0)return;let t;for(;lt;){let e=lt;for(lt=void 0;e;){const n=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(s){t||(t=s)}e=n}}if(t)throw t}let k=!0;const St=[];function Zt(){St.push(k),k=!1}function kt(){const t=St.pop();k=t===void 0?!0:t}class Tt{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){}trigger(e){this.version++,this.notify(e)}notify(e){ft();try{for(let n=this.subs;n;n=n.prevSub)n.sub.notify()&&n.sub.dep.notify()}finally{ut()}}}const ht=new WeakMap,K=Symbol(""),dt=Symbol(""),z=Symbol("");function b(t,e,n){if(k&&Qt){let s=ht.get(t);s||ht.set(t,s=new Map);let r=s.get(n);r||(s.set(n,r=new Tt),r.map=s,r.key=n),r.track()}}function D(t,e,n,s,r,o){const a=ht.get(t);if(!a)return;const i=c=>{c&&c.trigger()};if(ft(),e==="clear")a.forEach(i);else{const c=N(t),l=c&&ct(n);if(c&&n==="length"){const u=Number(s);a.forEach((f,h)=>{(h==="length"||h===z||!q(h)&&h>=u)&&i(f)})}else switch((n!==void 0||a.has(void 0))&&i(a.get(n)),l&&i(a.get(z)),e){case"add":c?l&&i(a.get("length")):(i(a.get(K)),Z(t)&&i(a.get(dt)));break;case"delete":c||(i(a.get(K)),Z(t)&&i(a.get(dt)));break;case"set":Z(t)&&i(a.get(K));break}}ut()}function H(t){const e=d(t);return e===t?e:(b(e,"iterate",z),E(t)?e:e.map(B))}function pt(t){return b(t=d(t),"iterate",z),t}function j(t,e){return F(t)?Wt(t)?G(B(e)):G(e):B(e)}const te={__proto__:null,[Symbol.iterator](){return wt(this,Symbol.iterator,t=>j(this,t))},concat(...t){return H(this).concat(...t.map(e=>N(e)?H(e):e))},entries(){return wt(this,"entries",t=>(t[1]=j(this,t[1]),t))},every(t,e){return O(this,"every",t,e,void 0,arguments)},filter(t,e){return O(this,"filter",t,e,n=>n.map(s=>j(this,s)),arguments)},find(t,e){return O(this,"find",t,e,n=>j(this,n),arguments)},findIndex(t,e){return O(this,"findIndex",t,e,void 0,arguments)},findLast(t,e){return O(this,"findLast",t,e,n=>j(this,n),arguments)},findLastIndex(t,e){return O(this,"findLastIndex",t,e,void 0,arguments)},forEach(t,e){return O(this,"forEach",t,e,void 0,arguments)},includes(...t){return mt(this,"includes",t)},indexOf(...t){return mt(this,"indexOf",t)},join(t){return H(this).join(t)},lastIndexOf(...t){return mt(this,"lastIndexOf",t)},map(t,e){return O(this,"map",t,e,void 0,arguments)},pop(){return $(this,"pop")},push(...t){return $(this,"push",t)},reduce(t,...e){return Ot(this,"reduce",t,e)},reduceRight(t,...e){return Ot(this,"reduceRight",t,e)},shift(){return $(this,"shift")},some(t,e){return O(this,"some",t,e,void 0,arguments)},splice(...t){return $(this,"splice",t)},toReversed(){return H(this).toReversed()},toSorted(t){return H(this).toSorted(t)},toSpliced(...t){return H(this).toSpliced(...t)},unshift(...t){return $(this,"unshift",t)},values(){return wt(this,"values",t=>j(this,t))}};function wt(t,e,n){const s=pt(t),r=s[e]();return s!==t&&!E(t)&&(r._next=r.next,r.next=()=>{const o=r._next();return o.done||(o.value=n(o.value)),o}),r}const ee=Array.prototype;function O(t,e,n,s,r,o){const a=pt(t),i=a!==t&&!E(t),c=a[e];if(c!==ee[e]){const f=c.apply(t,o);return i?B(f):f}let l=n;a!==t&&(i?l=function(f,h){return n.call(this,j(t,f),h,t)}:n.length>2&&(l=function(f,h){return n.call(this,f,h,t)}));const u=c.call(a,l,s);return i&&r?r(u):u}function Ot(t,e,n,s){const r=pt(t);let o=n;return r!==t&&(E(t)?n.length>3&&(o=function(a,i,c){return n.call(this,a,i,c,t)}):o=function(a,i,c){return n.call(this,a,j(t,i),c,t)}),r[e](o,...s)}function mt(t,e,n){const s=d(t);b(s,"iterate",z);const r=s[e](...n);return(r===-1||r===!1)&&me(n[0])?(n[0]=d(n[0]),s[e](...n)):r}function $(t,e,n=[]){Zt(),ft();const s=d(t)[e].apply(t,n);return ut(),kt(),s}const ne=Lt("__proto__,__v_isRef,__isVue"),Bt=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(q));function re(t){q(t)||(t=String(t));const e=d(this);return b(e,"has",t),e.hasOwnProperty(t)}class Ct{constructor(e=!1,n=!1){this._isReadonly=e,this._isShallow=n}get(e,n,s){if(n==="__v_skip")return e.__v_skip;const r=this._isReadonly,o=this._isShallow;if(n==="__v_isReactive")return!r;if(n==="__v_isReadonly")return r;if(n==="__v_isShallow")return o;if(n==="__v_raw")return s===(r?o?de:jt:o?he:Dt).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(s)?e:void 0;const a=N(e);if(!r){let c;if(a&&(c=te[n]))return c;if(n==="hasOwnProperty")return re}const i=Reflect.get(e,n,W(e)?e:s);if((q(n)?Bt.has(n):ne(n))||(r||b(e,"get",n),o))return i;if(W(i)){const c=a&&ct(n)?i:i.value;return r&&L(c)?_t(c):c}return L(i)?r?_t(i):Ft(i):i}}class oe extends Ct{constructor(e=!1){super(!1,e)}set(e,n,s,r){let o=e[n];const a=N(e)&&ct(n);if(!this._isShallow){const l=F(o);if(!E(s)&&!F(s)&&(o=d(o),s=d(s)),!a&&W(o)&&!W(s))return l||(o.value=s),!0}const i=a?Number(n)<e.length:it(e,n),c=Reflect.set(e,n,s,W(e)?e:r);return e===d(r)&&(i?U(s,o)&&D(e,"set",n,s):D(e,"add",n,s)),c}deleteProperty(e,n){const s=it(e,n);e[n];const r=Reflect.deleteProperty(e,n);return r&&s&&D(e,"delete",n,void 0),r}has(e,n){const s=Reflect.has(e,n);return(!q(n)||!Bt.has(n))&&b(e,"has",n),s}ownKeys(e){return b(e,"iterate",N(e)?"length":K),Reflect.ownKeys(e)}}class se extends Ct{constructor(e=!1){super(!0,e)}set(e,n){return!0}deleteProperty(e,n){return!0}}const ae=new oe,ie=new se,gt=t=>t,tt=t=>Reflect.getPrototypeOf(t);function ce(t,e,n){return function(...s){const r=this.__v_raw,o=d(r),a=Z(o),i=t==="entries"||t===Symbol.iterator&&a,c=t==="keys"&&a,l=r[t](...s),u=n?gt:e?G:B;return!e&&b(o,"iterate",c?dt:K),{next(){const{value:f,done:h}=l.next();return h?{value:f,done:h}:{value:i?[u(f[0]),u(f[1])]:u(f),done:h}},[Symbol.iterator](){return this}}}}function et(t){return function(...e){return t==="delete"?!1:t==="clear"?void 0:this}}function le(t,e){const n={get(r){const o=this.__v_raw,a=d(o),i=d(r);t||(U(r,i)&&b(a,"get",r),b(a,"get",i));const{has:c}=tt(a),l=e?gt:t?G:B;if(c.call(a,r))return l(o.get(r));if(c.call(a,i))return l(o.get(i));o!==a&&o.get(r)},get size(){const r=this.__v_raw;return!t&&b(d(r),"iterate",K),r.size},has(r){const o=this.__v_raw,a=d(o),i=d(r);return t||(U(r,i)&&b(a,"has",r),b(a,"has",i)),r===i?o.has(r):o.has(r)||o.has(i)},forEach(r,o){const a=this,i=a.__v_raw,c=d(i),l=e?gt:t?G:B;return!t&&b(c,"iterate",K),i.forEach((u,f)=>r.call(o,l(u),l(f),a))}};return Ut(n,t?{add:et("add"),set:et("set"),delete:et("delete"),clear:et("clear")}:{add(r){!e&&!E(r)&&!F(r)&&(r=d(r));const o=d(this);return tt(o).has.call(o,r)||(o.add(r),D(o,"add",r,r)),this},set(r,o){!e&&!E(o)&&!F(o)&&(o=d(o));const a=d(this),{has:i,get:c}=tt(a);let l=i.call(a,r);l||(r=d(r),l=i.call(a,r));const u=c.call(a,r);return a.set(r,o),l?U(o,u)&&D(a,"set",r,o):D(a,"add",r,o),this},delete(r){const o=d(this),{has:a,get:i}=tt(o);let c=a.call(o,r);c||(r=d(r),c=a.call(o,r)),i&&i.call(o,r);const l=o.delete(r);return c&&D(o,"delete",r,void 0),l},clear(){const r=d(this),o=r.size!==0,a=r.clear();return o&&D(r,"clear",void 0,void 0),a}}),["keys","values","entries",Symbol.iterator].forEach(r=>{n[r]=ce(r,t,e)}),n}function Pt(t,e){const n=le(t,e);return(s,r,o)=>r==="__v_isReactive"?!t:r==="__v_isReadonly"?t:r==="__v_raw"?s:Reflect.get(it(n,r)&&r in s?n:s,r,o)}const fe={get:Pt(!1,!1)},ue={get:Pt(!0,!1)},Dt=new WeakMap,he=new WeakMap,jt=new WeakMap,de=new WeakMap;function pe(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function we(t){return t.__v_skip||!Object.isExtensible(t)?0:pe(Jt(t))}function Ft(t){return F(t)?t:Et(t,!1,ae,fe,Dt)}function _t(t){return Et(t,!0,ie,ue,jt)}function Et(t,e,n,s,r){if(!L(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const o=we(t);if(o===0)return t;const a=r.get(t);if(a)return a;const i=new Proxy(t,o===2?s:n);return r.set(t,i),i}function Wt(t){return F(t)?Wt(t.__v_raw):!!(t&&t.__v_isReactive)}function F(t){return!!(t&&t.__v_isReadonly)}function E(t){return!!(t&&t.__v_isShallow)}function me(t){return t?!!t.__v_raw:!1}function d(t){const e=t&&t.__v_raw;return e?d(e):t}const B=t=>L(t)?Ft(t):t,G=t=>L(t)?_t(t):t;function W(t){return t?t.__v_isRef===!0:!1}function ge(t){return _e(t,!1)}function _e(t,e){return W(t)?t:new xe(t,e)}class xe{constructor(e,n){this.dep=new Tt,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=n?e:d(e),this._value=n?e:B(e),this.__v_isShallow=n}get value(){return this.dep.track(),this._value}set value(e){const n=this._rawValue,s=this.__v_isShallow||E(e)||F(e);e=s?e:d(e),U(e,n)&&(this._rawValue=e,this._value=s?e:B(e),this.dep.trigger())}}function ye(t){return W(t)?t.value:t}function ve(t){return $t(t)?t():ye(t)}typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const Yt=()=>{};function be(t,e){function n(...s){return new Promise((r,o)=>{Promise.resolve(t(()=>e.apply(this,s),{fn:e,thisArg:this,args:s})).then(r).catch(o)})}return n}function Re(...t){let e=0,n,s=!0,r=Yt,o,a,i,c,l;!W(t[0])&&typeof t[0]=="object"?{delay:a,trailing:i=!0,leading:c=!0,rejectOnCancel:l=!1}=t[0]:[a,i=!0,c=!0,l=!1]=t;const u=()=>{n&&(clearTimeout(n),n=void 0,r(),r=Yt)};return h=>{const w=ve(a),p=Date.now()-e,m=()=>o=h();return u(),w<=0?(e=Date.now(),m()):(p>w?(e=Date.now(),(c||!s)&&m()):i&&(o=new Promise((_,y)=>{r=l?y:_,n=setTimeout(()=>{e=Date.now(),s=!0,_(m()),u()},Math.max(0,w-p))})),!c&&!n&&(n=setTimeout(()=>s=!0,w)),s=!1,o)}}function Ie(t,e=200,n=!1,s=!0,r=!1){return be(Re(e,n,s,r),t)}let xt,yt,At,Kt,V=null;const Xt=ge(500);let nt=null,R=null,T=null,vt=0,bt=0,Rt=0,Ht=performance.now(),J=[];self.onmessage=async t=>{t.data.type==="init"?(xt=t.data.canvases.stream,yt=t.data.canvases.blurred,At=xt.getContext("2d",{alpha:!0}),Kt=yt.getContext("2d",{alpha:!0}),Xt.value=t.data.blurredbackgroundHighFramerate===!0?50:300):t.data.type==="frame"?(V&&Rt++,V=t.data.payload,Se()):t.data.type==="overlay"&&(nt=t.data.url,console.log(nt),nt?Te(nt):R=null)};const Nt=(t,e,n)=>{const s=R?R.width:n.width,r=R?R.height:n.height;if((t.width!==s||t.height!==r)&&(t.width=s,t.height=r,console.log(`set canvas size to ${s}x${r}`)),R&&T){const{drawW:o,drawH:a,offsetX:i,offsetY:c}=Oe(n.width,n.height,T.w,T.h);e.drawImage(n,T.x+i,T.y+c,o,a),e.drawImage(R,0,0),e.strokeStyle="red",e.lineWidth=2,e.strokeRect(T.x,T.y,T.w,T.h)}else e.drawImage(n,0,0)},Me=Ie((t,e,n)=>{Nt(t,e,n),bt++},Xt);async function Se(){if(!V)return;const t=V;try{const e=performance.now(),n=new Blob([t],{type:"image/jpeg"}),s=await createImageBitmap(n);Nt(xt,At,s),vt++,Me(yt,Kt,s),s.close();const r=performance.now();J.push(r-e)}catch(e){console.error(e),console.error("Decode error:",e)}finally{V=null,Fe()}}async function Te(t){const e=performance.now();let n,s,r,o,a,i;try{const u=await(await fetch(t)).blob();R=await createImageBitmap(u),n=performance.now();const f=await Be(R);s=performance.now();const h=await Ce(R);r=performance.now();const w=await Pe(R);o=performance.now();const p=await De(R);a=performance.now();const m=await je(R);i=performance.now(),console.warn("computeTransparentBoundingBoxSimple area",f,"took ",(s-n).toFixed(1)),console.warn("computeTransparentBoundingBoxU32 area",h,"took ",(r-s).toFixed(1)),console.warn("computeTransparentBoundingBoxScaleRefine area",w,"took ",(o-r).toFixed(1)),console.warn("computeTransparentBoundingBoxScaleRefine2 area",p,"took ",(a-o).toFixed(1)),console.warn("computeTransparentBoundingBoxScaleNorefine area",m,"took ",(i-a).toFixed(1)),T=m}catch(l){console.error("Overlay load error:",l),R=null}const c=performance.now();console.log("load overlay took ",(n-e).toFixed(1),"ms and calc transparency took ",(c-n).toFixed(1),"ms")}function Oe(t,e,n,s){const r=Math.max(n/t,s/e),o=t*r,a=e*r,i=(n-o)/2,c=(s-a)/2;return{drawW:o,drawH:a,offsetX:i,offsetY:c}}async function Be(t){const n=new OffscreenCanvas(t.width,t.height).getContext("2d",{willReadFrequently:!0});n.drawImage(t,0,0);const s=n.getImageData(0,0,t.width,t.height).data;let r=t.width,o=t.height,a=0,i=0;for(let c=0;c<t.height;c++)for(let l=0;l<t.width;l++)s[(c*t.width+l)*4+3]<128&&(r=Math.min(r,l),o=Math.min(o,c),a=Math.max(a,l),i=Math.max(i,c));return{x:r,y:o,w:a-r+1,h:i-o+1}}async function Ce(t){const{width:e,height:n}=t,r=new OffscreenCanvas(e,n).getContext("2d",{willReadFrequently:!0});r.drawImage(t,0,0);const o=r.getImageData(0,0,e,n).data,a=new Uint32Array(o.buffer);let i=e,c=n,l=-1,u=-1;for(let f=0;f<n;f++)for(let h=0;h<e;h++)(a[f*e+h]>>>24&255)<128&&(h<i&&(i=h),f<c&&(c=f),h>l&&(l=h),f>u&&(u=f));return{x:i,y:c,w:l-i+1,h:u-c+1}}async function Pe(t,e=4,n=10){const{width:s,height:r}=t,o=Math.ceil(s/e),a=Math.ceil(r/e),c=new OffscreenCanvas(o,a).getContext("2d",{willReadFrequently:!0});c.drawImage(t,0,0,o,a);const l=c.getImageData(0,0,o,a).data;let u=o,f=a,h=-1,w=-1;for(let g=0;g<a;g++)for(let v=0;v<o;v++)l[(g*o+v)*4+3]<128&&(v<u&&(u=v),g<f&&(f=g),v>h&&(h=v),g>w&&(w=g));const p=u*e,m=f*e,_=(h-u+1)*e,y=(w-f+1)*e,Y=new OffscreenCanvas(s,r).getContext("2d",{willReadFrequently:!0});Y.drawImage(t,0,0);function X(g,v,C,Q,P){const at=Y.getImageData(g,v,C,Q).data;let x=P==="top"||P==="left"?1/0:-1/0;if(P==="top"||P==="bottom"){for(let I=0;I<Q;I++)for(let M=0;M<C;M++)if(at[(I*C+M)*4+3]<128){const A=v+I;P==="top"?x=Math.min(x,A):x=Math.max(x,A)}}else for(let I=0;I<Q;I++)for(let M=0;M<C;M++)if(at[(I*C+M)*4+3]<128){const A=g+M;P==="left"?x=Math.min(x,A):x=Math.max(x,A)}return x===1/0||x===-1/0?null:x}const rt=X(p,Math.max(0,m-n),_,n*2,"top"),ot=X(p,Math.min(r-n,m+y-n),_,n*2,"bottom"),st=X(Math.max(0,p-n),m,n*2,y,"left"),S=X(Math.min(s-n,p+_-n),m,n*2,y,"right");return{x:st??p,y:rt??m,w:(S??p+_)-(st??p)+1,h:(ot??m+y)-(rt??m)+1}}async function De(t,e=8,n=50){const{width:s,height:r}=t,o=Math.ceil(s/e),a=Math.ceil(r/e),i=new OffscreenCanvas(o,a).getContext("2d",{willReadFrequently:!0});i.drawImage(t,0,0,o,a);const c=i.getImageData(0,0,o,a).data;let l=o,u=a,f=-1,h=-1;for(let S=0;S<a;S++)for(let g=0;g<o;g++)c[(S*o+g)*4+3]<128&&(g<l&&(l=g),S<u&&(u=S),g>f&&(f=g),S>h&&(h=S));const w=l*e,p=u*e,m=(f-l+1)*e,_=(h-u+1)*e,y=new OffscreenCanvas(s,r).getContext("2d",{willReadFrequently:!0});y.drawImage(t,0,0);function Y(S,g,v,C,Q,P){const at=y.getImageData(S,g,v,C).data;let x=P==="min"?1/0:-1/0;for(let I=0;I<C;I++)for(let M=0;M<v;M++)if(at[(I*v+M)*4+3]<128){const A=Q==="y"?g+I:S+M;x=P==="min"?Math.min(x,A):Math.max(x,A)}return x===1/0||x===-1/0?null:x}const X=Y(w,Math.max(0,p-n),m,n*2,"y","min"),rt=Y(w,Math.min(r-n,p+_-n),m,n*2,"y","max"),ot=Y(Math.max(0,w-n),p,n*2,_,"x","min"),st=Y(Math.min(s-n,w+m-n),p,n*2,_,"x","max");return{x:ot??w,y:X??p,w:(st??w+m)-(ot??w)+1,h:(rt??p+_)-(X??p)+1}}async function je(t,e=4){const{width:n,height:s}=t,r=Math.ceil(n/e),o=Math.ceil(s/e),a=new OffscreenCanvas(r,o).getContext("2d",{willReadFrequently:!0});a.drawImage(t,0,0,r,o);const i=a.getImageData(0,0,r,o).data;let c=r,l=o,u=-1,f=-1;for(let _=0;_<o;_++)for(let y=0;y<r;y++)i[(_*r+y)*4+3]<128&&(y<c&&(c=y),_<l&&(l=_),y>u&&(u=y),_>f&&(f=_));const h=c*e,w=l*e,p=(u-c+1)*e,m=(f-l+1)*e;return{x:h,y:w,w:p,h:m}}function Fe(){const t=performance.now();if(t-Ht>=1e3){const e=vt,n=bt,s=J.length?J.reduce((r,o)=>r+o,0)/J.length:0;self.postMessage({type:"stats",fpsPlain:e,fpsAug:n,dropped:Rt,avgDecode:s.toFixed(1)}),vt=bt=Rt=0,J=[],Ht=t}}})();
