import{Q as S,a as T}from"./QLayout-DmpAmxaU.js";import{d as M,u as E,a as C,c as _,o as N,w as b,b as R,e as L,f as c,g as O,h as B,i as P,j as A,k as Q,l as U,m as q,n as p,p as w,r,q as v,s as h,t as H,v as a}from"./index-Bt47ekN_.js";import{_ as W}from"./ReturnButton.vue_vue_type_script_setup_true_lang-C3Y-9oY2.js";import"./QPageSticky-BIjUzvwt.js";const $=M({__name:"RouteAfterTimeout",props:{timeoutMs:{type:Number,required:!0},warningMessage:{type:String,default:"The application has been idle for a long time. Click anywhere to stay on this page..."},warningTimeMs:{type:Number,default:1e4}},emits:["onTimeout"],setup(k,{emit:m}){const g=L(),n=k,{idle:i,lastActive:f}=E(n.timeoutMs),s=C({interval:1e3}),u=_(()=>n.timeoutMs-(s.value-f.value)),o=_(()=>n.warningTimeMs>u.value);let e=null;const t=m;function l(){e=g.notify({progress:!0,message:n.warningMessage,type:"info",multiLine:!0,timeout:u.value})}function y(){e&&e()}return N(()=>{y()}),b(o,d=>{d?l():y()}),b(i,d=>{d&&(y(),t("onTimeout"))}),(d,j)=>(c(),R("div"))}}),D=M({__name:"MainLayout",setup(k){const m=O(),g=Q(),n=A(),i=B(),f=P(),s=_(()=>n.matched.length>1&&n.matched[0].path!=n.matched[1].path);m.$subscribe((o,e)=>{document.hidden||(e.target=="counting"&&n.path!="/"&&(console.log("counting state received, pushing to index page to countdown"),g.push("/")),e.source=="completed"&&e.target=="present"&&g.push({name:"itempresenter",params:{id:m.jobmodel.present_mediaitem_id}}))});const u=o=>{if(!i.configuration.hardwareinputoutput.keyboard_input_enabled){console.log("keyboard input is disabled, to use keyboard input enable it in the configuration and reload the page.");return}i.configuration.actions.image.forEach((e,t)=>{if(e.trigger.keyboard_trigger.keycode==o.key){r(`/api/actions/image/${t}`);return}}),i.configuration.actions.collage.forEach((e,t)=>{if(e.trigger.keyboard_trigger.keycode==o.key){r(`/api/actions/collage/${t}`);return}}),i.configuration.actions.animation.forEach((e,t)=>{if(e.trigger.keyboard_trigger.keycode==o.key){r(`/api/actions/animation/${t}`);return}}),i.configuration.actions.video.forEach((e,t)=>{if(e.trigger.keyboard_trigger.keycode==o.key){r(`/api/actions/video/${t}`);return}}),i.configuration.actions.multicamera.forEach((e,t)=>{if(e.trigger.keyboard_trigger.keycode==o.key){r(`/api/actions/multicamera/${t}`);return}}),i.configuration.share.actions.forEach((e,t)=>{if(e.trigger.keyboard_trigger.keycode==o.key){r(`/api/share/actions/latest/${t}`,"POST");return}})};return U(()=>{console.log("register listener for keyboard input (active only on main layout)"),window.addEventListener("keyup",u)}),q(()=>{console.log("unregister listener for keyboard input"),window.removeEventListener("keyup",u)}),(o,e)=>{const t=H("router-view");return c(),p(S,{id:"main-layout",view:"hHh lpR fFf"},{default:w(()=>[v(T,null,{default:w(()=>[v(t),s.value?(c(),p(W,{key:0,onTriggerReturn:e[0]||(e[0]=l=>o.$router.back())})):h("",!0),s.value&&!a(n).meta.standbyMode?(c(),p($,{key:1,onOnTimeout:e[1]||(e[1]=l=>o.$router.push({path:a(n).matched[0].path})),"timeout-ms":a(i).configuration.uisettings.show_frontpage_timeout*60*1e3},null,8,["timeout-ms"])):h("",!0),!s.value&&!a(n).meta.standbyMode&&a(i).configuration.uisettings.enable_automatic_slideshow&&a(f).collection_number_of_items>0?(c(),p($,{key:2,onOnTimeout:e[2]||(e[2]=l=>o.$router.push({path:"/standby/slideshow/random"})),"timeout-ms":a(i).configuration.uisettings.show_automatic_slideshow_timeout*1e3,"warning-message":o.$t("MSG_WARN_BEFORE_AUTO_SLIDESHOW")},null,8,["timeout-ms","warning-message"])):h("",!0)]),_:1})]),_:1})}}});export{D as default};
