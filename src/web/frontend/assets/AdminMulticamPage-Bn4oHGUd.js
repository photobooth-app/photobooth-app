import{x as R,A as f,Y as U,aa as G,B as k,c as h,M,C as Y,aY as ee,au as te,av as j,aZ as z,a_ as ae,a9 as le,ab as ne,an as oe,ac as re,X as se,d as H,n as S,Z as Q,p as u,q as a,a0 as V,E as l,G as x,a1 as T,Q as g,s as J,ae as L,a$ as D,f as y,a2 as ie,h as ue,v as ce,r as de,F as O,b as E,I as K,H as F,a6 as pe}from"./index-BOGV9K7Z.js";import{Q as me}from"./QBadge-D0akx5DN.js";import{Q as ve,a as ge}from"./QScrollArea-CIjhcYn1.js";import{u as fe,d as be,a as he,b as _e,c as Ce}from"./use-panel-8rDoh6pa.js";import{Q as A}from"./QImg-McCP3ufD.js";import{Q as ye}from"./QMarkupTable-DG7nRduq.js";import{Q as qe}from"./QPage-D5b1SIR2.js";import{Q as N}from"./QInput-Div-XcFc.js";import"./QResizeObserver-DkRGlw5S.js";import"./format-CJebrXOQ.js";import"./selection-B4havM7s.js";import"./use-id-CCmSffB_.js";import"./private.use-form-BXU1Y9kC.js";const I=R({name:"QStepperNavigation",setup(e,{slots:c}){return()=>f("div",{class:"q-stepper__nav"},U(c.default))}}),X=R({name:"StepHeader",props:{stepper:{},step:{},goToPanel:Function},setup(e,{attrs:c}){const{proxy:{$q:b}}=G(),m=k(null),o=h(()=>e.stepper.modelValue===e.step.name),s=h(()=>{const r=e.step.disable;return r===!0||r===""}),d=h(()=>{const r=e.step.error;return r===!0||r===""}),p=h(()=>{const r=e.step.done;return s.value===!1&&(r===!0||r==="")}),w=h(()=>{const r=e.step.headerNav,v=r===!0||r===""||r===void 0;return s.value===!1&&e.stepper.headerNav&&v}),q=h(()=>e.step.prefix&&(o.value===!1||e.stepper.activeIcon==="none")&&(d.value===!1||e.stepper.errorIcon==="none")&&(p.value===!1||e.stepper.doneIcon==="none")),C=h(()=>{const r=e.step.icon||e.stepper.inactiveIcon;if(o.value===!0){const v=e.step.activeIcon||e.stepper.activeIcon;return v==="none"?r:v||b.iconSet.stepper.active}if(d.value===!0){const v=e.step.errorIcon||e.stepper.errorIcon;return v==="none"?r:v||b.iconSet.stepper.error}if(s.value===!1&&p.value===!0){const v=e.step.doneIcon||e.stepper.doneIcon;return v==="none"?r:v||b.iconSet.stepper.done}return r}),n=h(()=>{const r=d.value===!0?e.step.errorColor||e.stepper.errorColor:void 0;if(o.value===!0){const v=e.step.activeColor||e.stepper.activeColor||e.step.color;return v!==void 0?v:r}return r!==void 0?r:s.value===!1&&p.value===!0?e.step.doneColor||e.stepper.doneColor||e.step.color||e.stepper.inactiveColor:e.step.color||e.stepper.inactiveColor}),t=h(()=>"q-stepper__tab col-grow flex items-center no-wrap relative-position"+(n.value!==void 0?` text-${n.value}`:"")+(d.value===!0?" q-stepper__tab--error q-stepper__tab--error-with-"+(q.value===!0?"prefix":"icon"):"")+(o.value===!0?" q-stepper__tab--active":"")+(p.value===!0?" q-stepper__tab--done":"")+(w.value===!0?" q-stepper__tab--navigation q-focusable q-hoverable":"")+(s.value===!0?" q-stepper__tab--disabled":"")),i=h(()=>e.stepper.headerNav!==!0?!1:w.value);function _(){m.value?.focus(),o.value===!1&&e.goToPanel(e.step.name)}function $(r){r.keyCode===13&&o.value===!1&&e.goToPanel(e.step.name)}return()=>{const r={class:t.value};w.value===!0&&(r.onClick=_,r.onKeyup=$,Object.assign(r,s.value===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:c.tabindex||0}));const v=[f("div",{class:"q-focus-helper",tabindex:-1,ref:m}),f("div",{class:"q-stepper__dot row flex-center q-stepper__line relative-position"},[f("span",{class:"row flex-center"},[q.value===!0?e.step.prefix:f(M,{name:C.value})])])];if(e.step.title!==void 0&&e.step.title!==null){const P=[f("div",{class:"q-stepper__title"},e.step.title)];e.step.caption!==void 0&&e.step.caption!==null&&P.push(f("div",{class:"q-stepper__caption"},e.step.caption)),v.push(f("div",{class:"q-stepper__label q-stepper__line relative-position"},P))}return Y(f("div",r,v),[[ee,i.value]])}}});function Z(e){return f("div",{class:"q-stepper__step-content"},[f("div",{class:"q-stepper__step-inner"},U(e.default))])}const W={setup(e,{slots:c}){return()=>Z(c)}},B=R({name:"QStep",props:{...fe,icon:String,color:String,title:{type:String,required:!0},caption:String,prefix:[String,Number],doneIcon:String,doneColor:String,activeIcon:String,activeColor:String,errorIcon:String,errorColor:String,headerNav:{type:Boolean,default:!0},done:Boolean,error:Boolean,onScroll:[Function,Array]},setup(e,{slots:c,emit:b}){const{proxy:{$q:m}}=G(),o=te(z,j);if(o===j)return console.error("QStep needs to be a child of QStepper"),j;const{getCache:s}=be(),d=k(null),p=h(()=>o.value.modelValue===e.name),w=h(()=>m.platform.is.ios!==!0&&m.platform.is.chrome===!0||p.value!==!0||o.value.vertical!==!0?{}:{onScroll(n){const{target:t}=n;t.scrollTop>0&&(t.scrollTop=0),e.onScroll!==void 0&&b("scroll",n)}}),q=h(()=>typeof e.name=="string"||typeof e.name=="number"?e.name:String(e.name));function C(){const n=o.value.vertical;return n===!0&&o.value.keepAlive===!0?f(ae,o.value.keepAliveProps.value,p.value===!0?[f(o.value.needsUniqueKeepAliveWrapper.value===!0?s(q.value,()=>({...W,name:q.value})):W,{key:q.value},c.default)]:void 0):n!==!0||p.value===!0?Z(c):void 0}return()=>f("div",{ref:d,class:"q-stepper__step",role:"tabpanel",...w.value},o.value.vertical===!0?[f(X,{stepper:o.value,step:e,goToPanel:o.value.goToPanel}),o.value.animated===!0?f(ve,C):C()]:[C()])}}),ke=/(-\w)/g;function we(e){const c={};for(const b in e){const m=b.replace(ke,o=>o[1].toUpperCase());c[m]=e[b]}return c}const Se=R({name:"QStepper",props:{...le,..._e,flat:Boolean,bordered:Boolean,alternativeLabels:Boolean,headerNav:Boolean,contracted:Boolean,headerClass:String,inactiveColor:String,inactiveIcon:String,doneIcon:String,doneColor:String,activeIcon:String,activeColor:String,errorIcon:String,errorColor:String},emits:he,setup(e,{slots:c}){const b=G(),m=ne(e,b.proxy.$q),{updatePanelsList:o,isValidPanelName:s,updatePanelIndex:d,getPanelContent:p,getPanels:w,panelDirectives:q,goToPanel:C,keepAliveProps:n,needsUniqueKeepAliveWrapper:t}=Ce();oe(z,h(()=>({goToPanel:C,keepAliveProps:n,needsUniqueKeepAliveWrapper:t,...e})));const i=h(()=>`q-stepper q-stepper--${e.vertical===!0?"vertical":"horizontal"}`+(e.flat===!0?" q-stepper--flat":"")+(e.bordered===!0?" q-stepper--bordered":"")+(m.value===!0?" q-stepper--dark q-dark":"")),_=h(()=>`q-stepper__header row items-stretch justify-between q-stepper__header--${e.alternativeLabels===!0?"alternative":"standard"}-labels`+(e.flat===!1||e.bordered===!0?" q-stepper__header--border":"")+(e.contracted===!0?" q-stepper__header--contracted":"")+(e.headerClass!==void 0?` ${e.headerClass}`:""));function $(){const r=U(c.message,[]);if(e.vertical===!0){s(e.modelValue)&&d();const v=f("div",{class:"q-stepper__content"},U(c.default));return r===void 0?[v]:r.concat(v)}return[f("div",{class:_.value},w().map(v=>{const P=we(v.props);return f(X,{key:P.name,stepper:e,step:P,goToPanel:C})})),r,se("div",{class:"q-stepper__content q-panel-parent"},p(),"cont",e.swipeable,()=>q.value)]}return()=>(o(c),f("div",{class:i.value},re(c.navigation,$())))}}),xe={class:"text-h6"},$e={class:"row no-wrap q-gutter-x-md"},Pe={class:"row no-wrap q-gutter-x-md"},Ie=H({__name:"CharucoGenerator",setup(e){const c=k({squares_x:14,squares_y:9,square_length_mm:20,marker_length_mm:15}),b=k(null),m=k(!1);async function o(){try{m.value=!0;const s=await L("/api/admin/multicamera/calibration/charuco",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c.value)});if(!s.ok){const p=await s.json();throw new Error(`Request failed: ${p.detail}`)}const d=await s.blob();b.value=URL.createObjectURL(d),m.value=!1}catch(s){b.value=null,console.warn(s),D.create({message:String(s),caption:"Error generating the board",color:"negative"})}finally{}}return(s,d)=>(y(),S(Q,{style:{"min-width":"450px","max-height":"80vh","max-width":"80vh"},flat:""},{default:u(()=>[a(V,null,{default:u(()=>[l("div",xe,x(s.$t("ChAruCo Board Generator")),1)]),_:1}),a(V,{class:"q-pt-none"},{default:u(()=>[l("div",$e,[a(N,{modelValue:c.value.squares_x,"onUpdate:modelValue":d[0]||(d[0]=p=>c.value.squares_x=p),label:"Squares X"},null,8,["modelValue"]),a(N,{modelValue:c.value.squares_y,"onUpdate:modelValue":d[1]||(d[1]=p=>c.value.squares_y=p),label:"Squares Y"},null,8,["modelValue"])]),l("div",Pe,[a(N,{modelValue:c.value.square_length_mm,"onUpdate:modelValue":d[2]||(d[2]=p=>c.value.square_length_mm=p),label:"Square Length (mm)"},null,8,["modelValue"]),a(N,{modelValue:c.value.marker_length_mm,"onUpdate:modelValue":d[3]||(d[3]=p=>c.value.marker_length_mm=p),label:"Marker Length (mm)"},null,8,["modelValue"])])]),_:1}),a(T,{align:"right",class:"text-primary"},{default:u(()=>[Y(a(g,{"no-caps":"",flat:"",label:"Cancel"},null,512),[[ie]]),a(g,{color:"green","no-caps":"",label:"Generate",onClick:o,loading:m.value},null,8,["loading"])]),_:1}),a(V,null,{default:u(()=>[b.value?(y(),S(A,{key:0,src:b.value,alt:"Charuco Board",style:{"max-width":"600px","max-height":"400px"},fit:"contain"},null,8,["src"])):J("",!0)]),_:1})]),_:1}))}}),Be={class:"q-gutter-sm q-px-none"},Qe={class:"text-h5"},Ae={class:"text-h5"},Ve={class:"row"},Ee={class:"col q-gutter-sm"},Ne={class:"col q-gutter-sm",align:"right"},Te={class:"text-left"},Le={class:"text-left"},De={class:"text-left"},Ue={class:"text-left"},Re={class:"row"},je={class:"col q-gutter-sm"},Ke={class:"col q-gutter-sm",align:"right"},Fe={style:{height:"100%"},class:"col"},Ge={style:{height:"20px"}},Oe={style:{height:"200px"},class:"row no-wrap"},We={class:"row"},Me={class:"col q-gutter-sm"},Ye={class:"col q-gutter-sm",align:"right"},ze={class:"row"},He={class:"col q-gutter-sm"},Je={class:"col q-gutter-sm",align:"right"},Xe={class:"row"},Ze={class:"col q-gutter-sm"},et={class:"col q-gutter-sm",align:"right"},vt=H({__name:"AdminMulticamPage",setup(e){const c=ue(),b=k(!1),m=k([]),o=k(0),s=k(!1),d=k(null);async function p(){try{s.value=!0;const t=await(await L("/api/aquisition/multicam")).json();m.value.length===0?m.value=t.map(i=>[i]):t.forEach((i,_)=>m.value[_].unshift(i))}catch(n){console.error("Error capturing multicam images:",n)}finally{s.value=!1}}async function w(){try{s.value=!0;const n=await L("/api/admin/multicamera/calibration",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m.value)}),t=await n.json();if(console.log("Calibration result:",t),!n.ok)throw new Error("Server returned code "+n.status+": "+t.detail);D.create({message:"Calibration finished and saved.",color:"positive"})}catch(n){console.error("Error posting calibration:",n),console.warn(n),D.create({message:String(n),caption:"Error posting the calibration data",color:"negative"})}finally{s.value=!1}}async function q(){try{s.value=!0;const n=await L("/api/admin/multicamera/result",{method:"GET"});if(!n.ok){const i=await n.json();throw new Error(`Request failed: ${i.detail}`)}const t=await n.blob();d.value=URL.createObjectURL(t),s.value=!1}catch(n){d.value=null,console.warn(n),D.create({message:String(n),caption:"Error creating the wigglegram",color:"negative"})}finally{}}const C=h(()=>{const n=c.configuration.backends.group_backends,t=c.configuration.backends.index_backend_multicam;if(n==null||t==null)return console.error("cannot get multicam backend from config"),[];const i=n[t].backend_config;return console.log(i),i.backend_type==="Wigglecam"?i.devices:(console.error("selected backend is not a Wigglecam"),[])});return(n,t)=>(y(),S(qe,{id:"multicam-page",padding:""},{default:u(()=>[a(Q,{flat:"",class:"q-pa-md q-mb-md"},{default:u(()=>[a(V,null,{default:u(()=>[...t[12]||(t[12]=[l("div",{class:"text-h5"},"Multicamera Tools",-1)])]),_:1}),a(V,null,{default:u(()=>[t[13]||(t[13]=l("p",null,"ðŸ‘‹ Hey, this multicamera tool is to help you creating awesome wigglegrams.",-1)),t[14]||(t[14]=l("p",null," Wigglegrams are stills captured using a camera array. Usually 4 equal cameras are required to capture sufficient perspectives of a scene. The stills are stitched together and replayed as a GIF/Video. ",-1)),t[15]||(t[15]=l("p",null," Since the cameras, despite being the same model underly some tolerances in optics and alignment during assembly, to create smooth wigglegrams, the cameras need to be calibrated once. Please follow the steps to calibrate the cameras. ",-1)),l("div",Be,[a(g,{outline:"","no-caps":"",color:"green",href:"https://photobooth-app.org/wigglegramcamera/",target:"_blank","icon-right":"sym_o_open_in_new",label:"Learn more"})])]),_:1}),a(T,{class:"q-gutter-sm q-px-none",align:"right"},{default:u(()=>[a(g,{"no-caps":"",outline:"",color:"red",label:n.$t("Delete calibration data"),onClick:t[0]||(t[0]=i=>ce(de)("/api/admin/multicamera/calibration","DELETE"))},null,8,["label"])]),_:1})]),_:1}),l("div",null,[C.value.length==0?(y(),S(Q,{key:0,flat:"",class:"q-pa-md q-mb-md"},{default:u(()=>[l("div",Qe,[O(x(n.$t("Calibrate"))+" ",1),a(me,{color:"negative",align:"top"},{default:u(()=>[a(M,{name:"sym_o_error",color:"white",size:"15px"})]),_:1})]),t[16]||(t[16]=l("p",null,"Not available, because there is no multicamera/wigglecamera enabled in the backends.",-1))]),_:1})):(y(),S(Se,{key:1,modelValue:o.value,"onUpdate:modelValue":t[10]||(t[10]=i=>o.value=i),vertical:"",animated:"",flat:"",class:"q-pa-md q-mb-md"},{default:u(()=>[l("div",Ae,x(n.$t("Calibrate")),1),a(B,{name:0,title:"Set your calibration target",icon:"sym_o_target",done:o.value>0},{default:u(()=>[t[17]||(t[17]=l("p",null,"You need a ChAruCo board for the calibration routine. If you do not have one, generate it here.",-1)),t[18]||(t[18]=l("p",null,"The board needs to be very solid and plane for good results.",-1)),a(I,null,{default:u(()=>[l("div",Ve,[l("div",Ee,[a(g,{color:"green","no-caps":"",label:n.$t("Generate your ChAruCo board"),onClick:t[1]||(t[1]=i=>b.value=!0)},null,8,["label"])]),l("div",Ne,[a(g,{"no-caps":"",onClick:t[2]||(t[2]=i=>o.value=1),color:"green",label:"Start"})])])]),_:1})]),_:1},8,["done"]),a(B,{name:1,title:"Preflight check before starting the calibration",icon:"sym_o_verified",done:o.value>1},{default:u(()=>[t[20]||(t[20]=l("p",null," Following nodes are configured as multicamera backend currently. Please confirm, that the backend is setup correctly as later changes invalidate the calibration. ",-1)),a(ye,{flat:"",bordered:""},{default:u(()=>[t[19]||(t[19]=l("thead",null,[l("tr",null,[l("th",{class:"text-left"},"Stream"),l("th",{class:"text-left"},"Device Description"),l("th",{class:"text-left"},"Index/Device-Id"),l("th",{class:"text-left"},"Address")])],-1)),l("tbody",null,[(y(!0),E(F,null,K(C.value,(i,_)=>(y(),E("tr",{key:_},[l("td",Te,[a(A,{style:{width:"200px"},fit:"contain",src:`/api/aquisition/stream.mjpg?index_subdevice=${_}`},null,8,["src"])]),l("td",Le,x(i.description),1),l("td",De,x(_),1),l("td",Ue,x(i.address),1)]))),128))])]),_:1}),a(I,null,{default:u(()=>[l("div",Re,[l("div",je,[a(g,{flat:"","no-caps":"",color:"green",label:"Configure backends","icon-right":"sym_o_open_in_new",to:"/admin/config"})]),l("div",Ke,[a(g,{flat:"","no-caps":"",onClick:t[3]||(t[3]=i=>o.value=0),color:"green",label:n.$t("BTN_LABEL_BACK")},null,8,["label"]),a(g,{"no-caps":"",onClick:t[4]||(t[4]=i=>o.value=2),color:"green",label:n.$t("Continue")},null,8,["label"])])])]),_:1})]),_:1},8,["done"]),a(B,{name:2,title:"Capture images for calibration",icon:"sym_o_camera",done:o.value>2},{default:u(()=>[t[21]||(t[21]=l("p",null," Now capture images with the CharuCo board. Please check that the images look well, the CharuCo board is about in the center of the image and in roughly 2m distance to the camera array. Ensure the scene is well lit and all cameras are in focus. Do not move the board during the capture. ",-1)),a(g,{"no-caps":"",class:"q-mb-md",onClick:p,color:"green",label:"Capture",loading:s.value},null,8,["loading"]),l("div",null,[(y(!0),E(F,null,K(C.value,(i,_)=>(y(),S(ge,{class:"q-mb-md",style:{height:"220px",width:"100%"},key:_},{default:u(()=>[l("div",Fe,[l("div",Ge,"Camera Index/Device-Id: "+x(_),1),l("div",Oe,[a(Q,{style:{width:"250px",height:"100%"},class:"q-pa-sm",flat:""},{default:u(()=>[a(A,{fit:"contain",src:`/api/aquisition/stream.mjpg?index_subdevice=${_}`},null,8,["src"]),a(T,{align:"right"},{default:u(()=>[a(g,{flat:"",round:"",color:"primary",icon:"sym_o_camera",onClick:p,loading:s.value},null,8,["loading"])]),_:1})]),_:2},1024),(y(!0),E(F,null,K(m.value[_],($,r)=>(y(),S(Q,{key:r,style:{width:"250px",height:"100%"},class:"q-pa-sm",flat:""},{default:u(()=>[a(A,{loading:"lazy",fit:"contain",src:`/api/aquisition/multicam/${$}`},null,8,["src"]),a(T,{align:"right"},{default:u(()=>[a(g,{flat:"",round:"",color:"red",icon:"sym_o_delete",onClick:v=>m.value[_].splice(r,1)},null,8,["onClick"]),a(g,{flat:"",round:"",color:"primary",icon:"sym_o_download",to:`/api/aquisition/multicam/${$}`,target:"_blank"},null,8,["to"])]),_:2},1024)]),_:2},1024))),128))])])]),_:2},1024))),128))]),a(I,null,{default:u(()=>[l("div",We,[l("div",Me,[a(g,{"no-caps":"",onClick:p,color:"green",label:"Capture ",loading:s.value},null,8,["loading"])]),l("div",Ye,[a(g,{flat:"","no-caps":"",onClick:t[5]||(t[5]=i=>o.value=1),color:"green",label:n.$t("BTN_LABEL_BACK")},null,8,["label"]),a(g,{"no-caps":"",onClick:t[6]||(t[6]=i=>o.value=3),color:"green",label:n.$t("Continue"),disable:m.value.length==0},null,8,["label","disable"])])])]),_:1})]),_:1},8,["done"]),a(B,{name:3,title:"Calculate the new calibration data",icon:"sym_o_calculate",done:o.value>3},{default:u(()=>[t[22]||(t[22]=O(" Press the button to calculate and save the new calibration data. ",-1)),a(I,null,{default:u(()=>[l("div",ze,[l("div",He,[a(g,{"no-caps":"",color:"green",disable:m.value.length==0,label:n.$t("Calculate"),onClick:w,loading:s.value},null,8,["disable","label","loading"])]),l("div",Je,[a(g,{"no-caps":"",flat:"",onClick:t[7]||(t[7]=i=>o.value=2),color:"green",label:n.$t("BTN_LABEL_BACK")},null,8,["label"]),a(g,{"no-caps":"",onClick:t[8]||(t[8]=i=>o.value=4),color:"green",label:n.$t("Continue")},null,8,["label"])])])]),_:1})]),_:1},8,["done"]),a(B,{name:4,title:"Confirm the result",icon:"sym_o_flag"},{default:u(()=>[t[23]||(t[23]=l("p",null," âœ…ï¸ You made it! At this point you can check the calibration result. Click the capture button to trigger the camera array and compile a GIF. ",-1)),t[24]||(t[24]=l("p",null,"If your image looks good, you can continue setup the actions in the configuration. Otherwise you might want to start over.",-1)),d.value?(y(),S(A,{key:0,src:d.value,alt:"Charuco Board",style:{"max-width":"600px","max-height":"400px"},fit:"contain"},null,8,["src"])):J("",!0),a(I,null,{default:u(()=>[l("div",Xe,[l("div",Ze,[a(g,{"no-caps":"",color:"green",label:n.$t("Capture and create wigglegram"),onClick:q,loading:s.value},null,8,["label","loading"])]),l("div",et,[a(g,{"no-caps":"",flat:"",onClick:t[9]||(t[9]=i=>o.value=3),color:"green",label:n.$t("BTN_LABEL_BACK")},null,8,["label"])])])]),_:1})]),_:1})]),_:1},8,["modelValue"]))]),a(pe,{modelValue:b.value,"onUpdate:modelValue":t[11]||(t[11]=i=>b.value=i)},{default:u(()=>[a(Ie)]),_:1},8,["modelValue"])]),_:1}))}});export{vt as default};
