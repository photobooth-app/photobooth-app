import{j,k as F,l as H,m as z,d as A,n as O,p as k,o as D,q as W,s as L,v as P,t as p,i as o,x as m,g as s,w as d,y as V,z as E,F as U,A as K,f as b,B as u,C as n,D as G,Q as M,E as X,G as I,H as T,I as Y,J,e as Z,K as ee,r as $,L as te,u as ne,a as ae,M as oe,N as ie,c as re,_ as Q}from"./index-DUoLN4fl.js";import{Q as S}from"./QPageSticky-IbSFrIUz.js";import{Q as se}from"./QPage-DIxBns_o.js";import{Q as le}from"./QCircularProgress-C88oH6f4.js";import{_ as ce}from"./RouteAfterTimeout.vue_vue_type_script_setup_true_lang-bF9VSA12.js";import{Q as ue}from"./QImg-D2K_FcvC.js";import{Q as me}from"./QBadge-BcvFZR7q.js";import{I as de}from"./ItemNotAvailableError-BVtnfslQ.js";import"./format-CJebrXOQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const _e='<circle cx="12.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="0s" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="52.5" r="12.5" fill-opacity=".5"><animate attributeName="fill-opacity" begin="100ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="300ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="600ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="800ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="400ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="700ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="500ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="200ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle>',pe=j({name:"QSpinnerGrid",props:F,setup(y){const{cSize:i,classes:e}=H(y);return()=>z("svg",{class:e.value,fill:"currentColor",width:i.value,height:i.value,viewBox:"0 0 105 105",xmlns:"http://www.w3.org/2000/svg",innerHTML:_e})}}),ge='<g fill="none" fill-rule="evenodd" stroke-width="2"><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="0s" dur="1.8s" values="1; 20" calcMode="spline" keyTimes="0; 1" keySplines="0.165, 0.84, 0.44, 1" repeatCount="indefinite"></animate><animate attributeName="stroke-opacity" begin="0s" dur="1.8s" values="1; 0" calcMode="spline" keyTimes="0; 1" keySplines="0.3, 0.61, 0.355, 1" repeatCount="indefinite"></animate></circle><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="-0.9s" dur="1.8s" values="1; 20" calcMode="spline" keyTimes="0; 1" keySplines="0.165, 0.84, 0.44, 1" repeatCount="indefinite"></animate><animate attributeName="stroke-opacity" begin="-0.9s" dur="1.8s" values="1; 0" calcMode="spline" keyTimes="0; 1" keySplines="0.3, 0.61, 0.355, 1" repeatCount="indefinite"></animate></circle></g>',fe=j({name:"QSpinnerPuff",props:F,setup(y){const{cSize:i,classes:e}=H(y);return()=>z("svg",{class:e.value,stroke:"currentColor",width:i.value,height:i.value,viewBox:"0 0 44 44",xmlns:"http://www.w3.org/2000/svg",innerHTML:ge})}}),ve={id:"countdown-timer-container",class:"flex flex-center",style:{width:"70vw",height:"70vh"}},be=["innerHTML"],ye={style:{height:"100%"}},he=A({__name:"CountdownTimer",props:{duration:{},messageDuration:{default:.5},messageText:{default:"ðŸ˜ƒ"}},setup(y){let i;const e=O(0),t=O(0),l=y,r=k(()=>e.value>0),a=k(()=>e.value>0),_=k(()=>e.value<=l.messageDuration);D(()=>{B()}),W(()=>{x()});const x=()=>{clearInterval(i),e.value=0},B=()=>{t.value=l.duration,e.value=t.value,console.log(`starting timer, duration=${t.value}`),i=window.setInterval(()=>{e.value-=.05,e.value<=0&&clearInterval(i)},50)};return(w,c)=>L((o(),p("div",ve,[L(m("div",{id:"countdown-timer-message",style:{position:"absolute","font-size":"150px"},innerHTML:w.messageText},null,8,be),[[P,_.value]]),m("div",ye,[L(s(le,{id:"countdown-circular-progress","show-value":!_.value,style:{width:"100%",height:"100%","text-shadow":"#222 0 0 10px","font-weight":"bold",opacity:"85%"},value:e.value,min:0,max:t.value,reverse:"","animation-speed":"100","font-size":"0.5em",size:"70vh",color:"secondary",class:"text-secondary",thickness:.16},{default:d(()=>[V(E(parseFloat(e.value.toFixed(0))),1)]),_:1},8,["show-value","value","max"]),[[P,a.value]])])],512)),[[P,r.value]])}}),we={class:"row q-gutter-md action-buttons"},ke={style:{"white-space":"nowrap"},class:"gt-sm"},Ce=A({__name:"FrontpageTriggerButtons",props:{triggers:{}},emits:["triggerAction"],setup(y,{emit:i}){const e=i;function t(l,r){e("triggerAction",l,r)}return(l,r)=>(o(),p("div",we,[(o(!0),p(U,null,K(l.triggers,(a,_)=>(o(),p("div",{key:_},[a.show_button&&!(n(G.isEmpty)(a.title)&&n(G.isEmpty)(a.icon))?(o(),b(M,{key:0,stack:"",color:a.use_custom_color?"custom":"primary","no-caps":"",rounded:"",class:I(["action-button col-auto glass-effect",["action-button-"+_]]),style:X({"--bg-custom":a.use_custom_color?a.custom_color:null}),onClick:x=>t(a.action,a.config_index)},{default:d(()=>[n(G.isEmpty)(a.icon)?u("",!0):(o(),b(T,{key:0,name:`sym_o_${a.icon}`},null,8,["name"])),m("div",ke,E(a.title),1)]),_:2},1032,["color","class","style","onClick"])):u("",!0)]))),128))]))}}),Se={id:"preview-container",class:""},Ee={id:"preview-outer-container",class:"preview-center-element"},Me=["src"],xe=A({__name:"PreviewStream",props:{enableMirrorEffectStream:{type:Boolean},enableMirrorEffectFrame:{type:Boolean},enableBlurredBackgroundStream:{type:Boolean},frameOverlayImage:{}},setup(y){const i=y;let e=null,t=null,l=null,r=null;const a=(c,f,v)=>{(c.width!=v.width||c.height!=v.height)&&(c.width=v.width,c.height=v.height),f.drawImage(v,0,0)},_=Y((c,f,v)=>{a(c,f,v)},300),{open:x,close:B}=J("/api/aquisition/stream",{immediate:!1,autoReconnect:{retries:-1,delay:1e3},onConnected(){console.log("stream connected via websockets")},onDisconnected(c,f){console.log("stream disconnected",f)},async onMessage(c,f){if(e&&t||l&&r){const v=await createImageBitmap(new Blob([f.data],{type:"image/jpeg"}));e&&t&&a(e,t,v),l&&r&&_(l,r,v)}else console.error("jpeg bytes received but no canvas to draw to.")}}),w=k(()=>i.frameOverlayImage??!0);return D(()=>{console.log("preview stream mounted!");const c=document.getElementById("preview-inner-overlay");c&&(c.onload=function(){console.log(c.naturalWidth/c.naturalHeight);const f=document.getElementById("preview-inner-container");f.style.aspectRatio=Number(c.naturalWidth/c.naturalHeight).toFixed(4)}),e=document.getElementById("preview-inner-stream"),l=document.getElementById("preview-outer-blurred"),e&&(t=e.getContext("2d")),l&&(r=l.getContext("2d")),(e||l)&&x()}),Z(()=>{B()}),(c,f)=>(o(),p("div",Se,[i.enableBlurredBackgroundStream?(o(),p("canvas",{key:0,id:"preview-outer-blurred",class:I(["preview-center-element",{mirroreffect:i.enableMirrorEffectStream}])},null,2)):u("",!0),m("div",Ee,[m("div",{id:"preview-inner-container",class:I(["preview-center-element",{"stream-no-preview":!w.value}])},[m("canvas",{id:"preview-inner-stream",class:I(["preview-center-element",{mirroreffect:i.enableMirrorEffectStream,cover:w.value,contain:!w.value}])},null,2),L(m("img",{id:"preview-inner-overlay",class:I(["preview-center-element contain",{mirroreffect:i.enableMirrorEffectFrame}]),src:i.frameOverlayImage},null,10,Me),[[P,w.value]])],2)])]))}}),Ie={id:"itemapproval-dialog",class:"absolute-full flex flex-center"},Te={class:"q-mb-lg action-buttons col"},Be={class:"q-mb-sm row flex flex-center"},$e={class:"row"},Ae=A({__name:"MediaItemApprovalViewer",props:{approval_id:{},number_captures_taken:{},total_captures_to_take:{}},setup(y){const i=O(!0);ee(()=>{i.value=!0});const e=()=>{$("/api/processing/confirm")},t=()=>{$("/api/processing/reject")},l=()=>{$("/api/processing/abort")};return(r,a)=>(o(),p("div",Ie,[i.value?(o(),b(ue,{key:0,draggable:!1,loading:"eager",src:`/api/processing/approval/${r.approval_id}`,fit:"contain",style:{height:"95%"},onError:a[0]||(a[0]=_=>i.value=!1),"loading-show-delay":"800"},null,8,["src"])):(o(),b(de,{key:1})),s(S,{position:"top-left",class:"q-ma-lg"},{default:d(()=>[s(M,{id:"layout-button-back",color:"grey",rounded:"","no-caps":"",onClick:a[1]||(a[1]=_=>l()),class:"action-button glass-effect"},{default:d(()=>[s(T,{left:"",name:"sym_o_cancel"}),m("div",null,E(r.$t("MSG_APPROVE_COLLAGE_ITEM_CANCEL_COLLAGE")),1)]),_:1})]),_:1}),s(S,{position:"bottom",class:"q-ma-lg"},{default:d(()=>[m("div",Te,[m("div",Be,[s(me,{color:"grey-8",class:"q-mr-xs"},{default:d(()=>[s(T,{name:"sym_o_tag",color:"white",class:"q-mr-xs"}),V(" "+E(r.$t("LABEL_ELEMENT_X_OF_Y",{no:r.number_captures_taken,total:r.total_captures_to_take})),1)]),_:1})]),m("div",$e,[s(M,{id:"item-approval-button-reject",stack:"",rounded:"",class:"q-mr-lg action-button col-auto glass-effect",color:"negative","no-caps":"",icon:"sym_o_thumb_down",label:r.$t("MSG_APPROVE_COLLAGE_ITEM_RETRY"),onClick:a[2]||(a[2]=_=>t())},null,8,["label"]),s(M,{id:"item-approval-button-approve",stack:"",rounded:"",class:"q-mr-sm action-button col-auto glass-effect",color:"positive","no-caps":"",icon:"sym_o_thumb_up",label:r.$t("MSG_APPROVE_COLLAGE_ITEM_APPROVE"),onClick:a[3]||(a[3]=_=>e())},null,8,["label"])])])]),_:1})]))}}),Ne={key:1,class:"full-height full-width column justify-center content-center",style:{position:"absolute"}},Le={key:2,id:"frontpage-countdown",class:"full-height full-width column justify-center content-center",style:{position:"absolute"}},Pe=["innerHTML"],Oe={key:4},Re={key:0},qe={key:0},Ge={class:"q-gutter-md"},Qe={class:"gt-sm"},je={key:0},Fe={class:"q-gutter-md"},He={class:"gt-sm"},et=A({__name:"IndexPage",setup(y){const i=te(),e=ne(),t=ae(),l=re(),r=O(0);oe(r,()=>{r.value>=5&&l.push("/admin"),r.value=0},{debounce:500});const a=k(()=>{const g=[];return Object.entries(t.configuration.actions).forEach(([h,N])=>{N.forEach((C,R)=>{const q={action:`actions/${h}`,config_index:R,show_button:C.trigger.ui_trigger.show_button,title:C.trigger.ui_trigger.title,icon:C.trigger.ui_trigger.icon,use_custom_color:C.trigger.ui_trigger.use_custom_color,custom_color:C.trigger.ui_trigger.custom_color};g.push(q)})}),g}),_=k(()=>t.configuration.uisettings.admin_button_invisible),x=k(()=>{const g=t.configuration.uisettings.enable_livestream_when_idle,h=t.configuration.uisettings.enable_livestream_when_active,N=e.isStateIdle,C=e.isStateRecording,R=e.isStateCountdown,q=e.isStateCapture;return N&&g||(R||q)&&h||C}),B=ie(x,500),w=k(()=>{const g=Q.get(e.jobmodel.configuration_set,"processing.img_frame_enable",!1),h=Q.get(e.jobmodel.configuration_set,"processing.img_frame_file","");return e.isStateCountdown&&g?h:e.isStateIdle&&t.configuration.uisettings.enable_livestream_frameoverlay?t.configuration.uisettings.livestream_frameoverlay_image:""}),c=()=>{_.value?r.value++:l.push("/admin")},f=(g,h)=>{$(`/api/${g}/${h}`)},v=()=>{$("/api/processing/next")};return(g,h)=>(o(),b(se,{id:"index-page",class:"q-pa-none full-height"},{default:d(()=>[n(B)?(o(),b(xe,{key:0,"frame-overlay-image":w.value,"enable-blurred-background-stream":n(t).configuration.uisettings.livestream_blurredbackground,"enable-mirror-effect-stream":n(t).configuration.uisettings.livestream_mirror_effect,"enable-mirror-effect-frame":n(t).configuration.uisettings.livestream_frameoverlay_mirror_effect},null,8,["frame-overlay-image","enable-blurred-background-stream","enable-mirror-effect-stream","enable-mirror-effect-frame"])):u("",!0),n(e).isStateProcessing?(o(),p("div",Ne,[s(pe,{size:"20em"})])):u("",!0),n(e).isStateCountdown?(o(),p("div",Le,[s(he,{ref:"countdowntimer",duration:n(e).jobmodel.duration,"message-duration":n(t).configuration.uisettings.TAKEPIC_MSG_TIME,"message-text":n(t).configuration.uisettings.TAKEPIC_MSG_TEXT},null,8,["duration","message-duration","message-text"])])):u("",!0),n(e).isStateIdle?(o(),p("div",{key:3,id:"frontpage_text",innerHTML:n(t).configuration.uisettings.FRONTPAGE_TEXT},null,8,Pe)):u("",!0),n(e).isStateApproval?(o(),p("div",Oe,[s(Ae,{approval_id:n(e).jobmodel.approval_id,number_captures_taken:n(e).jobmodel.number_captures_taken,total_captures_to_take:n(e).jobmodel.total_captures_to_take},null,8,["approval_id","number_captures_taken","total_captures_to_take"])])):u("",!0),s(S,{position:"bottom",class:"q-mb-lg"},{default:d(()=>[n(e).isStateIdle?(o(),p("div",Re,[s(Ce,{triggers:a.value,onTriggerAction:f},null,8,["triggers"])])):u("",!0)]),_:1}),s(S,{position:"top-left",class:"q-ma-lg"},{default:d(()=>[n(e).isStateIdle?(o(),p("div",qe,[m("div",Ge,[n(t).configuration.uisettings.show_gallery_on_frontpage?(o(),b(M,{key:0,id:"frontpage-button-to-gallery",color:"primary","no-caps":"",rounded:"",to:"/gallery",class:"action-button glass-effect"},{default:d(()=>[s(T,{left:"",name:"sym_o_photo_library"}),m("div",Qe,E(g.$t("BTN_LABEL_MAINPAGE_TO_GALLERY")),1)]),_:1})):u("",!0)])])):u("",!0)]),_:1}),s(S,{position:"top-right",class:"q-ma-lg"},{default:d(()=>[n(e).isStateIdle?(o(),p("div",je,[m("div",Fe,[n(t).configuration.uisettings.show_admin_on_frontpage?(o(),b(M,{key:0,id:"frontpage-button-to-admin",rounded:"",color:"transparent","no-caps":"",class:I(["action-button action-button-admin glass-effect",{"action-button-admin-invisible":_.value}]),onClick:c},{default:d(()=>[s(T,{left:"",name:"sym_o_admin_panel_settings"}),m("div",He,E(g.$t("BTN_LABEL_MAINPAGE_TO_ADMIN")),1)]),_:1},8,["class"])):u("",!0)])])):u("",!0)]),_:1}),n(e).isStateRecording?(o(),b(S,{key:5,id:"frontpage-indicator-recording",position:"top-right",offset:[25,25],align:"center"},{default:d(()=>[s(fe,{color:"red",size:"12em",thickness:"20"})]),_:1})):u("",!0),n(e).isStateRecording?(o(),b(S,{key:6,id:"frontpage-indicator-stop-recording",position:"bottom",offset:[0,25],align:"center"},{default:d(()=>[s(M,{stack:"",rounded:"","no-caps":"",color:"negative",class:"action-button glass-effect",onClick:h[0]||(h[0]=N=>v())},{default:d(()=>[s(T,{name:"sym_o_stop_circle"}),m("div",null,E(g.$t("Stop recording")),1)]),_:1})]),_:1})):u("",!0),n(t).configuration.uisettings.enable_automatic_slideshow&&n(i).collection_number_of_items>0?(o(),b(ce,{key:7,route:"/slideshow/random","timeout-ms":n(t).configuration.uisettings.show_automatic_slideshow_timeout*1e3,"warning-message":g.$t("MSG_WARN_BEFORE_AUTO_SLIDESHOW")},null,8,["timeout-ms","warning-message"])):u("",!0)]),_:1}))}});export{et as default};
