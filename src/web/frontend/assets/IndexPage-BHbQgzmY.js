import{x as Q,y as j,z as F,A as H,d as A,B as L,c as x,l as z,o as U,C as N,D as P,b as s,f as n,E as _,q as m,p as v,F as V,G as E,H as D,I as K,n as y,s as f,v as i,J as R,Q as M,K as X,L as $,M as T,N as Y,m as J,O as Z,h as W,P as ee,r as B,g as te,R as ne,S as ie,k as ae,_ as G}from"./index-Di72g7My.js";import{Q as S}from"./QPageSticky-B40umIox.js";import{Q as oe}from"./QPage-BwEcznG9.js";import{Q as re}from"./QCircularProgress-D-TZ2Z9q.js";import{Q as se}from"./QImg-CV0rvFI2.js";import{Q as le}from"./QBadge-DTbqUKsZ.js";import{I as ce}from"./ItemNotAvailableError-BuIeE7Tm.js";import"./format-CJebrXOQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ue='<circle cx="12.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="0s" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="52.5" r="12.5" fill-opacity=".5"><animate attributeName="fill-opacity" begin="100ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="300ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="600ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="800ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="400ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="700ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="500ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="200ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle>',me=Q({name:"QSpinnerGrid",props:j,setup(g){const{cSize:t,classes:e}=F(g);return()=>H("svg",{class:e.value,fill:"currentColor",width:t.value,height:t.value,viewBox:"0 0 105 105",xmlns:"http://www.w3.org/2000/svg",innerHTML:ue})}}),de='<g fill="none" fill-rule="evenodd" stroke-width="2"><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="0s" dur="1.8s" values="1; 20" calcMode="spline" keyTimes="0; 1" keySplines="0.165, 0.84, 0.44, 1" repeatCount="indefinite"></animate><animate attributeName="stroke-opacity" begin="0s" dur="1.8s" values="1; 0" calcMode="spline" keyTimes="0; 1" keySplines="0.3, 0.61, 0.355, 1" repeatCount="indefinite"></animate></circle><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="-0.9s" dur="1.8s" values="1; 20" calcMode="spline" keyTimes="0; 1" keySplines="0.165, 0.84, 0.44, 1" repeatCount="indefinite"></animate><animate attributeName="stroke-opacity" begin="-0.9s" dur="1.8s" values="1; 0" calcMode="spline" keyTimes="0; 1" keySplines="0.3, 0.61, 0.355, 1" repeatCount="indefinite"></animate></circle></g>',ge=Q({name:"QSpinnerPuff",props:j,setup(g){const{cSize:t,classes:e}=F(g);return()=>H("svg",{class:e.value,stroke:"currentColor",width:t.value,height:t.value,viewBox:"0 0 44 44",xmlns:"http://www.w3.org/2000/svg",innerHTML:de})}}),_e={id:"countdown-timer-container",class:"flex flex-center",style:{width:"70vw",height:"70vh"}},pe=["innerHTML"],fe={style:{height:"100%"}},ve=A({__name:"CountdownTimer",props:{duration:{},messageDuration:{default:.5},messageText:{default:"ðŸ˜ƒ"}},setup(g){let t;const e=L(0),u=L(0),r=g,p=x(()=>e.value>0),b=x(()=>e.value>0),a=x(()=>e.value<=r.messageDuration);z(()=>{h()}),U(()=>{w()});const w=()=>{clearInterval(t),e.value=0},h=()=>{u.value=r.duration,e.value=u.value,console.log(`starting timer, duration=${u.value}`),t=window.setInterval(()=>{e.value-=.05,e.value<=0&&clearInterval(t)},50)};return(c,k)=>N((n(),s("div",_e,[N(_("div",{id:"countdown-timer-message",style:{position:"absolute","font-size":"150px"},innerHTML:g.messageText},null,8,pe),[[P,a.value]]),_("div",fe,[N(m(re,{id:"countdown-circular-progress","show-value":!a.value,style:{width:"100%",height:"100%","text-shadow":"#222 0 0 10px","font-weight":"bold",opacity:"85%"},value:e.value,min:0,max:u.value,reverse:"","animation-speed":"100","font-size":"0.5em",size:"70vh",color:"secondary",class:"text-secondary",thickness:.16},{default:v(()=>[V(E(parseFloat(e.value.toFixed(0))),1)]),_:1},8,["show-value","value","max"]),[[P,b.value]])])],512)),[[P,p.value]])}}),be={class:"row q-gutter-md action-buttons"},he=["src","alt","onClick"],ye={style:{"white-space":"nowrap"},class:"gt-sm"},we=A({__name:"FrontpageTriggerButtons",props:{triggers:{}},emits:["triggerAction"],setup(g,{emit:t}){console.log("Triggers:",g.triggers);const u=t;function r(p,b){u("triggerAction",p,b)}return(p,b)=>(n(),s("div",be,[(n(!0),s(D,null,K(g.triggers,(a,w)=>(n(),s("div",{key:w},[a.show_button&&a.image_path!=null&&a.image_path!==""?(n(),s("img",{key:0,src:a.image_path,alt:a.title||"Action button",class:"action-button-image",onClick:h=>r(a.action,a.config_index),style:{cursor:"pointer","max-width":"150px","max-height":"150px"}},null,8,he)):a.show_button&&(a.image_path==null||a.image_path==="")&&!(i(R.isEmpty)(a.title)&&i(R.isEmpty)(a.icon))?(n(),y(M,{key:1,stack:"",color:a.use_custom_color?"custom":"primary","no-caps":"",rounded:"",class:$(["action-button col-auto glass-effect",["action-button-"+w]]),style:X({"--bg-custom":a.use_custom_color?a.custom_color:null}),onClick:h=>r(a.action,a.config_index)},{default:v(()=>[i(R.isEmpty)(a.icon)?f("",!0):(n(),y(T,{key:0,name:`sym_o_${a.icon}`},null,8,["name"])),_("div",ye,E(a.title),1)]),_:2},1032,["color","class","style","onClick"])):f("",!0)]))),128))]))}}),ke={id:"preview-container",class:""},xe={id:"preview-outer-container",class:"preview-center-element"},Ce=["src"],Se=A({__name:"PreviewStream",props:{index_device:{},enableMirrorEffectStream:{type:Boolean},enableMirrorEffectFrame:{type:Boolean},enableBlurredBackgroundStream:{type:Boolean},blurredbackgroundHighFramerate:{type:Boolean},frameOverlayImage:{}},setup(g){const t=g;let e=null,u=null,r=null,p=null;const b=t.blurredbackgroundHighFramerate===!0?50:300,a=(o,l,d)=>{(o.width!=d.width||o.height!=d.height)&&(o.width=d.width,o.height=d.height),l.drawImage(d,0,0)},w=Z((o,l,d)=>{a(o,l,d)},b),h=`${location.protocol==="https:"?"wss":"ws"}://${location.host}/api/aquisition/stream?index_device=${t.index_device}&index_subdevice=0`,{open:c,close:k}=Y(h,{immediate:!1,autoReconnect:{retries:-1,delay:1e3},onConnected(){console.log("stream connected via websocket")},onDisconnected(){console.log("stream disconnected from websocket")},async onMessage(o,l){if(!document.hidden)if(e&&u||r&&p){const d=await createImageBitmap(new Blob([l.data],{type:"image/jpeg"}));e&&u&&a(e,u,d),r&&p&&w(r,p,d),d.close()}else console.error("jpeg bytes received but no canvas to draw to.")}}),I=x(()=>t.frameOverlayImage??!0);return z(()=>{console.log("preview stream mounted!");const o=document.getElementById("preview-inner-overlay");o&&(o.onload=function(){console.log(o.naturalWidth/o.naturalHeight);const l=document.getElementById("preview-inner-container");l.style.aspectRatio=Number(o.naturalWidth/o.naturalHeight).toFixed(4)}),e=document.getElementById("preview-inner-stream"),r=document.getElementById("preview-outer-blurred"),e&&(u=e.getContext("2d")),r&&(p=r.getContext("2d")),(e||r)&&c()}),J(()=>{k(),e=null,u=null,r=null,p=null,console.log("preview stream unmounted!")}),(o,l)=>(n(),s("div",ke,[t.enableBlurredBackgroundStream?(n(),s("canvas",{key:0,id:"preview-outer-blurred",class:$(["preview-center-element",{mirroreffect:t.enableMirrorEffectStream}])},null,2)):f("",!0),_("div",xe,[_("div",{id:"preview-inner-container",class:$(["preview-center-element",{"stream-no-preview":!I.value}])},[_("canvas",{id:"preview-inner-stream",class:$(["preview-center-element",{mirroreffect:t.enableMirrorEffectStream,cover:I.value,contain:!I.value}])},null,2),N(_("img",{id:"preview-inner-overlay",class:$(["preview-center-element contain",{mirroreffect:t.enableMirrorEffectFrame}]),src:t.frameOverlayImage},null,10,Ce),[[P,I.value]])],2)])]))}}),$e={id:"itemapproval-dialog",class:"absolute-full flex flex-center"},Ee=["src"],Ie={class:"q-mb-lg action-buttons col"},Me={class:"q-mb-sm row flex flex-center"},Te={class:"row"},Be=["src"],Ae=["src"],Ne=A({__name:"MediaItemApprovalViewer",props:{approval_id:{},number_captures_taken:{},total_captures_to_take:{}},setup(g){const t=L(!0),e=W(),u=x(()=>e.configuration.uisettings.abort_button_image_string),r=x(()=>e.configuration.uisettings.retake_button_image_string),p=x(()=>e.configuration.uisettings.next_button_image_string);ee(()=>{t.value=!0});const b=()=>{B("/api/processing/confirm")},a=()=>{B("/api/processing/reject")},w=()=>{B("/api/processing/abort")};return(h,c)=>(n(),s("div",$e,[t.value?(n(),y(se,{key:0,draggable:!1,loading:"eager",src:`/api/processing/approval/${g.approval_id}`,fit:"contain",style:{height:"95%"},onError:c[0]||(c[0]=k=>t.value=!1),"loading-show-delay":"800"},null,8,["src"])):(n(),y(ce,{key:1})),m(S,{position:"top-left",class:"q-ma-lg"},{default:v(()=>[u.value?(n(),s("img",{key:0,src:u.value,alt:"Abort",class:"q-mr-sm",onClick:c[1]||(c[1]=k=>w()),style:{cursor:"pointer","max-width":"150px","max-height":"150px"}},null,8,Ee)):(n(),y(M,{key:1,id:"layout-button-back",color:"grey",rounded:"","no-caps":"",onClick:c[2]||(c[2]=k=>w()),class:"action-button glass-effect"},{default:v(()=>[m(T,{left:"",name:"sym_o_cancel"}),_("div",null,E(h.$t("MSG_APPROVE_COLLAGE_ITEM_CANCEL_COLLAGE")),1)]),_:1}))]),_:1}),m(S,{position:"bottom",class:"q-ma-lg"},{default:v(()=>[_("div",Ie,[_("div",Me,[m(le,{color:"grey-8",class:"q-mr-xs"},{default:v(()=>[m(T,{name:"sym_o_tag",color:"white",class:"q-mr-xs"}),V(" "+E(h.$t("LABEL_ELEMENT_X_OF_Y",{no:g.number_captures_taken,total:g.total_captures_to_take})),1)]),_:1})]),_("div",Te,[r.value?(n(),s("img",{key:0,src:r.value,alt:"Retake",class:"action-button-image q-mr-lg",onClick:c[3]||(c[3]=k=>a()),style:{cursor:"pointer","max-width":"150px","max-height":"150px"}},null,8,Be)):(n(),y(M,{key:1,id:"item-approval-button-reject",stack:"",rounded:"",class:"q-mr-lg action-button col-auto glass-effect",color:"negative","no-caps":"",icon:"sym_o_thumb_down",label:h.$t("MSG_APPROVE_COLLAGE_ITEM_RETRY"),onClick:c[4]||(c[4]=k=>a())},null,8,["label"])),p.value?(n(),s("img",{key:2,src:p.value,alt:"Next",class:"action-button-image q-mr-sm",onClick:c[5]||(c[5]=k=>b()),style:{cursor:"pointer","max-width":"150px","max-height":"150px"}},null,8,Ae)):(n(),y(M,{key:3,id:"item-approval-button-approve",stack:"",rounded:"",class:"q-mr-sm action-button col-auto glass-effect",color:"positive","no-caps":"",icon:"sym_o_thumb_up",label:h.$t("MSG_APPROVE_COLLAGE_ITEM_APPROVE"),onClick:c[6]||(c[6]=k=>b())},null,8,["label"]))])])]),_:1})]))}}),Pe={key:1,class:"full-height full-width column justify-center content-center",style:{position:"absolute"}},Le={key:2,id:"frontpage-countdown",class:"full-height full-width column justify-center content-center",style:{position:"absolute"}},qe=["innerHTML"],Oe={key:4},Re={key:0},Ge={key:0},Qe={class:"q-gutter-md"},je=["src"],Fe={class:"gt-sm"},He={key:0},ze={class:"q-gutter-md"},Ve=["src"],De={class:"gt-sm"},nt=A({__name:"IndexPage",setup(g){const t=te(),e=W(),u=ae(),r=L(0);console.log("gallery image string:",e.configuration.uisettings.gallery_image_string),ne(r,()=>{r.value>=5&&u.push("/admin"),r.value=0},{debounce:500});const p=x(()=>{const o=[];return Object.entries(e.configuration.actions).forEach(([l,d])=>{d.forEach((C,q)=>{const O={action:`actions/${l}`,config_index:q,show_button:C.trigger.ui_trigger.show_button,title:C.trigger.ui_trigger.title,icon:C.trigger.ui_trigger.icon,use_custom_color:C.trigger.ui_trigger.use_custom_color,custom_color:C.trigger.ui_trigger.custom_color,image_path:C.trigger.ui_trigger.image_path};o.push(O)})}),o}),b=x(()=>e.configuration.uisettings.admin_button_invisible),a=x(()=>{const o=e.configuration.uisettings.enable_livestream_when_idle,l=e.configuration.uisettings.enable_livestream_when_active,d=t.isStateIdle,C=t.isStateRecording,q=t.isStateCountdown,O=t.isStateCapture;return d&&o||(q||O)&&l||C}),w=ie(a,500),h=x(()=>{const o=G.get(t.jobmodel.configuration_set,"processing.img_frame_enable",!1),l=G.get(t.jobmodel.configuration_set,"processing.img_frame_file","");return t.isStateCountdown&&o?l:t.isStateIdle&&e.configuration.uisettings.enable_livestream_frameoverlay?e.configuration.uisettings.livestream_frameoverlay_image:""}),c=()=>{b.value?r.value++:u.push("/admin")},k=(o,l)=>{B(`/api/${o}/${l}`)},I=()=>{B("/api/processing/next")};return(o,l)=>(n(),y(oe,{id:"index-page",class:"q-pa-none full-height"},{default:v(()=>[i(w)?(n(),y(Se,{key:0,index_device:i(e).configuration.backends.index_backend_video,"frame-overlay-image":h.value,"enable-blurred-background-stream":i(e).configuration.uisettings.livestream_blurredbackground,"enable-mirror-effect-stream":i(e).configuration.uisettings.livestream_mirror_effect,"enable-mirror-effect-frame":i(e).configuration.uisettings.livestream_frameoverlay_mirror_effect,"blurredbackground-high-framerate":i(e).configuration.uisettings.livestream_blurredbackground_high_framerate},null,8,["index_device","frame-overlay-image","enable-blurred-background-stream","enable-mirror-effect-stream","enable-mirror-effect-frame","blurredbackground-high-framerate"])):f("",!0),i(t).isStateProcessing?(n(),s("div",Pe,[m(me,{size:"20em"})])):f("",!0),i(t).isStateCountdown?(n(),s("div",Le,[m(ve,{ref:"countdowntimer",duration:i(t).jobmodel.duration,"message-duration":i(e).configuration.uisettings.TAKEPIC_MSG_TIME,"message-text":i(e).configuration.uisettings.TAKEPIC_MSG_TEXT},null,8,["duration","message-duration","message-text"])])):f("",!0),i(t).isStateIdle?(n(),s("div",{key:3,id:"frontpage_text",innerHTML:i(e).configuration.uisettings.FRONTPAGE_TEXT},null,8,qe)):f("",!0),i(t).isStateApproval?(n(),s("div",Oe,[m(Ne,{approval_id:i(t).jobmodel.approval_id,number_captures_taken:i(t).jobmodel.number_captures_taken,total_captures_to_take:i(t).jobmodel.total_captures_to_take},null,8,["approval_id","number_captures_taken","total_captures_to_take"])])):f("",!0),m(S,{position:"bottom",class:"q-mb-lg"},{default:v(()=>[i(t).isStateIdle?(n(),s("div",Re,[m(we,{triggers:p.value,onTriggerAction:k},null,8,["triggers"])])):f("",!0)]),_:1}),m(S,{position:"top-left",class:"q-ma-lg"},{default:v(()=>[i(t).isStateIdle?(n(),s("div",Ge,[_("div",Qe,[i(e).configuration.uisettings.show_gallery_on_frontpage?(n(),s("div",{key:0,id:"frontpage-button-to-gallery",class:"action-button glass-effect",onClick:l[0]||(l[0]=d=>o.$router.push("/gallery")),style:{cursor:"pointer"}},[i(e).configuration.uisettings.gallery_image_string?(n(),s("img",{key:0,src:i(e).configuration.uisettings.gallery_image_string,alt:"Gallery",style:{"max-height":"150px","max-width":"150px","object-fit":"contain"}},null,8,je)):(n(),s(D,{key:1},[m(T,{left:"",name:"sym_o_photo_library"}),_("div",Fe,E(o.$t("BTN_LABEL_MAINPAGE_TO_GALLERY")),1)],64))])):f("",!0)])])):f("",!0)]),_:1}),m(S,{position:"top-right",class:"q-ma-lg"},{default:v(()=>[i(t).isStateIdle?(n(),s("div",He,[_("div",ze,[i(e).configuration.uisettings.show_admin_on_frontpage&&i(e).configuration.uisettings.admin_button_image_string?(n(),s("img",{key:0,src:i(e).configuration.uisettings.admin_button_image_string,alt:"Admin",class:$(["q-mr-sm action-button-admin glass-effect",{"action-button-admin-invisible":b.value}]),onClick:c,style:{cursor:"pointer","max-width":"150px","max-height":"150px"}},null,10,Ve)):i(e).configuration.uisettings.show_admin_on_frontpage?(n(),y(M,{key:1,id:"frontpage-button-to-admin",rounded:"",color:"transparent","no-caps":"",class:$(["action-button action-button-admin glass-effect",{"action-button-admin-invisible":b.value}]),onClick:c},{default:v(()=>[m(T,{left:"",name:"sym_o_admin_panel_settings"}),_("div",De,E(o.$t("BTN_LABEL_MAINPAGE_TO_ADMIN")),1)]),_:1},8,["class"])):f("",!0)])])):f("",!0)]),_:1}),i(t).isStateRecording?(n(),y(S,{key:5,id:"frontpage-indicator-recording",position:"top-right",offset:[25,25],align:"center"},{default:v(()=>[m(ge,{color:"red",size:"12em",thickness:"20"})]),_:1})):f("",!0),i(t).isStateRecording?(n(),y(S,{key:6,id:"frontpage-indicator-stop-recording",position:"bottom",offset:[0,25],align:"center"},{default:v(()=>[m(M,{stack:"",rounded:"","no-caps":"",color:"negative",class:"action-button glass-effect",onClick:l[1]||(l[1]=d=>I())},{default:v(()=>[m(T,{name:"sym_o_stop_circle"}),_("div",null,E(o.$t("Stop recording")),1)]),_:1})]),_:1})):f("",!0)]),_:1}))}});export{nt as default};
