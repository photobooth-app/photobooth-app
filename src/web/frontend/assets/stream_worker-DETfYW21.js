(function(){"use strict";function Ot(t){const e=Object.create(null);for(const r of t.split(","))e[r]=1;return r=>r in e}const Mt=Object.assign,Pt=Object.prototype.hasOwnProperty,X=(t,e)=>Pt.call(t,e),M=Array.isArray,D=t=>it(t)==="[object Map]",jt=t=>typeof t=="function",Bt=t=>typeof t=="string",P=t=>typeof t=="symbol",j=t=>t!==null&&typeof t=="object",At=Object.prototype.toString,it=t=>At.call(t),Et=t=>it(t).slice(8,-1),U=t=>Bt(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,B=(t,e)=>!Object.is(t,e);let Kt,at=0,z;function $(){at++}function G(){if(--at>0)return;let t;for(;z;){let e=z;for(z=void 0;e;){const r=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(o){t||(t=o)}e=r}}if(t)throw t}let F=!0;const ct=[];function Wt(){ct.push(F),F=!1}function Ct(){const t=ct.pop();F=t===void 0?!0:t}class lt{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){}trigger(e){this.version++,this.notify(e)}notify(e){$();try{for(let r=this.subs;r;r=r.prevSub)r.sub.notify()&&r.sub.dep.notify()}finally{G()}}}const q=new WeakMap,T=Symbol(""),V=Symbol(""),A=Symbol("");function _(t,e,r){if(F&&Kt){let o=q.get(t);o||q.set(t,o=new Map);let n=o.get(r);n||(o.set(r,n=new lt),n.map=o,n.key=r),n.track()}}function y(t,e,r,o,n,s){const i=q.get(t);if(!i)return;const a=c=>{c&&c.trigger()};if($(),e==="clear")i.forEach(a);else{const c=M(t),l=c&&U(r);if(c&&r==="length"){const h=Number(o);i.forEach((d,f)=>{(f==="length"||f===A||!P(f)&&f>=h)&&a(d)})}else switch((r!==void 0||i.has(void 0))&&a(i.get(r)),l&&a(i.get(A)),e){case"add":c?l&&a(i.get("length")):(a(i.get(T)),D(t)&&a(i.get(V)));break;case"delete":c||(a(i.get(T)),D(t)&&a(i.get(V)));break;case"set":D(t)&&a(i.get(T));break}}G()}function O(t){const e=u(t);return e===t?e:(_(e,"iterate",A),S(t)?e:e.map(v))}function J(t){return _(t=u(t),"iterate",A),t}function x(t,e){return R(t)?mt(t)?K(v(e)):K(e):v(e)}const Dt={__proto__:null,[Symbol.iterator](){return Q(this,Symbol.iterator,t=>x(this,t))},concat(...t){return O(this).concat(...t.map(e=>M(e)?O(e):e))},entries(){return Q(this,"entries",t=>(t[1]=x(this,t[1]),t))},every(t,e){return b(this,"every",t,e,void 0,arguments)},filter(t,e){return b(this,"filter",t,e,r=>r.map(o=>x(this,o)),arguments)},find(t,e){return b(this,"find",t,e,r=>x(this,r),arguments)},findIndex(t,e){return b(this,"findIndex",t,e,void 0,arguments)},findLast(t,e){return b(this,"findLast",t,e,r=>x(this,r),arguments)},findLastIndex(t,e){return b(this,"findLastIndex",t,e,void 0,arguments)},forEach(t,e){return b(this,"forEach",t,e,void 0,arguments)},includes(...t){return Z(this,"includes",t)},indexOf(...t){return Z(this,"indexOf",t)},join(t){return O(this).join(t)},lastIndexOf(...t){return Z(this,"lastIndexOf",t)},map(t,e){return b(this,"map",t,e,void 0,arguments)},pop(){return E(this,"pop")},push(...t){return E(this,"push",t)},reduce(t,...e){return ut(this,"reduce",t,e)},reduceRight(t,...e){return ut(this,"reduceRight",t,e)},shift(){return E(this,"shift")},some(t,e){return b(this,"some",t,e,void 0,arguments)},splice(...t){return E(this,"splice",t)},toReversed(){return O(this).toReversed()},toSorted(t){return O(this).toSorted(t)},toSpliced(...t){return O(this).toSpliced(...t)},unshift(...t){return E(this,"unshift",t)},values(){return Q(this,"values",t=>x(this,t))}};function Q(t,e,r){const o=J(t),n=o[e]();return o!==t&&!S(t)&&(n._next=n.next,n.next=()=>{const s=n._next();return s.done||(s.value=r(s.value)),s}),n}const Ft=Array.prototype;function b(t,e,r,o,n,s){const i=J(t),a=i!==t&&!S(t),c=i[e];if(c!==Ft[e]){const d=c.apply(t,s);return a?v(d):d}let l=r;i!==t&&(a?l=function(d,f){return r.call(this,x(t,d),f,t)}:r.length>2&&(l=function(d,f){return r.call(this,d,f,t)}));const h=c.call(i,l,o);return a&&n?n(h):h}function ut(t,e,r,o){const n=J(t);let s=r;return n!==t&&(S(t)?r.length>3&&(s=function(i,a,c){return r.call(this,i,a,c,t)}):s=function(i,a,c){return r.call(this,i,x(t,a),c,t)}),n[e](s,...o)}function Z(t,e,r){const o=u(t);_(o,"iterate",A);const n=o[e](...r);return(n===-1||n===!1)&&kt(r[0])?(r[0]=u(r[0]),o[e](...r)):n}function E(t,e,r=[]){Wt(),$();const o=u(t)[e].apply(t,r);return G(),Ct(),o}const Ht=Ot("__proto__,__v_isRef,__isVue"),ft=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(P));function Yt(t){P(t)||(t=String(t));const e=u(this);return _(e,"has",t),e.hasOwnProperty(t)}class ht{constructor(e=!1,r=!1){this._isReadonly=e,this._isShallow=r}get(e,r,o){if(r==="__v_skip")return e.__v_skip;const n=this._isReadonly,s=this._isShallow;if(r==="__v_isReactive")return!n;if(r==="__v_isReadonly")return n;if(r==="__v_isShallow")return s;if(r==="__v_raw")return o===(n?s?Jt:_t:s?Vt:pt).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(o)?e:void 0;const i=M(e);if(!n){let c;if(i&&(c=Dt[r]))return c;if(r==="hasOwnProperty")return Yt}const a=Reflect.get(e,r,I(e)?e:o);if((P(r)?ft.has(r):Ht(r))||(n||_(e,"get",r),s))return a;if(I(a)){const c=i&&U(r)?a:a.value;return n&&j(c)?tt(c):c}return j(a)?n?tt(a):wt(a):a}}class Nt extends ht{constructor(e=!1){super(!1,e)}set(e,r,o,n){let s=e[r];const i=M(e)&&U(r);if(!this._isShallow){const l=R(s);if(!S(o)&&!R(o)&&(s=u(s),o=u(o)),!i&&I(s)&&!I(o))return l||(s.value=o),!0}const a=i?Number(r)<e.length:X(e,r),c=Reflect.set(e,r,o,I(e)?e:n);return e===u(n)&&(a?B(o,s)&&y(e,"set",r,o):y(e,"add",r,o)),c}deleteProperty(e,r){const o=X(e,r);e[r];const n=Reflect.deleteProperty(e,r);return n&&o&&y(e,"delete",r,void 0),n}has(e,r){const o=Reflect.has(e,r);return(!P(r)||!ft.has(r))&&_(e,"has",r),o}ownKeys(e){return _(e,"iterate",M(e)?"length":T),Reflect.ownKeys(e)}}class Lt extends ht{constructor(e=!1){super(!0,e)}set(e,r){return!0}deleteProperty(e,r){return!0}}const Xt=new Nt,Ut=new Lt,k=t=>t,H=t=>Reflect.getPrototypeOf(t);function zt(t,e,r){return function(...o){const n=this.__v_raw,s=u(n),i=D(s),a=t==="entries"||t===Symbol.iterator&&i,c=t==="keys"&&i,l=n[t](...o),h=r?k:e?K:v;return!e&&_(s,"iterate",c?V:T),{next(){const{value:d,done:f}=l.next();return f?{value:d,done:f}:{value:a?[h(d[0]),h(d[1])]:h(d),done:f}},[Symbol.iterator](){return this}}}}function Y(t){return function(...e){return t==="delete"?!1:t==="clear"?void 0:this}}function $t(t,e){const r={get(n){const s=this.__v_raw,i=u(s),a=u(n);t||(B(n,a)&&_(i,"get",n),_(i,"get",a));const{has:c}=H(i),l=e?k:t?K:v;if(c.call(i,n))return l(s.get(n));if(c.call(i,a))return l(s.get(a));s!==i&&s.get(n)},get size(){const n=this.__v_raw;return!t&&_(u(n),"iterate",T),n.size},has(n){const s=this.__v_raw,i=u(s),a=u(n);return t||(B(n,a)&&_(i,"has",n),_(i,"has",a)),n===a?s.has(n):s.has(n)||s.has(a)},forEach(n,s){const i=this,a=i.__v_raw,c=u(a),l=e?k:t?K:v;return!t&&_(c,"iterate",T),a.forEach((h,d)=>n.call(s,l(h),l(d),i))}};return Mt(r,t?{add:Y("add"),set:Y("set"),delete:Y("delete"),clear:Y("clear")}:{add(n){!e&&!S(n)&&!R(n)&&(n=u(n));const s=u(this);return H(s).has.call(s,n)||(s.add(n),y(s,"add",n,n)),this},set(n,s){!e&&!S(s)&&!R(s)&&(s=u(s));const i=u(this),{has:a,get:c}=H(i);let l=a.call(i,n);l||(n=u(n),l=a.call(i,n));const h=c.call(i,n);return i.set(n,s),l?B(s,h)&&y(i,"set",n,s):y(i,"add",n,s),this},delete(n){const s=u(this),{has:i,get:a}=H(s);let c=i.call(s,n);c||(n=u(n),c=i.call(s,n)),a&&a.call(s,n);const l=s.delete(n);return c&&y(s,"delete",n,void 0),l},clear(){const n=u(this),s=n.size!==0,i=n.clear();return s&&y(n,"clear",void 0,void 0),i}}),["keys","values","entries",Symbol.iterator].forEach(n=>{r[n]=zt(n,t,e)}),r}function dt(t,e){const r=$t(t,e);return(o,n,s)=>n==="__v_isReactive"?!t:n==="__v_isReadonly"?t:n==="__v_raw"?o:Reflect.get(X(r,n)&&n in o?r:o,n,s)}const Gt={get:dt(!1,!1)},qt={get:dt(!0,!1)},pt=new WeakMap,Vt=new WeakMap,_t=new WeakMap,Jt=new WeakMap;function Qt(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Zt(t){return t.__v_skip||!Object.isExtensible(t)?0:Qt(Et(t))}function wt(t){return R(t)?t:gt(t,!1,Xt,Gt,pt)}function tt(t){return gt(t,!0,Ut,qt,_t)}function gt(t,e,r,o,n){if(!j(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const s=Zt(t);if(s===0)return t;const i=n.get(t);if(i)return i;const a=new Proxy(t,s===2?o:r);return n.set(t,a),a}function mt(t){return R(t)?mt(t.__v_raw):!!(t&&t.__v_isReactive)}function R(t){return!!(t&&t.__v_isReadonly)}function S(t){return!!(t&&t.__v_isShallow)}function kt(t){return t?!!t.__v_raw:!1}function u(t){const e=t&&t.__v_raw;return e?u(e):t}const v=t=>j(t)?wt(t):t,K=t=>j(t)?tt(t):t;function I(t){return t?t.__v_isRef===!0:!1}function te(t){return ee(t,!1)}function ee(t,e){return I(t)?t:new ne(t,e)}class ne{constructor(e,r){this.dep=new lt,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=r?e:u(e),this._value=r?e:v(e),this.__v_isShallow=r}get value(){return this.dep.track(),this._value}set value(e){const r=this._rawValue,o=this.__v_isShallow||S(e)||R(e);e=o?e:u(e),B(e,r)&&(this._rawValue=e,this._value=o?e:v(e),this.dep.trigger())}}function re(t){return I(t)?t.value:t}function se(t){return jt(t)?t():re(t)}typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const bt=()=>{};function oe(t,e){function r(...o){return new Promise((n,s)=>{Promise.resolve(t(()=>e.apply(this,o),{fn:e,thisArg:this,args:o})).then(n).catch(s)})}return r}function ie(...t){let e=0,r,o=!0,n=bt,s,i,a,c,l;!I(t[0])&&typeof t[0]=="object"?{delay:i,trailing:a=!0,leading:c=!0,rejectOnCancel:l=!1}=t[0]:[i,a=!0,c=!0,l=!1]=t;const h=()=>{r&&(clearTimeout(r),r=void 0,n(),n=bt)};return f=>{const p=se(i),g=Date.now()-e,L=()=>s=f();return h(),p<=0?(e=Date.now(),L()):(g>p?(e=Date.now(),(c||!o)&&L()):a&&(s=new Promise((Tt,pe)=>{n=l?pe:Tt,r=setTimeout(()=>{e=Date.now(),o=!0,Tt(L()),h()},Math.max(0,p-g))})),!c&&!r&&(r=setTimeout(()=>o=!0,p)),o=!1,s)}}function ae(t,e=200,r=!1,o=!0,n=!1){return oe(ie(e,r,o,n),t)}let et,nt,vt,yt,W=null;const xt=te(500);let N=null,w=null,m=null,rt=0,st=0,ot=0,Rt=performance.now(),C=[];self.onmessage=async t=>{t.data.type==="init"?(et=t.data.canvases.stream,nt=t.data.canvases.blurred,vt=et.getContext("2d",{alpha:!0}),yt=nt.getContext("2d",{alpha:!0}),xt.value=t.data.blurredbackgroundHighFramerate===!0?50:300):t.data.type==="frame"?(W&&ot++,W=t.data.payload,le()):t.data.type==="overlay"&&(N=t.data.url,console.log(N),N?ue(N):w=null)};const St=(t,e,r)=>{const o=w?w.width:r.width,n=w?w.height:r.height;if((t.width!==o||t.height!==n)&&(t.width=o,t.height=n,console.log(`set canvas size to ${o}x${n}`)),w&&m){const{drawW:s,drawH:i,offsetX:a,offsetY:c}=fe(r.width,r.height,m.w,m.h);e.drawImage(r,m.x+a,m.y+c,s,i),e.drawImage(w,0,0),e.strokeStyle="red",e.lineWidth=2,e.strokeRect(m.x,m.y,m.w,m.h)}else e.drawImage(r,0,0)},ce=ae((t,e,r)=>{St(t,e,r),st++},xt);async function le(){if(!W)return;const t=W;try{const e=performance.now(),r=new Blob([t],{type:"image/jpeg"}),o=await createImageBitmap(r);St(et,vt,o),rt++,ce(nt,yt,o),o.close();const n=performance.now();C.push(n-e)}catch(e){console.error(e),console.error("Decode error:",e)}finally{W=null,de()}}async function ue(t){const e=performance.now();let r,o;try{const i=await(await fetch(t)).blob();w=await createImageBitmap(i),r=performance.now(),m=await It(w)}catch(s){console.error("Overlay load error:",s),w=null}const n=performance.now();console.log("load overlay took ",(r-e).toFixed(1),"ms and calc transparency took ",(n-r).toFixed(1),"ms"),o=performance.now(),console.warn(await It(w)),console.log("computeTransparentBoundingBoxScaleNorefine took ",(performance.now()-o).toFixed(1),"ms"),o=performance.now(),console.warn(await he(w)),console.log("computeTransparentBoundingBoxScaleNorefineU32 took ",(performance.now()-o).toFixed(1),"ms")}function fe(t,e,r,o){const n=Math.max(r/t,o/e),s=t*n,i=e*n,a=(r-s)/2,c=(o-i)/2;return{drawW:s,drawH:i,offsetX:a,offsetY:c}}async function It(t,e=4){const{width:r,height:o}=t,n=Math.ceil(r/e),s=Math.ceil(o/e),i=new OffscreenCanvas(n,s).getContext("2d",{willReadFrequently:!0});i.drawImage(t,0,0,n,s);const a=i.getImageData(0,0,n,s).data;let c=n,l=s,h=-1,d=-1;for(let f=0;f<s;f++)for(let p=0;p<n;p++)a[(f*n+p)*4+3]<128&&(p<c&&(c=p),f<l&&(l=f),p>h&&(h=p),f>d&&(d=f));return{x:c*e,y:l*e,w:(h-c+1)*e,h:(d-l+1)*e}}async function he(t,e=4){const{width:r,height:o}=t,n=Math.ceil(r/e),s=Math.ceil(o/e),i=new OffscreenCanvas(n,s).getContext("2d",{willReadFrequently:!0});i.drawImage(t,0,0,n,s);const a=i.getImageData(0,0,n,s).data,c=new Uint32Array(a.buffer);let l=n,h=s,d=-1,f=-1;for(let p=0;p<s;p++)for(let g=0;g<n;g++)(c[p*n+g]>>>24&255)<128&&(g<l&&(l=g),p<h&&(h=p),g>d&&(d=g),p>f&&(f=p));return{x:l*e,y:h*e,w:(d-l+1)*e,h:(f-h+1)*e}}function de(){const t=performance.now();if(t-Rt>=1e3){const e=rt,r=st,o=C.length?C.reduce((n,s)=>n+s,0)/C.length:0;self.postMessage({type:"stats",fpsPlain:e,fpsAug:r,dropped:ot,avgDecode:o.toFixed(1)}),rt=st=ot=0,C=[],Rt=t}}})();
