import{x as Q,y as G,z as F,A as j,d as $,B as A,c as y,l as H,o as V,C as I,D as B,b as g,f as i,E as l,q as r,p as d,F as D,G as k,H as W,I as U,n as b,s as u,v as o,J as P,Q as C,K,L as x,M as E,N as X,m as Y,O as J,r as M,g as Z,h as ee,P as te,R as ae,k as ne,_ as q}from"./index-BlfnQ2om.js";import{Q as w}from"./QPageSticky-9Ifr4ES8.js";import{Q as oe}from"./QPage-jrMEU8Wd.js";import{Q as ie}from"./QCircularProgress-BOvcND0W.js";import{Q as re}from"./QImg-DOFe8yrD.js";import{Q as se}from"./QBadge-BbP7wYn2.js";import{I as le}from"./ItemNotAvailableError-CmQmr0uY.js";import"./format-CJebrXOQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ce='<circle cx="12.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="0s" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="52.5" r="12.5" fill-opacity=".5"><animate attributeName="fill-opacity" begin="100ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="300ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="600ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="800ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="400ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="700ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="500ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="200ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle>',ue=Q({name:"QSpinnerGrid",props:G,setup(c){const{cSize:e,classes:t}=F(c);return()=>j("svg",{class:t.value,fill:"currentColor",width:e.value,height:e.value,viewBox:"0 0 105 105",xmlns:"http://www.w3.org/2000/svg",innerHTML:ce})}}),de='<g fill="none" fill-rule="evenodd" stroke-width="2"><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="0s" dur="1.8s" values="1; 20" calcMode="spline" keyTimes="0; 1" keySplines="0.165, 0.84, 0.44, 1" repeatCount="indefinite"></animate><animate attributeName="stroke-opacity" begin="0s" dur="1.8s" values="1; 0" calcMode="spline" keyTimes="0; 1" keySplines="0.3, 0.61, 0.355, 1" repeatCount="indefinite"></animate></circle><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="-0.9s" dur="1.8s" values="1; 20" calcMode="spline" keyTimes="0; 1" keySplines="0.165, 0.84, 0.44, 1" repeatCount="indefinite"></animate><animate attributeName="stroke-opacity" begin="-0.9s" dur="1.8s" values="1; 0" calcMode="spline" keyTimes="0; 1" keySplines="0.3, 0.61, 0.355, 1" repeatCount="indefinite"></animate></circle></g>',me=Q({name:"QSpinnerPuff",props:G,setup(c){const{cSize:e,classes:t}=F(c);return()=>j("svg",{class:t.value,stroke:"currentColor",width:e.value,height:e.value,viewBox:"0 0 44 44",xmlns:"http://www.w3.org/2000/svg",innerHTML:de})}}),ge={id:"countdown-timer-container",class:"flex flex-center",style:{width:"70vw",height:"70vh"}},pe=["innerHTML"],_e={style:{height:"100%"}},fe=$({__name:"CountdownTimer",props:{duration:{},messageDuration:{default:.5},messageText:{default:"ðŸ˜ƒ"}},setup(c){let e;const t=A(0),s=A(0),m=c,p=y(()=>t.value>0),a=y(()=>t.value>0),n=y(()=>t.value<=m.messageDuration);H(()=>{S()}),V(()=>{_()});const _=()=>{clearInterval(e),t.value=0},S=()=>{s.value=m.duration,t.value=s.value,console.log(`starting timer, duration=${s.value}`),e=window.setInterval(()=>{t.value-=.05,t.value<=0&&clearInterval(e)},50)};return(O,R)=>I((i(),g("div",ge,[I(l("div",{id:"countdown-timer-message",style:{position:"absolute","font-size":"150px"},innerHTML:c.messageText},null,8,pe),[[B,n.value]]),l("div",_e,[I(r(ie,{id:"countdown-circular-progress","show-value":!n.value,style:{width:"100%",height:"100%","text-shadow":"#222 0 0 10px","font-weight":"bold",opacity:"85%"},value:t.value,min:0,max:s.value,reverse:"","animation-speed":"100","font-size":"0.5em",size:"70vh",color:"secondary",class:"text-secondary",thickness:.16},{default:d(()=>[D(k(parseFloat(t.value.toFixed(0))),1)]),_:1},8,["show-value","value","max"]),[[B,a.value]])])],512)),[[B,p.value]])}}),ve={class:"row q-gutter-md action-buttons"},be={style:{"white-space":"nowrap"},class:"gt-sm"},ye=$({__name:"FrontpageTriggerButtons",props:{triggers:{}},emits:["triggerAction"],setup(c,{emit:e}){const t=e;function s(m,p){t("triggerAction",m,p)}return(m,p)=>(i(),g("div",ve,[(i(!0),g(W,null,U(c.triggers,(a,n)=>(i(),g("div",{key:n},[a.show_button&&!(o(P.isEmpty)(a.title)&&o(P.isEmpty)(a.icon))?(i(),b(C,{key:0,stack:"",color:a.use_custom_color?"custom":"primary","no-caps":"",rounded:"",class:x(["action-button col-auto glass-effect",["action-button-"+n]]),style:K({"--bg-custom":a.use_custom_color?a.custom_color:null}),onClick:_=>s(a.action,a.config_index)},{default:d(()=>[o(P.isEmpty)(a.icon)?u("",!0):(i(),b(E,{key:0,name:`sym_o_${a.icon}`},null,8,["name"])),l("div",be,k(a.title),1)]),_:2},1032,["color","class","style","onClick"])):u("",!0)]))),128))]))}}),he={id:"preview-container",class:""},we={id:"preview-outer-container",class:"preview-center-element"},ke=["src"],Ce=$({__name:"PreviewStream",props:{index_device:{},enableMirrorEffectStream:{type:Boolean},enableMirrorEffectFrame:{type:Boolean},enableBlurredBackgroundStream:{type:Boolean},blurredbackgroundHighFramerate:{type:Boolean},frameOverlayImage:{}},setup(c){const e=c,t=`${location.protocol==="https:"?"wss":"ws"}://${location.host}/api/aquisition/stream?index_device=${e.index_device}&index_subdevice=0`,s=new Worker(new URL("/assets/stream_worker-BENnsRJg.js",import.meta.url),{type:"module"});s.onmessage=n=>{n.data.type==="stats"&&console.log(`FPS plain=${n.data.fpsPlain}, augmented=${n.data.fpsAug}, dropped=${n.data.dropped}, avgDecode=${n.data.avgDecode}ms`)};const{open:m,close:p}=X(t,{immediate:!1,autoReconnect:{retries:-1,delay:1e3},onConnected(n){n.binaryType="arraybuffer",console.log("stream connected via websocket");const _=document.getElementById("preview-inner-stream").transferControlToOffscreen(),S=document.getElementById("preview-outer-blurred").transferControlToOffscreen();s.postMessage({type:"init",canvases:{plain:_,aug:S},blurredbackgroundHighFramerate:e.blurredbackgroundHighFramerate},[_,S])},onDisconnected(){console.log("stream disconnected from websocket")},async onMessage(n,_){document.hidden||s.postMessage({type:"frame",payload:_.data},[_.data])}}),a=y(()=>e.frameOverlayImage??!0);return H(()=>{console.log("preview stream mounted!");const n=document.getElementById("preview-inner-overlay");n&&(n.onload=function(){console.log(n.naturalWidth/n.naturalHeight);const _=document.getElementById("preview-inner-container");_.style.aspectRatio=Number(n.naturalWidth/n.naturalHeight).toFixed(4)}),m()}),Y(()=>{p(),s.terminate(),console.log("preview stream unmounted!")}),(n,_)=>(i(),g("div",he,[e.enableBlurredBackgroundStream?(i(),g("canvas",{key:0,id:"preview-outer-blurred",class:x(["preview-center-element",{mirroreffect:e.enableMirrorEffectStream}])},null,2)):u("",!0),l("div",we,[l("div",{id:"preview-inner-container",class:x(["preview-center-element",{"stream-no-preview":!a.value}])},[l("canvas",{id:"preview-inner-stream",class:x(["preview-center-element",{mirroreffect:e.enableMirrorEffectStream,cover:a.value,contain:!a.value}])},null,2),I(l("img",{id:"preview-inner-overlay",class:x(["preview-center-element contain",{mirroreffect:e.enableMirrorEffectFrame}]),src:e.frameOverlayImage},null,10,ke),[[B,a.value]])],2)])]))}}),Se={id:"itemapproval-dialog",class:"absolute-full flex flex-center"},xe={class:"q-mb-lg action-buttons col"},Ee={class:"q-mb-sm row flex flex-center"},Me={class:"row"},$e=$({__name:"MediaItemApprovalViewer",props:{approval_id:{},number_captures_taken:{},total_captures_to_take:{}},setup(c){const e=A(!0);J(()=>{e.value=!0});const t=()=>{M("/api/processing/confirm")},s=()=>{M("/api/processing/reject")},m=()=>{M("/api/processing/abort")};return(p,a)=>(i(),g("div",Se,[e.value?(i(),b(re,{key:0,draggable:!1,loading:"eager",src:`/api/processing/approval/${c.approval_id}`,fit:"contain",style:{height:"95%"},onError:a[0]||(a[0]=n=>e.value=!1),"loading-show-delay":"800"},null,8,["src"])):(i(),b(le,{key:1})),r(w,{position:"top-left",class:"q-ma-lg"},{default:d(()=>[r(C,{id:"layout-button-back",color:"grey",rounded:"","no-caps":"",onClick:a[1]||(a[1]=n=>m()),class:"action-button glass-effect"},{default:d(()=>[r(E,{left:"",name:"sym_o_cancel"}),l("div",null,k(p.$t("MSG_APPROVE_COLLAGE_ITEM_CANCEL_COLLAGE")),1)]),_:1})]),_:1}),r(w,{position:"bottom",class:"q-ma-lg"},{default:d(()=>[l("div",xe,[l("div",Ee,[r(se,{color:"grey-8",class:"q-mr-xs"},{default:d(()=>[r(E,{name:"sym_o_tag",color:"white",class:"q-mr-xs"}),D(" "+k(p.$t("LABEL_ELEMENT_X_OF_Y",{no:c.number_captures_taken,total:c.total_captures_to_take})),1)]),_:1})]),l("div",Me,[r(C,{id:"item-approval-button-reject",stack:"",rounded:"",class:"q-mr-lg action-button col-auto glass-effect",color:"negative","no-caps":"",icon:"sym_o_thumb_down",label:p.$t("MSG_APPROVE_COLLAGE_ITEM_RETRY"),onClick:a[2]||(a[2]=n=>s())},null,8,["label"]),r(C,{id:"item-approval-button-approve",stack:"",rounded:"",class:"q-mr-sm action-button col-auto glass-effect",color:"positive","no-caps":"",icon:"sym_o_thumb_up",label:p.$t("MSG_APPROVE_COLLAGE_ITEM_APPROVE"),onClick:a[3]||(a[3]=n=>t())},null,8,["label"])])])]),_:1})]))}}),Te={key:1,class:"full-height full-width column justify-center content-center",style:{position:"absolute"}},Ie={key:2,id:"frontpage-countdown",class:"full-height full-width column justify-center content-center",style:{position:"absolute"}},Be=["innerHTML"],Ae={key:4},Ne={key:0},Le={key:0},Pe={class:"q-gutter-md"},Oe={class:"gt-sm"},Re={key:0},qe={class:"q-gutter-md"},Qe={class:"gt-sm"},Ke=$({__name:"IndexPage",setup(c){const e=Z(),t=ee(),s=ne(),m=A(0);te(m,()=>{m.value>=5&&s.push("/admin"),m.value=0},{debounce:500});const p=y(()=>{const f=[];return Object.entries(t.configuration.actions).forEach(([v,T])=>{T.forEach((h,N)=>{const L={action:`actions/${v}`,config_index:N,show_button:h.trigger.ui_trigger.show_button,title:h.trigger.ui_trigger.title,icon:h.trigger.ui_trigger.icon,use_custom_color:h.trigger.ui_trigger.use_custom_color,custom_color:h.trigger.ui_trigger.custom_color};f.push(L)})}),f}),a=y(()=>t.configuration.uisettings.admin_button_invisible),n=y(()=>{const f=t.configuration.uisettings.enable_livestream_when_idle,v=t.configuration.uisettings.enable_livestream_when_active,T=e.isStateIdle,h=e.isStateRecording,N=e.isStateCountdown,L=e.isStateCapture;return T&&f||(N||L)&&v||h}),_=ae(n,500),S=y(()=>{const f=q.get(e.jobmodel.configuration_set,"processing.img_frame_enable",!1),v=q.get(e.jobmodel.configuration_set,"processing.img_frame_file","");return e.isStateCountdown&&f?v:e.isStateIdle&&t.configuration.uisettings.enable_livestream_frameoverlay?t.configuration.uisettings.livestream_frameoverlay_image:""}),O=()=>{a.value?m.value++:s.push("/admin")},R=(f,v)=>{M(`/api/${f}/${v}`)},z=()=>{M("/api/processing/next")};return(f,v)=>(i(),b(oe,{id:"index-page",class:"q-pa-none full-height"},{default:d(()=>[o(_)?(i(),b(Ce,{key:0,index_device:o(t).configuration.backends.index_backend_video,"frame-overlay-image":S.value,"enable-blurred-background-stream":o(t).configuration.uisettings.livestream_blurredbackground,"enable-mirror-effect-stream":o(t).configuration.uisettings.livestream_mirror_effect,"enable-mirror-effect-frame":o(t).configuration.uisettings.livestream_frameoverlay_mirror_effect,"blurredbackground-high-framerate":o(t).configuration.uisettings.livestream_blurredbackground_high_framerate},null,8,["index_device","frame-overlay-image","enable-blurred-background-stream","enable-mirror-effect-stream","enable-mirror-effect-frame","blurredbackground-high-framerate"])):u("",!0),o(e).isStateProcessing?(i(),g("div",Te,[r(ue,{size:"20em"})])):u("",!0),o(e).isStateCountdown?(i(),g("div",Ie,[r(fe,{ref:"countdowntimer",duration:o(e).jobmodel.duration,"message-duration":o(t).configuration.uisettings.TAKEPIC_MSG_TIME,"message-text":o(t).configuration.uisettings.TAKEPIC_MSG_TEXT},null,8,["duration","message-duration","message-text"])])):u("",!0),o(e).isStateIdle?(i(),g("div",{key:3,id:"frontpage_text",innerHTML:o(t).configuration.uisettings.FRONTPAGE_TEXT},null,8,Be)):u("",!0),o(e).isStateApproval?(i(),g("div",Ae,[r($e,{approval_id:o(e).jobmodel.approval_id,number_captures_taken:o(e).jobmodel.number_captures_taken,total_captures_to_take:o(e).jobmodel.total_captures_to_take},null,8,["approval_id","number_captures_taken","total_captures_to_take"])])):u("",!0),r(w,{position:"bottom",class:"q-mb-lg"},{default:d(()=>[o(e).isStateIdle?(i(),g("div",Ne,[r(ye,{triggers:p.value,onTriggerAction:R},null,8,["triggers"])])):u("",!0)]),_:1}),r(w,{position:"top-left",class:"q-ma-lg"},{default:d(()=>[o(e).isStateIdle?(i(),g("div",Le,[l("div",Pe,[o(t).configuration.uisettings.show_gallery_on_frontpage?(i(),b(C,{key:0,id:"frontpage-button-to-gallery",color:"primary","no-caps":"",rounded:"",to:"/gallery",class:"action-button glass-effect"},{default:d(()=>[r(E,{left:"",name:"sym_o_photo_library"}),l("div",Oe,k(f.$t("BTN_LABEL_MAINPAGE_TO_GALLERY")),1)]),_:1})):u("",!0)])])):u("",!0)]),_:1}),r(w,{position:"top-right",class:"q-ma-lg"},{default:d(()=>[o(e).isStateIdle?(i(),g("div",Re,[l("div",qe,[o(t).configuration.uisettings.show_admin_on_frontpage?(i(),b(C,{key:0,id:"frontpage-button-to-admin",rounded:"",color:"transparent","no-caps":"",class:x(["action-button action-button-admin glass-effect",{"action-button-admin-invisible":a.value}]),onClick:O},{default:d(()=>[r(E,{left:"",name:"sym_o_admin_panel_settings"}),l("div",Qe,k(f.$t("BTN_LABEL_MAINPAGE_TO_ADMIN")),1)]),_:1},8,["class"])):u("",!0)])])):u("",!0)]),_:1}),o(e).isStateRecording?(i(),b(w,{key:5,id:"frontpage-indicator-recording",position:"top-right",offset:[25,25],align:"center"},{default:d(()=>[r(me,{color:"red",size:"12em",thickness:"20"})]),_:1})):u("",!0),o(e).isStateRecording?(i(),b(w,{key:6,id:"frontpage-indicator-stop-recording",position:"bottom",offset:[0,25],align:"center"},{default:d(()=>[r(C,{stack:"",rounded:"","no-caps":"",color:"negative",class:"action-button glass-effect",onClick:v[0]||(v[0]=T=>z())},{default:d(()=>[r(E,{name:"sym_o_stop_circle"}),l("div",null,k(f.$t("Stop recording")),1)]),_:1})]),_:1})):u("",!0)]),_:1}))}});export{Ke as default};
