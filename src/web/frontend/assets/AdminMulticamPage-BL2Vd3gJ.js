import{x as T,A as d,Y as N,aa as R,B as x,c as m,M as J,C as X,aY as ee,au as te,av as A,aZ as z,a_ as ae,a9 as ne,ab as le,an as re,ac as oe,X as se,d as ie,h as ue,n as E,p as l,q as a,a0 as W,E as c,Q as _,a1 as ce,v as H,r as M,Z as V,G as k,b as $,I as F,H as K,s as de,F as S,ae as U,f as w}from"./index-ByqAtz-j.js";import{Q as G}from"./QImg-Ba86Xb2U.js";import{Q as pe}from"./QMarkupTable-BrLISLPX.js";import{Q as ve}from"./QSlideTransition-CtPRXBfV.js";import{u as me,d as fe,a as ge,b as be,c as _e}from"./use-panel-C-Guk5j_.js";import{Q as he,a as L,b as j,c as I}from"./QList-DpZ-pQoM.js";import{Q as Ce}from"./QPage-Bk_upynW.js";import"./selection-DVQ8QTqA.js";const B=T({name:"QStepperNavigation",setup(e,{slots:p}){return()=>d("div",{class:"q-stepper__nav"},N(p.default))}}),Y=T({name:"StepHeader",props:{stepper:{},step:{},goToPanel:Function},setup(e,{attrs:p}){const{proxy:{$q:v}}=R(),i=x(null),r=m(()=>e.stepper.modelValue===e.step.name),f=m(()=>{const n=e.step.disable;return n===!0||n===""}),h=m(()=>{const n=e.step.error;return n===!0||n===""}),g=m(()=>{const n=e.step.done;return f.value===!1&&(n===!0||n==="")}),y=m(()=>{const n=e.step.headerNav,u=n===!0||n===""||n===void 0;return f.value===!1&&e.stepper.headerNav&&u}),q=m(()=>e.step.prefix&&(r.value===!1||e.stepper.activeIcon==="none")&&(h.value===!1||e.stepper.errorIcon==="none")&&(g.value===!1||e.stepper.doneIcon==="none")),C=m(()=>{const n=e.step.icon||e.stepper.inactiveIcon;if(r.value===!0){const u=e.step.activeIcon||e.stepper.activeIcon;return u==="none"?n:u||v.iconSet.stepper.active}if(h.value===!0){const u=e.step.errorIcon||e.stepper.errorIcon;return u==="none"?n:u||v.iconSet.stepper.error}if(f.value===!1&&g.value===!0){const u=e.step.doneIcon||e.stepper.doneIcon;return u==="none"?n:u||v.iconSet.stepper.done}return n}),s=m(()=>{const n=h.value===!0?e.step.errorColor||e.stepper.errorColor:void 0;if(r.value===!0){const u=e.step.activeColor||e.stepper.activeColor||e.step.color;return u!==void 0?u:n}return n!==void 0?n:f.value===!1&&g.value===!0?e.step.doneColor||e.stepper.doneColor||e.step.color||e.stepper.inactiveColor:e.step.color||e.stepper.inactiveColor}),t=m(()=>"q-stepper__tab col-grow flex items-center no-wrap relative-position"+(s.value!==void 0?` text-${s.value}`:"")+(h.value===!0?" q-stepper__tab--error q-stepper__tab--error-with-"+(q.value===!0?"prefix":"icon"):"")+(r.value===!0?" q-stepper__tab--active":"")+(g.value===!0?" q-stepper__tab--done":"")+(y.value===!0?" q-stepper__tab--navigation q-focusable q-hoverable":"")+(f.value===!0?" q-stepper__tab--disabled":"")),o=m(()=>e.stepper.headerNav!==!0?!1:y.value);function b(){i.value?.focus(),r.value===!1&&e.goToPanel(e.step.name)}function P(n){n.keyCode===13&&r.value===!1&&e.goToPanel(e.step.name)}return()=>{const n={class:t.value};y.value===!0&&(n.onClick=b,n.onKeyup=P,Object.assign(n,f.value===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:p.tabindex||0}));const u=[d("div",{class:"q-focus-helper",tabindex:-1,ref:i}),d("div",{class:"q-stepper__dot row flex-center q-stepper__line relative-position"},[d("span",{class:"row flex-center"},[q.value===!0?e.step.prefix:d(J,{name:C.value})])])];if(e.step.title!==void 0&&e.step.title!==null){const Q=[d("div",{class:"q-stepper__title"},e.step.title)];e.step.caption!==void 0&&e.step.caption!==null&&Q.push(d("div",{class:"q-stepper__caption"},e.step.caption)),u.push(d("div",{class:"q-stepper__label q-stepper__line relative-position"},Q))}return X(d("div",n,u),[[ee,o.value]])}}});function Z(e){return d("div",{class:"q-stepper__step-content"},[d("div",{class:"q-stepper__step-inner"},N(e.default))])}const O={setup(e,{slots:p}){return()=>Z(p)}},D=T({name:"QStep",props:{...me,icon:String,color:String,title:{type:String,required:!0},caption:String,prefix:[String,Number],doneIcon:String,doneColor:String,activeIcon:String,activeColor:String,errorIcon:String,errorColor:String,headerNav:{type:Boolean,default:!0},done:Boolean,error:Boolean,onScroll:[Function,Array]},setup(e,{slots:p,emit:v}){const{proxy:{$q:i}}=R(),r=te(z,A);if(r===A)return console.error("QStep needs to be a child of QStepper"),A;const{getCache:f}=fe(),h=x(null),g=m(()=>r.value.modelValue===e.name),y=m(()=>i.platform.is.ios!==!0&&i.platform.is.chrome===!0||g.value!==!0||r.value.vertical!==!0?{}:{onScroll(s){const{target:t}=s;t.scrollTop>0&&(t.scrollTop=0),e.onScroll!==void 0&&v("scroll",s)}}),q=m(()=>typeof e.name=="string"||typeof e.name=="number"?e.name:String(e.name));function C(){const s=r.value.vertical;return s===!0&&r.value.keepAlive===!0?d(ae,r.value.keepAliveProps.value,g.value===!0?[d(r.value.needsUniqueKeepAliveWrapper.value===!0?f(q.value,()=>({...O,name:q.value})):O,{key:q.value},p.default)]:void 0):s!==!0||g.value===!0?Z(p):void 0}return()=>d("div",{ref:h,class:"q-stepper__step",role:"tabpanel",...y.value},r.value.vertical===!0?[d(Y,{stepper:r.value,step:e,goToPanel:r.value.goToPanel}),r.value.animated===!0?d(ve,C):C()]:[C()])}}),qe=/(-\w)/g;function ye(e){const p={};for(const v in e){const i=v.replace(qe,r=>r[1].toUpperCase());p[i]=e[v]}return p}const ke=T({name:"QStepper",props:{...ne,...be,flat:Boolean,bordered:Boolean,alternativeLabels:Boolean,headerNav:Boolean,contracted:Boolean,headerClass:String,inactiveColor:String,inactiveIcon:String,doneIcon:String,doneColor:String,activeIcon:String,activeColor:String,errorIcon:String,errorColor:String},emits:ge,setup(e,{slots:p}){const v=R(),i=le(e,v.proxy.$q),{updatePanelsList:r,isValidPanelName:f,updatePanelIndex:h,getPanelContent:g,getPanels:y,panelDirectives:q,goToPanel:C,keepAliveProps:s,needsUniqueKeepAliveWrapper:t}=_e();re(z,m(()=>({goToPanel:C,keepAliveProps:s,needsUniqueKeepAliveWrapper:t,...e})));const o=m(()=>`q-stepper q-stepper--${e.vertical===!0?"vertical":"horizontal"}`+(e.flat===!0?" q-stepper--flat":"")+(e.bordered===!0?" q-stepper--bordered":"")+(i.value===!0?" q-stepper--dark q-dark":"")),b=m(()=>`q-stepper__header row items-stretch justify-between q-stepper__header--${e.alternativeLabels===!0?"alternative":"standard"}-labels`+(e.flat===!1||e.bordered===!0?" q-stepper__header--border":"")+(e.contracted===!0?" q-stepper__header--contracted":"")+(e.headerClass!==void 0?` ${e.headerClass}`:""));function P(){const n=N(p.message,[]);if(e.vertical===!0){f(e.modelValue)&&h();const u=d("div",{class:"q-stepper__content"},N(p.default));return n===void 0?[u]:n.concat(u)}return[d("div",{class:b.value},y().map(u=>{const Q=ye(u.props);return d(Y,{key:Q.name,stepper:e,step:Q,goToPanel:C})})),n,se("div",{class:"q-stepper__content q-panel-parent"},g(),"cont",e.swipeable,()=>q.value)]}return()=>(r(p),d("div",{class:o.value},oe(p.navigation,P())))}}),Se={class:"row no-wrap q-gutter-x-md"},we={style:{width:"100%","max-width":"300px"},class:"gt-sm"},xe={class:"text-h5"},Pe={class:"text-left"},Ie={class:"text-right"},Qe={class:"text-right"},$e={key:0},Be=["href"],Le=ie({__name:"AdminMulticamPage",setup(e){const p=ue(),v=x([]),i=x(1),r=x(!1),f=x(!1),h=x(!1),g=x("");async function y(){try{r.value=!0;const t=await(await U("/api/aquisition/multicam")).json();v.value.length===0?v.value=t.map(o=>[o]):t.forEach((o,b)=>v.value[b].push(o))}catch(s){console.error("Error capturing multicam images:",s)}finally{r.value=!1}}async function q(){try{h.value=!1,f.value=!0;const t=await(await U("/api/admin/multicamera/calibration",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v.value)})).json();console.log("Calibration result:",t),g.value=t,h.value=!0}catch(s){g.value=s,console.error("Error posting calibration:",s)}finally{f.value=!1}}const C=m(()=>{const s=p.configuration.backends.group_backends,t=p.configuration.backends.index_backend_multicam;if(s==null||t==null)return console.error("cannot get multicam backend from config"),[];const o=s[t].backend_config;return console.log(o),o.backend_type==="Wigglecam"?o.devices:(console.error("selected backend is not a Wigglecam"),[])});return(s,t)=>(w(),E(Ce,{id:"multicam-page",padding:""},{default:l(()=>[a(V,{flat:"",class:"q-pa-md q-mb-md"},{default:l(()=>[a(W,null,{default:l(()=>[...t[9]||(t[9]=[c("div",{class:"text-h5"},"Multicamera Tools",-1)])]),_:1}),a(W,null,{default:l(()=>[c("div",Se,[c("div",we,[a(G,{src:"/api/aquisition/stream.mjpg"})]),c("div",null,[t[10]||(t[10]=c("p",null,"ðŸ‘‹ Hey, this multicamera tool is to help you creating awesome wigglegrams.",-1)),t[11]||(t[11]=c("p",null," Wigglegrams are stills captured using a camera array. Usually 4 equal cameras are required to capture sufficient perspectives of a scene. The stills are stitched together and replayed as a GIF/Video. ",-1)),t[12]||(t[12]=c("p",null," Since the cameras, despite being the same model underly some tolerances in optics and alignment during assembly, to create smooth wigglegrams, the cameras need to be calibrated once. Please follow the steps to calibrate the cameras. ",-1)),a(_,{outline:"","no-caps":"",color:"green",href:"https://photobooth-app.org/wigglegramcamera/",target:"_blank","icon-right":"sym_o_open_in_new",label:"Learn more"})])])]),_:1}),a(ce,{class:"q-gutter-sm q-px-none",align:"right"},{default:l(()=>[a(_,{"no-caps":"",label:s.$t("Get stats"),onClick:t[0]||(t[0]=o=>H(M)("/api/admin/multicamera/calibration"))},null,8,["label"]),a(_,{"no-caps":"",outline:"",color:"red",label:s.$t("Delete calibration data"),onClick:t[1]||(t[1]=o=>H(M)("/api/admin/multicamera/calibration","DELETE"))},null,8,["label"])]),_:1})]),_:1}),a(ke,{modelValue:i.value,"onUpdate:modelValue":t[8]||(t[8]=o=>i.value=o),vertical:"",animated:"",flat:"",class:"q-pa-md q-mb-md"},{default:l(()=>[c("div",xe,k(s.$t("Calibrate")),1),a(D,{name:1,title:"Preflight check before starting the calibration",icon:"sym_o_verified",done:i.value>1},{default:l(()=>[t[14]||(t[14]=c("p",null," Following nodes are configured as multicamera backend currently. Please confirm, that the backend is setup correctly as later changes invalidate the calibration. ",-1)),a(pe,{flat:"",bordered:""},{default:l(()=>[t[13]||(t[13]=c("thead",null,[c("tr",null,[c("th",{class:"text-left"},"Device Description"),c("th",{class:"text-right"},"Index/Device-Id"),c("th",{class:"text-right"},"Address")])],-1)),c("tbody",null,[(w(!0),$(K,null,F(C.value,(o,b)=>(w(),$("tr",{key:b},[c("td",Pe,k(o.description),1),c("td",Ie,k(b),1),c("td",Qe,k(o.address),1)]))),128))])]),_:1}),a(B,{class:"q-gutter-sm"},{default:l(()=>[a(_,{"no-caps":"",onClick:t[2]||(t[2]=o=>i.value=2),color:"green",label:"Start"}),a(_,{flat:"","no-caps":"",color:"green",label:"Configure backends","icon-right":"sym_o_open_in_new",to:"/admin/config"})]),_:1})]),_:1},8,["done"]),a(D,{name:2,title:"Capture images for calibration",icon:"sym_o_camera",done:i.value>2},{default:l(()=>[t[18]||(t[18]=c("p",null," Here are the results from the last capture. Please check that the images look well, the CharuCo board is about in the center of the image and in roughly 2m distance to the camera array. ",-1)),v.value.length?(w(),$("div",$e,[(w(!0),$(K,null,F(v.value,(o,b)=>(w(),E(V,{bordered:"",flat:"",class:"q-ma-sm row items-start q-gutter-md",key:b},{default:l(()=>[(w(!0),$(K,null,F(o,(P,n)=>(w(),E(V,{key:n,style:{width:"100%","max-width":"300px"},class:"q-pa-sm",flat:""},{default:l(()=>[c("a",{href:`/api/aquisition/multicam/${P}`,target:"_blank"},[a(G,{fit:"contain",src:`/api/aquisition/multicam/${P}`},null,8,["src"])],8,Be),a(he,null,{default:l(()=>[a(L,null,{default:l(()=>[a(j,null,{default:l(()=>[a(I,null,{default:l(()=>[S(k(C.value[b].description),1)]),_:2},1024),a(I,{caption:""},{default:l(()=>[...t[15]||(t[15]=[S("Description",-1)])]),_:1})]),_:2},1024)]),_:2},1024),a(L,null,{default:l(()=>[a(j,null,{default:l(()=>[a(I,null,{default:l(()=>[S(k(b),1)]),_:2},1024),a(I,{caption:""},{default:l(()=>[...t[16]||(t[16]=[S("Index/DeviceId",-1)])]),_:1})]),_:2},1024)]),_:2},1024),a(L,null,{default:l(()=>[a(j,null,{default:l(()=>[a(I,null,{default:l(()=>[S(k(C.value[b].address),1)]),_:2},1024),a(I,{caption:""},{default:l(()=>[...t[17]||(t[17]=[S("Address",-1)])]),_:1})]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024))),128))])):de("",!0),a(B,{class:"q-gutter-sm"},{default:l(()=>[a(_,{"no-caps":"",onClick:y,color:"green",label:"Capture",loading:r.value},null,8,["loading"]),a(_,{"no-caps":"",onClick:t[3]||(t[3]=o=>i.value=3),color:"green",label:"Continue",disable:v.value.length==0},null,8,["disable"]),a(_,{flat:"","no-caps":"",onClick:t[4]||(t[4]=o=>i.value=1),color:"green",label:"Back"})]),_:1})]),_:1},8,["done"]),a(D,{name:3,title:"Calculate the new calibration data",icon:"sym_o_calculate",done:i.value>3},{default:l(()=>[t[19]||(t[19]=S(" Press the button to calculate and save the new data. ",-1)),c("p",null,"Result: "+k(g.value),1),a(B,{class:"q-gutter-sm"},{default:l(()=>[a(_,{"no-caps":"",color:"green",disable:v.value.length==0,label:s.$t("Calculate"),onClick:q,loading:f.value},null,8,["disable","label","loading"]),a(_,{"no-caps":"",onClick:t[5]||(t[5]=o=>i.value=4),color:"green",label:"Continue",disable:!h.value},null,8,["disable"]),a(_,{"no-caps":"",flat:"",onClick:t[6]||(t[6]=o=>i.value=2),color:"green",label:"Back"})]),_:1})]),_:1},8,["done"]),a(D,{name:4,title:"Confirm the result",icon:"sym_o_flag"},{default:l(()=>[t[20]||(t[20]=S(" ok, done, here is your new wiggle ",-1)),a(B,{class:"q-gutter-sm"},{default:l(()=>[a(_,{"no-caps":"",color:"green",label:"Finish",disable:""}),a(_,{"no-caps":"",flat:"",onClick:t[7]||(t[7]=o=>i.value=3),color:"green",label:"Back"})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{Le as default};
