import{x as q,y as Q,z as G,A as j,d as E,l as D,o as V,B as I,C as $,c as r,e as _,D as d,q as i,p as u,E as F,F as w,G as B,f as y,H as U,I as W,J as P,t as a,n as b,Q as x,s as g,K,L as H,M as S,N as X,O as Y,m as J,P as Z,v as M,g as ee,j as te,h as ae,R as oe,S as ne,_ as O}from"./index-D599IcTa.js";import{Q as k}from"./QPageSticky-azuHt250.js";import{Q as re}from"./QPage-D_dUzHN4.js";import{Q as ie}from"./QCircularProgress-BN3t9t02.js";import{Q as se}from"./QImg-CJyksKps.js";import{Q as le}from"./QBadge-DoaxZ9Kv.js";import{I as ce}from"./ItemNotAvailableError-uG2wDJ9P.js";import"./format-CJebrXOQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ue='<circle cx="12.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="0s" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="52.5" r="12.5" fill-opacity=".5"><animate attributeName="fill-opacity" begin="100ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="300ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="600ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="800ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="400ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="700ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="500ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="200ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle>',de=q({name:"QSpinnerGrid",props:Q,setup(l){const{cSize:e,classes:t}=j(l);return()=>G("svg",{class:t.value,fill:"currentColor",width:e.value,height:e.value,viewBox:"0 0 105 105",xmlns:"http://www.w3.org/2000/svg",innerHTML:ue})}}),me='<g fill="none" fill-rule="evenodd" stroke-width="2"><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="0s" dur="1.8s" values="1; 20" calcMode="spline" keyTimes="0; 1" keySplines="0.165, 0.84, 0.44, 1" repeatCount="indefinite"></animate><animate attributeName="stroke-opacity" begin="0s" dur="1.8s" values="1; 0" calcMode="spline" keyTimes="0; 1" keySplines="0.3, 0.61, 0.355, 1" repeatCount="indefinite"></animate></circle><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="-0.9s" dur="1.8s" values="1; 20" calcMode="spline" keyTimes="0; 1" keySplines="0.165, 0.84, 0.44, 1" repeatCount="indefinite"></animate><animate attributeName="stroke-opacity" begin="-0.9s" dur="1.8s" values="1; 0" calcMode="spline" keyTimes="0; 1" keySplines="0.3, 0.61, 0.355, 1" repeatCount="indefinite"></animate></circle></g>',ge=q({name:"QSpinnerPuff",props:Q,setup(l){const{cSize:e,classes:t}=j(l);return()=>G("svg",{class:t.value,stroke:"currentColor",width:e.value,height:e.value,viewBox:"0 0 44 44",xmlns:"http://www.w3.org/2000/svg",innerHTML:me})}}),_e={id:"countdown-timer-container",class:"flex flex-center",style:{width:"70vw",height:"70vh"}},fe=["innerHTML"],pe={style:{height:"100%"}},ve=E({__name:"CountdownTimer",props:{duration:{},messageDuration:{default:.5},messageText:{default:"ðŸ˜ƒ"}},setup(l){let e;const t=B(0),c=B(0),m=l,f=y(()=>t.value>0),o=y(()=>t.value>0),n=y(()=>t.value<=m.messageDuration);D(()=>{C()}),V(()=>{s()});const s=()=>{clearInterval(e),t.value=0},C=()=>{c.value=m.duration,t.value=c.value,console.log(`starting timer, duration=${c.value}`),e=window.setInterval(()=>{t.value-=.05,t.value<=0&&clearInterval(e)},50)};return(A,R)=>I((r(),_("div",_e,[I(d("div",{id:"countdown-timer-message",style:{position:"absolute","font-size":"150px"},innerHTML:l.messageText},null,8,fe),[[$,n.value]]),d("div",pe,[I(i(ie,{id:"countdown-circular-progress","show-value":!n.value,style:{width:"100%",height:"100%","text-shadow":"#222 0 0 10px","font-weight":"bold",opacity:"85%"},value:t.value,min:0,max:c.value,reverse:"","animation-speed":"100","font-size":"0.5em",size:"70vh",color:"secondary",class:"text-secondary",thickness:.16},{default:u(()=>[F(w(parseFloat(t.value.toFixed(0))),1)]),_:1},8,["show-value","value","max"]),[[$,o.value]])])],512)),[[$,f.value]])}}),be={class:"row q-gutter-md action-buttons"},ye={style:{"white-space":"nowrap"},class:"gt-sm"},he=E({__name:"FrontpageTriggerButtons",props:{triggers:{}},emits:["triggerAction"],setup(l,{emit:e}){const t=l,c=y(()=>t.triggers.filter(o=>o.show_button&&!(P.isEmpty(o.title)&&P.isEmpty(o.icon)))),m=e;function f(o,n){m("triggerAction",o,n)}return(o,n)=>(r(),_("div",be,[(r(!0),_(U,null,W(c.value,(s,C)=>(r(),_("div",{key:C},[i(S,{stack:"",color:s.use_custom_color?"custom":"primary","no-caps":"",rounded:"",class:H(["action-button col-auto glass-effect",["action-button-"+C]]),style:K({"--bg-custom":s.use_custom_color?s.custom_color:null}),onClick:A=>f(s.action,s.config_index)},{default:u(()=>[a(P.isEmpty)(s.icon)?g("",!0):(r(),b(x,{key:0,name:`sym_o_${s.icon}`},null,8,["name"])),d("div",ye,w(s.title),1)]),_:2},1032,["color","class","style","onClick"])]))),128))]))}}),ke={class:"canvas-stack"},we={id:"canvas-blurred"},Se=E({__name:"PreviewStream",props:{index_device:{},enableMirrorEffectStream:{type:Boolean},enableMirrorEffectFrame:{type:Boolean},enableBlurredBackgroundStream:{type:Boolean},blurredbackgroundHighFramerate:{type:Boolean},frameOverlayImage:{}},setup(l){const e=l,t=new Worker(new URL("/assets/streamRenderer-DWA3Ndn-.js",import.meta.url),{type:"module"}),c=typeof ImageDecoder<"u";X(()=>{if(e.frameOverlayImage){const n=new URL(e.frameOverlayImage,document.baseURI).href;t.postMessage({type:"overlay",url:n})}else t.postMessage({type:"overlay",url:null})});const m=`${location.protocol==="https:"?"wss":"ws"}://${location.host}/api/aquisition/stream?index_device=${e.index_device}&index_subdevice=0`,{open:f,close:o}=Y(m,{immediate:!1,autoReconnect:{retries:-1,delay:1e3},onConnected(n){c?n.binaryType="arraybuffer":n.binaryType="blob",console.log("stream connected via websocket, set binaryType to",n.binaryType,"streamRendererImageDecoderMode is ",c,"(only modern browser and secure contexts)")},onDisconnected(){console.log("stream disconnected from websocket")},async onMessage(n,s){document.hidden||t.postMessage({type:"frame",payload:s.data})}});return D(()=>{console.log("preview stream mounted!");const n=document.getElementById("canvas-stream").transferControlToOffscreen(),s=document.getElementById("canvas-blurred").transferControlToOffscreen();t.postMessage({type:"init",enableBlurredBackgroundStream:e.enableBlurredBackgroundStream,enableMirrorEffectStream:e.enableMirrorEffectStream,enableMirrorEffectFrame:e.enableMirrorEffectFrame,blurredbackgroundHighFramerate:e.blurredbackgroundHighFramerate,canvases:{stream:n,blurred:s},streamRendererImageDecoderMode:c},[n,s]),f()}),J(()=>{o(),t.terminate(),console.log("preview stream unmounted!")}),(n,s)=>(r(),_("div",ke,[s[0]||(s[0]=d("canvas",{id:"canvas-stream"},null,-1)),I(d("canvas",we,null,512),[[$,l.enableBlurredBackgroundStream]])]))}}),Ce={id:"itemapproval-dialog",class:"absolute-full flex flex-center"},xe={class:"q-mb-lg action-buttons col"},Me={class:"q-mb-sm row flex flex-center"},Ee={class:"row"},Te=E({__name:"MediaItemApprovalViewer",props:{approval_id:{},number_captures_taken:{},total_captures_to_take:{}},setup(l){const e=B(!0);Z(()=>{e.value=!0});const t=()=>{M("/api/processing/confirm")},c=()=>{M("/api/processing/reject")},m=()=>{M("/api/processing/abort")};return(f,o)=>(r(),_("div",Ce,[e.value?(r(),b(se,{key:0,draggable:!1,loading:"eager",src:`/api/processing/approval/${l.approval_id}`,fit:"contain",style:{height:"95%"},onError:o[0]||(o[0]=n=>e.value=!1),"loading-show-delay":"800"},null,8,["src"])):(r(),b(ce,{key:1})),i(k,{position:"top-left",class:"q-ma-lg"},{default:u(()=>[i(S,{id:"layout-button-back",color:"grey",rounded:"","no-caps":"",onClick:o[1]||(o[1]=n=>m()),class:"action-button glass-effect"},{default:u(()=>[i(x,{left:"",name:"sym_o_cancel"}),d("div",null,w(f.$t("MSG_APPROVE_COLLAGE_ITEM_CANCEL_COLLAGE")),1)]),_:1})]),_:1}),i(k,{position:"bottom",class:"q-ma-lg"},{default:u(()=>[d("div",xe,[d("div",Me,[i(le,{color:"grey-8",class:"q-mr-xs"},{default:u(()=>[i(x,{name:"sym_o_tag",color:"white",class:"q-mr-xs"}),F(" "+w(f.$t("LABEL_ELEMENT_X_OF_Y",{no:l.number_captures_taken,total:l.total_captures_to_take})),1)]),_:1})]),d("div",Ee,[i(S,{id:"item-approval-button-reject",stack:"",rounded:"",class:"q-mr-lg action-button col-auto glass-effect",color:"negative","no-caps":"",icon:"sym_o_thumb_down",label:f.$t("MSG_APPROVE_COLLAGE_ITEM_RETRY"),onClick:o[2]||(o[2]=n=>c())},null,8,["label"]),i(S,{id:"item-approval-button-approve",stack:"",rounded:"",class:"q-mr-sm action-button col-auto glass-effect",color:"positive","no-caps":"",icon:"sym_o_thumb_up",label:f.$t("MSG_APPROVE_COLLAGE_ITEM_APPROVE"),onClick:o[3]||(o[3]=n=>t())},null,8,["label"])])])]),_:1})]))}}),Ie={key:1,class:"full-height full-width column justify-center content-center",style:{position:"absolute"}},$e={key:2,id:"frontpage-countdown",class:"full-height full-width column justify-center content-center",style:{position:"absolute"}},Be=["innerHTML"],Ae={key:4},Le={key:0},Ne={key:0},Pe={class:"q-gutter-md"},Re={class:"gt-sm"},Oe={key:0},qe={class:"q-gutter-md"},Qe={class:"gt-sm"},Ke=E({__name:"IndexPage",setup(l){const e=ee(),t=te(),c=ae(),m=B(0);oe(m,()=>{m.value>=5&&c.push("/admin"),m.value=0},{debounce:500});const f=y(()=>{const p=[];return Object.entries(t.configuration.actions).forEach(([v,T])=>{T.forEach((h,L)=>{const N={action:`actions/${v}`,config_index:L,show_button:h.trigger.ui_trigger.show_button,title:h.trigger.ui_trigger.title,icon:h.trigger.ui_trigger.icon,use_custom_color:h.trigger.ui_trigger.use_custom_color,custom_color:h.trigger.ui_trigger.custom_color};p.push(N)})}),p}),o=y(()=>t.configuration.uisettings.admin_button_invisible),n=y(()=>{const p=t.configuration.uisettings.enable_livestream_when_idle,v=t.configuration.uisettings.enable_livestream_when_active,T=e.isStateIdle,h=e.isStateRecording,L=e.isStateCountdown,N=e.isStateCapture;return T&&p||(L||N)&&v||h}),s=ne(n,500),C=y(()=>{const p=O.get(e.jobmodel.configuration_set,"processing.img_frame_enable",!1),v=O.get(e.jobmodel.configuration_set,"processing.img_frame_file","");return e.isStateCountdown&&p?v:e.isStateIdle&&t.configuration.uisettings.enable_livestream_frameoverlay?t.configuration.uisettings.livestream_frameoverlay_image:""}),A=()=>{o.value?m.value++:c.push("/admin")},R=(p,v)=>{M(`/api/${p}/${v}`)},z=()=>{M("/api/processing/next")};return(p,v)=>(r(),b(re,{id:"index-page",class:"q-pa-none full-height"},{default:u(()=>[a(s)?(r(),b(Se,{key:0,index_device:a(t).configuration.backends.index_backend_video,"frame-overlay-image":C.value,"enable-blurred-background-stream":a(t).configuration.uisettings.livestream_blurredbackground,"enable-mirror-effect-stream":a(t).configuration.uisettings.livestream_mirror_effect,"enable-mirror-effect-frame":a(t).configuration.uisettings.livestream_frameoverlay_mirror_effect,"blurredbackground-high-framerate":a(t).configuration.uisettings.livestream_blurredbackground_high_framerate},null,8,["index_device","frame-overlay-image","enable-blurred-background-stream","enable-mirror-effect-stream","enable-mirror-effect-frame","blurredbackground-high-framerate"])):g("",!0),a(e).isStateProcessing?(r(),_("div",Ie,[i(de,{size:"20em"})])):g("",!0),a(e).isStateCountdown?(r(),_("div",$e,[i(ve,{ref:"countdowntimer",duration:a(e).jobmodel.duration,"message-duration":a(t).configuration.uisettings.TAKEPIC_MSG_TIME,"message-text":a(t).configuration.uisettings.TAKEPIC_MSG_TEXT},null,8,["duration","message-duration","message-text"])])):g("",!0),a(e).isStateIdle?(r(),_("div",{key:3,id:"frontpage_text",innerHTML:a(t).configuration.uisettings.FRONTPAGE_TEXT},null,8,Be)):g("",!0),a(e).isStateApproval?(r(),_("div",Ae,[i(Te,{approval_id:a(e).jobmodel.approval_id,number_captures_taken:a(e).jobmodel.number_captures_taken,total_captures_to_take:a(e).jobmodel.total_captures_to_take},null,8,["approval_id","number_captures_taken","total_captures_to_take"])])):g("",!0),i(k,{position:"bottom",class:"q-mb-lg"},{default:u(()=>[a(e).isStateIdle?(r(),_("div",Le,[i(he,{triggers:f.value,onTriggerAction:R},null,8,["triggers"])])):g("",!0)]),_:1}),i(k,{position:"top-left",class:"q-ma-lg"},{default:u(()=>[a(e).isStateIdle?(r(),_("div",Ne,[d("div",Pe,[a(t).configuration.uisettings.show_gallery_on_frontpage?(r(),b(S,{key:0,id:"frontpage-button-to-gallery",color:"primary","no-caps":"",rounded:"",to:"/gallery",class:"action-button glass-effect"},{default:u(()=>[i(x,{left:"",name:"sym_o_photo_library"}),d("div",Re,w(p.$t("BTN_LABEL_MAINPAGE_TO_GALLERY")),1)]),_:1})):g("",!0)])])):g("",!0)]),_:1}),i(k,{position:"top-right",class:"q-ma-lg"},{default:u(()=>[a(e).isStateIdle?(r(),_("div",Oe,[d("div",qe,[a(t).configuration.uisettings.show_admin_on_frontpage?(r(),b(S,{key:0,id:"frontpage-button-to-admin",rounded:"",color:"transparent","no-caps":"",class:H(["action-button action-button-admin glass-effect",{"action-button-admin-invisible":o.value}]),onClick:A},{default:u(()=>[i(x,{left:"",name:"sym_o_admin_panel_settings"}),d("div",Qe,w(p.$t("BTN_LABEL_MAINPAGE_TO_ADMIN")),1)]),_:1},8,["class"])):g("",!0)])])):g("",!0)]),_:1}),a(e).isStateRecording?(r(),b(k,{key:5,id:"frontpage-indicator-recording",position:"top-right",offset:[25,25],align:"center"},{default:u(()=>[i(ge,{color:"red",size:"12em",thickness:"20"})]),_:1})):g("",!0),a(e).isStateRecording?(r(),b(k,{key:6,id:"frontpage-indicator-stop-recording",position:"bottom",offset:[0,25],align:"center"},{default:u(()=>[i(S,{stack:"",rounded:"","no-caps":"",color:"negative",class:"action-button glass-effect",onClick:v[0]||(v[0]=T=>z())},{default:u(()=>[i(x,{name:"sym_o_stop_circle"}),d("div",null,w(p.$t("Stop recording")),1)]),_:1})]),_:1})):g("",!0)]),_:1}))}});export{Ke as default};
