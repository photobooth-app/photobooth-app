(function(){"use strict";function Xt(t){const e=Object.create(null);for(const n of t.split(","))e[n]=1;return n=>n in e}const Lt=Object.assign,Nt=Object.prototype.hasOwnProperty,tt=(t,e)=>Nt.call(t,e),W=Array.isArray,G=t=>gt(t)==="[object Map]",Ut=t=>typeof t=="function",qt=t=>typeof t=="string",Y=t=>typeof t=="symbol",H=t=>t!==null&&typeof t=="object",zt=Object.prototype.toString,gt=t=>zt.call(t),$t=t=>gt(t).slice(8,-1),et=t=>qt(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,X=(t,e)=>!Object.is(t,e);let Gt,xt=0,nt;function rt(){xt++}function st(){if(--xt>0)return;let t;for(;nt;){let e=nt;for(nt=void 0;e;){const n=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(o){t||(t=o)}e=n}}if(t)throw t}let V=!0;const yt=[];function Vt(){yt.push(V),V=!1}function Jt(){const t=yt.pop();V=t===void 0?!0:t}class vt{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){}trigger(e){this.version++,this.notify(e)}notify(e){rt();try{for(let n=this.subs;n;n=n.prevSub)n.sub.notify()&&n.sub.dep.notify()}finally{st()}}}const ot=new WeakMap,j=Symbol(""),at=Symbol(""),L=Symbol("");function p(t,e,n){if(V&&Gt){let o=ot.get(t);o||ot.set(t,o=new Map);let r=o.get(n);r||(o.set(n,r=new vt),r.map=o,r.key=n),r.track()}}function I(t,e,n,o,r,s){const a=ot.get(t);if(!a)return;const i=c=>{c&&c.trigger()};if(rt(),e==="clear")a.forEach(i);else{const c=W(t),l=c&&et(n);if(c&&n==="length"){const h=Number(o);a.forEach((u,d)=>{(d==="length"||d===L||!Y(d)&&d>=h)&&i(u)})}else switch((n!==void 0||a.has(void 0))&&i(a.get(n)),l&&i(a.get(L)),e){case"add":c?l&&i(a.get("length")):(i(a.get(j)),G(t)&&i(a.get(at)));break;case"delete":c||(i(a.get(j)),G(t)&&i(a.get(at)));break;case"set":G(t)&&i(a.get(j));break}}st()}function E(t){const e=f(t);return e===t?e:(p(e,"iterate",L),O(t)?e:e.map(R))}function it(t){return p(t=f(t),"iterate",L),t}function M(t,e){return T(t)?Ct(t)?U(R(e)):U(e):R(e)}const Qt={__proto__:null,[Symbol.iterator](){return ct(this,Symbol.iterator,t=>M(this,t))},concat(...t){return E(this).concat(...t.map(e=>W(e)?E(e):e))},entries(){return ct(this,"entries",t=>(t[1]=M(this,t[1]),t))},every(t,e){return b(this,"every",t,e,void 0,arguments)},filter(t,e){return b(this,"filter",t,e,n=>n.map(o=>M(this,o)),arguments)},find(t,e){return b(this,"find",t,e,n=>M(this,n),arguments)},findIndex(t,e){return b(this,"findIndex",t,e,void 0,arguments)},findLast(t,e){return b(this,"findLast",t,e,n=>M(this,n),arguments)},findLastIndex(t,e){return b(this,"findLastIndex",t,e,void 0,arguments)},forEach(t,e){return b(this,"forEach",t,e,void 0,arguments)},includes(...t){return lt(this,"includes",t)},indexOf(...t){return lt(this,"indexOf",t)},join(t){return E(this).join(t)},lastIndexOf(...t){return lt(this,"lastIndexOf",t)},map(t,e){return b(this,"map",t,e,void 0,arguments)},pop(){return N(this,"pop")},push(...t){return N(this,"push",t)},reduce(t,...e){return bt(this,"reduce",t,e)},reduceRight(t,...e){return bt(this,"reduceRight",t,e)},shift(){return N(this,"shift")},some(t,e){return b(this,"some",t,e,void 0,arguments)},splice(...t){return N(this,"splice",t)},toReversed(){return E(this).toReversed()},toSorted(t){return E(this).toSorted(t)},toSpliced(...t){return E(this).toSpliced(...t)},unshift(...t){return N(this,"unshift",t)},values(){return ct(this,"values",t=>M(this,t))}};function ct(t,e,n){const o=it(t),r=o[e]();return o!==t&&!O(t)&&(r._next=r.next,r.next=()=>{const s=r._next();return s.done||(s.value=n(s.value)),s}),r}const Zt=Array.prototype;function b(t,e,n,o,r,s){const a=it(t),i=a!==t&&!O(t),c=a[e];if(c!==Zt[e]){const u=c.apply(t,s);return i?R(u):u}let l=n;a!==t&&(i?l=function(u,d){return n.call(this,M(t,u),d,t)}:n.length>2&&(l=function(u,d){return n.call(this,u,d,t)}));const h=c.call(a,l,o);return i&&r?r(h):h}function bt(t,e,n,o){const r=it(t);let s=n;return r!==t&&(O(t)?n.length>3&&(s=function(a,i,c){return n.call(this,a,i,c,t)}):s=function(a,i,c){return n.call(this,a,M(t,i),c,t)}),r[e](s,...o)}function lt(t,e,n){const o=f(t);p(o,"iterate",L);const r=o[e](...n);return(r===-1||r===!1)&&de(n[0])?(n[0]=f(n[0]),o[e](...n)):r}function N(t,e,n=[]){Vt(),rt();const o=f(t)[e].apply(t,n);return st(),Jt(),o}const kt=Xt("__proto__,__v_isRef,__isVue"),Rt=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(Y));function te(t){Y(t)||(t=String(t));const e=f(this);return p(e,"has",t),e.hasOwnProperty(t)}class St{constructor(e=!1,n=!1){this._isReadonly=e,this._isShallow=n}get(e,n,o){if(n==="__v_skip")return e.__v_skip;const r=this._isReadonly,s=this._isShallow;if(n==="__v_isReactive")return!r;if(n==="__v_isReadonly")return r;if(n==="__v_isShallow")return s;if(n==="__v_raw")return o===(r?s?ue:Tt:s?le:Mt).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(o)?e:void 0;const a=W(e);if(!r){let c;if(a&&(c=Qt[n]))return c;if(n==="hasOwnProperty")return te}const i=Reflect.get(e,n,B(e)?e:o);if((Y(n)?Rt.has(n):kt(n))||(r||p(e,"get",n),s))return i;if(B(i)){const c=a&&et(n)?i:i.value;return r&&H(c)?ft(c):c}return H(i)?r?ft(i):Ot(i):i}}class ee extends St{constructor(e=!1){super(!1,e)}set(e,n,o,r){let s=e[n];const a=W(e)&&et(n);if(!this._isShallow){const l=T(s);if(!O(o)&&!T(o)&&(s=f(s),o=f(o)),!a&&B(s)&&!B(o))return l||(s.value=o),!0}const i=a?Number(n)<e.length:tt(e,n),c=Reflect.set(e,n,o,B(e)?e:r);return e===f(r)&&(i?X(o,s)&&I(e,"set",n,o):I(e,"add",n,o)),c}deleteProperty(e,n){const o=tt(e,n);e[n];const r=Reflect.deleteProperty(e,n);return r&&o&&I(e,"delete",n,void 0),r}has(e,n){const o=Reflect.has(e,n);return(!Y(n)||!Rt.has(n))&&p(e,"has",n),o}ownKeys(e){return p(e,"iterate",W(e)?"length":j),Reflect.ownKeys(e)}}class ne extends St{constructor(e=!1){super(!0,e)}set(e,n){return!0}deleteProperty(e,n){return!0}}const re=new ee,se=new ne,ut=t=>t,J=t=>Reflect.getPrototypeOf(t);function oe(t,e,n){return function(...o){const r=this.__v_raw,s=f(r),a=G(s),i=t==="entries"||t===Symbol.iterator&&a,c=t==="keys"&&a,l=r[t](...o),h=n?ut:e?U:R;return!e&&p(s,"iterate",c?at:j),{next(){const{value:u,done:d}=l.next();return d?{value:u,done:d}:{value:i?[h(u[0]),h(u[1])]:h(u),done:d}},[Symbol.iterator](){return this}}}}function Q(t){return function(...e){return t==="delete"?!1:t==="clear"?void 0:this}}function ae(t,e){const n={get(r){const s=this.__v_raw,a=f(s),i=f(r);t||(X(r,i)&&p(a,"get",r),p(a,"get",i));const{has:c}=J(a),l=e?ut:t?U:R;if(c.call(a,r))return l(s.get(r));if(c.call(a,i))return l(s.get(i));s!==a&&s.get(r)},get size(){const r=this.__v_raw;return!t&&p(f(r),"iterate",j),r.size},has(r){const s=this.__v_raw,a=f(s),i=f(r);return t||(X(r,i)&&p(a,"has",r),p(a,"has",i)),r===i?s.has(r):s.has(r)||s.has(i)},forEach(r,s){const a=this,i=a.__v_raw,c=f(i),l=e?ut:t?U:R;return!t&&p(c,"iterate",j),i.forEach((h,u)=>r.call(s,l(h),l(u),a))}};return Lt(n,t?{add:Q("add"),set:Q("set"),delete:Q("delete"),clear:Q("clear")}:{add(r){!e&&!O(r)&&!T(r)&&(r=f(r));const s=f(this);return J(s).has.call(s,r)||(s.add(r),I(s,"add",r,r)),this},set(r,s){!e&&!O(s)&&!T(s)&&(s=f(s));const a=f(this),{has:i,get:c}=J(a);let l=i.call(a,r);l||(r=f(r),l=i.call(a,r));const h=c.call(a,r);return a.set(r,s),l?X(s,h)&&I(a,"set",r,s):I(a,"add",r,s),this},delete(r){const s=f(this),{has:a,get:i}=J(s);let c=a.call(s,r);c||(r=f(r),c=a.call(s,r)),i&&i.call(s,r);const l=s.delete(r);return c&&I(s,"delete",r,void 0),l},clear(){const r=f(this),s=r.size!==0,a=r.clear();return s&&I(r,"clear",void 0,void 0),a}}),["keys","values","entries",Symbol.iterator].forEach(r=>{n[r]=oe(r,t,e)}),n}function It(t,e){const n=ae(t,e);return(o,r,s)=>r==="__v_isReactive"?!t:r==="__v_isReadonly"?t:r==="__v_raw"?o:Reflect.get(tt(n,r)&&r in o?n:o,r,s)}const ie={get:It(!1,!1)},ce={get:It(!0,!1)},Mt=new WeakMap,le=new WeakMap,Tt=new WeakMap,ue=new WeakMap;function fe(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function he(t){return t.__v_skip||!Object.isExtensible(t)?0:fe($t(t))}function Ot(t){return T(t)?t:Bt(t,!1,re,ie,Mt)}function ft(t){return Bt(t,!0,se,ce,Tt)}function Bt(t,e,n,o,r){if(!H(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const s=he(t);if(s===0)return t;const a=r.get(t);if(a)return a;const i=new Proxy(t,s===2?o:n);return r.set(t,i),i}function Ct(t){return T(t)?Ct(t.__v_raw):!!(t&&t.__v_isReactive)}function T(t){return!!(t&&t.__v_isReadonly)}function O(t){return!!(t&&t.__v_isShallow)}function de(t){return t?!!t.__v_raw:!1}function f(t){const e=t&&t.__v_raw;return e?f(e):t}const R=t=>H(t)?Ot(t):t,U=t=>H(t)?ft(t):t;function B(t){return t?t.__v_isRef===!0:!1}function pe(t){return _e(t,!1)}function _e(t,e){return B(t)?t:new we(t,e)}class we{constructor(e,n){this.dep=new vt,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=n?e:f(e),this._value=n?e:R(e),this.__v_isShallow=n}get value(){return this.dep.track(),this._value}set value(e){const n=this._rawValue,o=this.__v_isShallow||O(e)||T(e);e=o?e:f(e),X(e,n)&&(this._rawValue=e,this._value=o?e:R(e),this.dep.trigger())}}function me(t){return B(t)?t.value:t}function ge(t){return Ut(t)?t():me(t)}typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const Pt=()=>{};function xe(t,e){function n(...o){return new Promise((r,s)=>{Promise.resolve(t(()=>e.apply(this,o),{fn:e,thisArg:this,args:o})).then(r).catch(s)})}return n}function ye(...t){let e=0,n,o=!0,r=Pt,s,a,i,c,l;!B(t[0])&&typeof t[0]=="object"?{delay:a,trailing:i=!0,leading:c=!0,rejectOnCancel:l=!1}=t[0]:[a,i=!0,c=!0,l=!1]=t;const h=()=>{n&&(clearTimeout(n),n=void 0,r(),r=Pt)};return d=>{const S=ge(a),x=Date.now()-e,w=()=>s=d();return h(),S<=0?(e=Date.now(),w()):(x>S?(e=Date.now(),(c||!o)&&w()):i&&(s=new Promise((A,D)=>{r=l?D:A,n=setTimeout(()=>{e=Date.now(),o=!0,A(w()),h()},Math.max(0,S-x))})),!c&&!n&&(n=setTimeout(()=>o=!0,S)),o=!1,s)}}function ve(t,e=200,n=!1,o=!0,r=!1){return xe(ye(e,n,o,r),t)}let ht,dt,jt,At,q=null;const Et=pe(500);let Z=null,_=null,g=null,pt=0,_t=0,wt=0,Dt=performance.now(),z=[];self.onmessage=async t=>{t.data.type==="init"?(ht=t.data.canvases.stream,dt=t.data.canvases.blurred,jt=ht.getContext("2d",{alpha:!0}),At=dt.getContext("2d",{alpha:!0}),Et.value=t.data.blurredbackgroundHighFramerate===!0?50:300):t.data.type==="frame"?(q&&wt++,q=t.data.payload,Re()):t.data.type==="overlay"&&(Z=t.data.url,console.log(Z),Z?Se(Z):_=null)};const Kt=(t,e,n)=>{const o=_?_.width:n.width,r=_?_.height:n.height;if((t.width!==o||t.height!==r)&&(t.width=o,t.height=r,console.log(`set canvas size to ${o}x${r}`)),_&&g){const{drawW:s,drawH:a,offsetX:i,offsetY:c}=Ie(n.width,n.height,g.w,g.h);e.drawImage(n,g.x+i,g.y+c,s,a),e.drawImage(_,0,0),e.strokeStyle="red",e.lineWidth=2,e.strokeRect(g.x,g.y,g.w,g.h)}else e.drawImage(n,0,0)},be=ve((t,e,n)=>{Kt(t,e,n),_t++},Et);async function Re(){if(!q)return;const t=q;try{const e=performance.now(),n=new Blob([t],{type:"image/jpeg"}),o=await createImageBitmap(n);Kt(ht,jt,o),pt++,be(dt,At,o),o.close();const r=performance.now();z.push(r-e)}catch(e){console.error(e),console.error("Decode error:",e)}finally{q=null,Be()}}async function Se(t){const e=performance.now();let n,o,r,s;try{const c=await(await fetch(t)).blob();_=await createImageBitmap(c),n=performance.now();const l=await Me(_);o=performance.now();const h=await Te(_);r=performance.now();const u=await Oe(_);s=performance.now(),console.warn("computeTransparentBoundingBoxSimple area",l,"took ",(o-n).toFixed(1)),console.warn("computeTransparentBoundingBoxU32 area",h,"took ",(r-o).toFixed(1)),console.warn("computeTransparentBoundingBoxScaleRefine area",u,"took ",(s-r).toFixed(1)),g=u}catch(i){console.error("Overlay load error:",i),_=null}const a=performance.now();console.log("load overlay took ",(n-e).toFixed(1),"ms and calc transparency took ",(a-n).toFixed(1),"ms")}function Ie(t,e,n,o){const r=Math.max(n/t,o/e),s=t*r,a=e*r,i=(n-s)/2,c=(o-a)/2;return{drawW:s,drawH:a,offsetX:i,offsetY:c}}async function Me(t){const n=new OffscreenCanvas(t.width,t.height).getContext("2d",{willReadFrequently:!0});n.drawImage(t,0,0);const o=n.getImageData(0,0,t.width,t.height).data;let r=t.width,s=t.height,a=0,i=0;for(let c=0;c<t.height;c++)for(let l=0;l<t.width;l++)o[(c*t.width+l)*4+3]<128&&(r=Math.min(r,l),s=Math.min(s,c),a=Math.max(a,l),i=Math.max(i,c));return{x:r,y:s,w:a-r+1,h:i-s+1}}async function Te(t){const{width:e,height:n}=t,r=new OffscreenCanvas(e,n).getContext("2d",{willReadFrequently:!0});r.drawImage(t,0,0);const s=r.getImageData(0,0,e,n).data,a=new Uint32Array(s.buffer);let i=e,c=n,l=-1,h=-1;for(let u=0;u<n;u++)for(let d=0;d<e;d++)(a[u*e+d]>>>24&255)<128&&(d<i&&(i=d),u<c&&(c=u),d>l&&(l=d),u>h&&(h=u));return{x:i,y:c,w:l-i+1,h:h-c+1}}async function Oe(t,e=4,n=10){const{width:o,height:r}=t,s=Math.ceil(o/e),a=Math.ceil(r/e),c=new OffscreenCanvas(s,a).getContext("2d",{willReadFrequently:!0});c.drawImage(t,0,0,s,a);const l=c.getImageData(0,0,s,a).data;let h=s,u=a,d=-1,S=-1;for(let y=0;y<a;y++)for(let v=0;v<s;v++)l[(y*s+v)*4+3]<128&&(v<h&&(h=v),y<u&&(u=y),v>d&&(d=v),y>S&&(S=y));const x=h*e,w=u*e,A=(d-h+1)*e,D=(S-u+1)*e,Ft=new OffscreenCanvas(o,r).getContext("2d",{willReadFrequently:!0});Ft.drawImage(t,0,0);function k(y,v,K,mt,F){const Ht=Ft.getImageData(y,v,K,mt).data;let m=F==="top"||F==="left"?1/0:-1/0;if(F==="top"||F==="bottom"){for(let C=0;C<mt;C++)for(let P=0;P<K;P++)if(Ht[(C*K+P)*4+3]<128){const $=v+C;F==="top"?m=Math.min(m,$):m=Math.max(m,$)}}else for(let C=0;C<mt;C++)for(let P=0;P<K;P++)if(Ht[(C*K+P)*4+3]<128){const $=y+P;F==="left"?m=Math.min(m,$):m=Math.max(m,$)}return m===1/0||m===-1/0?null:m}const Wt=k(x,Math.max(0,w-n),A,n*2,"top"),Ce=k(x,Math.min(r-n,w+D-n),A,n*2,"bottom"),Yt=k(Math.max(0,x-n),w,n*2,D,"left"),Pe=k(Math.min(o-n,x+A-n),w,n*2,D,"right");return{x:Yt??x,y:Wt??w,w:(Pe??x+A)-(Yt??x)+1,h:(Ce??w+D)-(Wt??w)+1}}function Be(){const t=performance.now();if(t-Dt>=1e3){const e=pt,n=_t,o=z.length?z.reduce((r,s)=>r+s,0)/z.length:0;self.postMessage({type:"stats",fpsPlain:e,fpsAug:n,dropped:wt,avgDecode:o.toFixed(1)}),pt=_t=wt=0,z=[],Dt=t}}})();
