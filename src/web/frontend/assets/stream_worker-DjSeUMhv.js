(function(){"use strict";function Ot(t){const e=Object.create(null);for(const r of t.split(","))e[r]=1;return r=>r in e}const Tt=Object.assign,Mt=Object.prototype.hasOwnProperty,L=(t,e)=>Mt.call(t,e),O=Array.isArray,B=t=>ot(t)==="[object Map]",Pt=t=>typeof t=="function",jt=t=>typeof t=="string",T=t=>typeof t=="symbol",M=t=>t!==null&&typeof t=="object",At=Object.prototype.toString,ot=t=>At.call(t),Et=t=>ot(t).slice(8,-1),N=t=>jt(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,P=(t,e)=>!Object.is(t,e);let Kt,it=0,z;function X(){it++}function $(){if(--it>0)return;let t;for(;z;){let e=z;for(z=void 0;e;){const r=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(s){t||(t=s)}e=r}}if(t)throw t}let C=!0;const at=[];function Wt(){at.push(C),C=!1}function Bt(){const t=at.pop();C=t===void 0?!0:t}class ct{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){}trigger(e){this.version++,this.notify(e)}notify(e){X();try{for(let r=this.subs;r;r=r.prevSub)r.sub.notify()&&r.sub.dep.notify()}finally{$()}}}const G=new WeakMap,x=Symbol(""),U=Symbol(""),j=Symbol("");function p(t,e,r){if(C&&Kt){let s=G.get(t);s||G.set(t,s=new Map);let n=s.get(r);n||(s.set(r,n=new ct),n.map=s,n.key=r),n.track()}}function b(t,e,r,s,n,o){const i=G.get(t);if(!i)return;const a=c=>{c&&c.trigger()};if(X(),e==="clear")i.forEach(a);else{const c=O(t),l=c&&N(r);if(c&&r==="length"){const h=Number(s);i.forEach((f,d)=>{(d==="length"||d===j||!T(d)&&d>=h)&&a(f)})}else switch((r!==void 0||i.has(void 0))&&a(i.get(r)),l&&a(i.get(j)),e){case"add":c?l&&a(i.get("length")):(a(i.get(x)),B(t)&&a(i.get(U)));break;case"delete":c||(a(i.get(x)),B(t)&&a(i.get(U)));break;case"set":B(t)&&a(i.get(x));break}}$()}function I(t){const e=u(t);return e===t?e:(p(e,"iterate",j),R(t)?e:e.map(m))}function V(t){return p(t=u(t),"iterate",j),t}function v(t,e){return y(t)?gt(t)?E(m(e)):E(e):m(e)}const Ct={__proto__:null,[Symbol.iterator](){return q(this,Symbol.iterator,t=>v(this,t))},concat(...t){return I(this).concat(...t.map(e=>O(e)?I(e):e))},entries(){return q(this,"entries",t=>(t[1]=v(this,t[1]),t))},every(t,e){return g(this,"every",t,e,void 0,arguments)},filter(t,e){return g(this,"filter",t,e,r=>r.map(s=>v(this,s)),arguments)},find(t,e){return g(this,"find",t,e,r=>v(this,r),arguments)},findIndex(t,e){return g(this,"findIndex",t,e,void 0,arguments)},findLast(t,e){return g(this,"findLast",t,e,r=>v(this,r),arguments)},findLastIndex(t,e){return g(this,"findLastIndex",t,e,void 0,arguments)},forEach(t,e){return g(this,"forEach",t,e,void 0,arguments)},includes(...t){return J(this,"includes",t)},indexOf(...t){return J(this,"indexOf",t)},join(t){return I(this).join(t)},lastIndexOf(...t){return J(this,"lastIndexOf",t)},map(t,e){return g(this,"map",t,e,void 0,arguments)},pop(){return A(this,"pop")},push(...t){return A(this,"push",t)},reduce(t,...e){return lt(this,"reduce",t,e)},reduceRight(t,...e){return lt(this,"reduceRight",t,e)},shift(){return A(this,"shift")},some(t,e){return g(this,"some",t,e,void 0,arguments)},splice(...t){return A(this,"splice",t)},toReversed(){return I(this).toReversed()},toSorted(t){return I(this).toSorted(t)},toSpliced(...t){return I(this).toSpliced(...t)},unshift(...t){return A(this,"unshift",t)},values(){return q(this,"values",t=>v(this,t))}};function q(t,e,r){const s=V(t),n=s[e]();return s!==t&&!R(t)&&(n._next=n.next,n.next=()=>{const o=n._next();return o.done||(o.value=r(o.value)),o}),n}const Dt=Array.prototype;function g(t,e,r,s,n,o){const i=V(t),a=i!==t&&!R(t),c=i[e];if(c!==Dt[e]){const f=c.apply(t,o);return a?m(f):f}let l=r;i!==t&&(a?l=function(f,d){return r.call(this,v(t,f),d,t)}:r.length>2&&(l=function(f,d){return r.call(this,f,d,t)}));const h=c.call(i,l,s);return a&&n?n(h):h}function lt(t,e,r,s){const n=V(t);let o=r;return n!==t&&(R(t)?r.length>3&&(o=function(i,a,c){return r.call(this,i,a,c,t)}):o=function(i,a,c){return r.call(this,i,v(t,a),c,t)}),n[e](o,...s)}function J(t,e,r){const s=u(t);p(s,"iterate",j);const n=s[e](...r);return(n===-1||n===!1)&&Zt(r[0])?(r[0]=u(r[0]),s[e](...r)):n}function A(t,e,r=[]){Wt(),X();const s=u(t)[e].apply(t,r);return $(),Bt(),s}const Ft=Ot("__proto__,__v_isRef,__isVue"),ut=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(T));function Ht(t){T(t)||(t=String(t));const e=u(this);return p(e,"has",t),e.hasOwnProperty(t)}class ft{constructor(e=!1,r=!1){this._isReadonly=e,this._isShallow=r}get(e,r,s){if(r==="__v_skip")return e.__v_skip;const n=this._isReadonly,o=this._isShallow;if(r==="__v_isReactive")return!n;if(r==="__v_isReadonly")return n;if(r==="__v_isShallow")return o;if(r==="__v_raw")return s===(n?o?qt:pt:o?Vt:dt).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(s)?e:void 0;const i=O(e);if(!n){let c;if(i&&(c=Ct[r]))return c;if(r==="hasOwnProperty")return Ht}const a=Reflect.get(e,r,S(e)?e:s);if((T(r)?ut.has(r):Ft(r))||(n||p(e,"get",r),o))return a;if(S(a)){const c=i&&N(r)?a:a.value;return n&&M(c)?Z(c):c}return M(a)?n?Z(a):_t(a):a}}class Yt extends ft{constructor(e=!1){super(!1,e)}set(e,r,s,n){let o=e[r];const i=O(e)&&N(r);if(!this._isShallow){const l=y(o);if(!R(s)&&!y(s)&&(o=u(o),s=u(s)),!i&&S(o)&&!S(s))return l||(o.value=s),!0}const a=i?Number(r)<e.length:L(e,r),c=Reflect.set(e,r,s,S(e)?e:n);return e===u(n)&&(a?P(s,o)&&b(e,"set",r,s):b(e,"add",r,s)),c}deleteProperty(e,r){const s=L(e,r);e[r];const n=Reflect.deleteProperty(e,r);return n&&s&&b(e,"delete",r,void 0),n}has(e,r){const s=Reflect.has(e,r);return(!T(r)||!ut.has(r))&&p(e,"has",r),s}ownKeys(e){return p(e,"iterate",O(e)?"length":x),Reflect.ownKeys(e)}}class Lt extends ft{constructor(e=!1){super(!0,e)}set(e,r){return!0}deleteProperty(e,r){return!0}}const Nt=new Yt,zt=new Lt,Q=t=>t,D=t=>Reflect.getPrototypeOf(t);function Xt(t,e,r){return function(...s){const n=this.__v_raw,o=u(n),i=B(o),a=t==="entries"||t===Symbol.iterator&&i,c=t==="keys"&&i,l=n[t](...s),h=r?Q:e?E:m;return!e&&p(o,"iterate",c?U:x),{next(){const{value:f,done:d}=l.next();return d?{value:f,done:d}:{value:a?[h(f[0]),h(f[1])]:h(f),done:d}},[Symbol.iterator](){return this}}}}function F(t){return function(...e){return t==="delete"?!1:t==="clear"?void 0:this}}function $t(t,e){const r={get(n){const o=this.__v_raw,i=u(o),a=u(n);t||(P(n,a)&&p(i,"get",n),p(i,"get",a));const{has:c}=D(i),l=e?Q:t?E:m;if(c.call(i,n))return l(o.get(n));if(c.call(i,a))return l(o.get(a));o!==i&&o.get(n)},get size(){const n=this.__v_raw;return!t&&p(u(n),"iterate",x),n.size},has(n){const o=this.__v_raw,i=u(o),a=u(n);return t||(P(n,a)&&p(i,"has",n),p(i,"has",a)),n===a?o.has(n):o.has(n)||o.has(a)},forEach(n,o){const i=this,a=i.__v_raw,c=u(a),l=e?Q:t?E:m;return!t&&p(c,"iterate",x),a.forEach((h,f)=>n.call(o,l(h),l(f),i))}};return Tt(r,t?{add:F("add"),set:F("set"),delete:F("delete"),clear:F("clear")}:{add(n){!e&&!R(n)&&!y(n)&&(n=u(n));const o=u(this);return D(o).has.call(o,n)||(o.add(n),b(o,"add",n,n)),this},set(n,o){!e&&!R(o)&&!y(o)&&(o=u(o));const i=u(this),{has:a,get:c}=D(i);let l=a.call(i,n);l||(n=u(n),l=a.call(i,n));const h=c.call(i,n);return i.set(n,o),l?P(o,h)&&b(i,"set",n,o):b(i,"add",n,o),this},delete(n){const o=u(this),{has:i,get:a}=D(o);let c=i.call(o,n);c||(n=u(n),c=i.call(o,n)),a&&a.call(o,n);const l=o.delete(n);return c&&b(o,"delete",n,void 0),l},clear(){const n=u(this),o=n.size!==0,i=n.clear();return o&&b(n,"clear",void 0,void 0),i}}),["keys","values","entries",Symbol.iterator].forEach(n=>{r[n]=Xt(n,t,e)}),r}function ht(t,e){const r=$t(t,e);return(s,n,o)=>n==="__v_isReactive"?!t:n==="__v_isReadonly"?t:n==="__v_raw"?s:Reflect.get(L(r,n)&&n in s?r:s,n,o)}const Gt={get:ht(!1,!1)},Ut={get:ht(!0,!1)},dt=new WeakMap,Vt=new WeakMap,pt=new WeakMap,qt=new WeakMap;function Jt(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Qt(t){return t.__v_skip||!Object.isExtensible(t)?0:Jt(Et(t))}function _t(t){return y(t)?t:wt(t,!1,Nt,Gt,dt)}function Z(t){return wt(t,!0,zt,Ut,pt)}function wt(t,e,r,s,n){if(!M(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const o=Qt(t);if(o===0)return t;const i=n.get(t);if(i)return i;const a=new Proxy(t,o===2?s:r);return n.set(t,a),a}function gt(t){return y(t)?gt(t.__v_raw):!!(t&&t.__v_isReactive)}function y(t){return!!(t&&t.__v_isReadonly)}function R(t){return!!(t&&t.__v_isShallow)}function Zt(t){return t?!!t.__v_raw:!1}function u(t){const e=t&&t.__v_raw;return e?u(e):t}const m=t=>M(t)?_t(t):t,E=t=>M(t)?Z(t):t;function S(t){return t?t.__v_isRef===!0:!1}function kt(t){return te(t,!1)}function te(t,e){return S(t)?t:new ee(t,e)}class ee{constructor(e,r){this.dep=new ct,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=r?e:u(e),this._value=r?e:m(e),this.__v_isShallow=r}get value(){return this.dep.track(),this._value}set value(e){const r=this._rawValue,s=this.__v_isShallow||R(e)||y(e);e=s?e:u(e),P(e,r)&&(this._rawValue=e,this._value=s?e:m(e),this.dep.trigger())}}function re(t){return S(t)?t.value:t}function ne(t){return Pt(t)?t():re(t)}typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const mt=()=>{};function se(t,e){function r(...s){return new Promise((n,o)=>{Promise.resolve(t(()=>e.apply(this,s),{fn:e,thisArg:this,args:s})).then(n).catch(o)})}return r}function oe(...t){let e=0,r,s=!0,n=mt,o,i,a,c,l;!S(t[0])&&typeof t[0]=="object"?{delay:i,trailing:a=!0,leading:c=!0,rejectOnCancel:l=!1}=t[0]:[i,a=!0,c=!0,l=!1]=t;const h=()=>{r&&(clearTimeout(r),r=void 0,n(),n=mt)};return d=>{const Y=ne(i),xt=Date.now()-e,st=()=>o=d();return h(),Y<=0?(e=Date.now(),st()):(xt>Y?(e=Date.now(),(c||!s)&&st()):a&&(o=new Promise((It,de)=>{n=l?de:It,r=setTimeout(()=>{e=Date.now(),s=!0,It(st()),h()},Math.max(0,Y-xt))})),!c&&!r&&(r=setTimeout(()=>s=!0,Y)),s=!1,o)}}function ie(t,e=200,r=!1,s=!0,n=!1){return se(oe(e,r,s,n),t)}let k,tt,bt,vt,K=null;const yt=kt(500);let H=null,w=null,_=null,et=0,rt=0,nt=0,Rt=performance.now(),W=[];self.onmessage=async t=>{t.data.type==="init"?(k=t.data.canvases.stream,tt=t.data.canvases.blurred,bt=k.getContext("2d",{alpha:!0}),vt=tt.getContext("2d",{alpha:!0}),yt.value=t.data.blurredbackgroundHighFramerate===!0?50:300):t.data.type==="frame"?(K&&nt++,K=t.data.payload,ce()):t.data.type==="overlay"&&(H=t.data.url,console.log(H),H?le(H):w=null)};const St=(t,e,r)=>{const s=w?w.width:r.width,n=w?w.height:r.height;if((t.width!==s||t.height!==n)&&(t.width=s,t.height=n,console.log(`set canvas size to ${s}x${n}`)),w&&_){const{drawW:o,drawH:i,offsetX:a,offsetY:c}=ue(r.width,r.height,_.w,_.h);e.drawImage(r,_.x+a,_.y+c,o,i),e.drawImage(w,0,0),e.strokeStyle="red",e.lineWidth=2,e.strokeRect(_.x,_.y,_.w,_.h)}else e.drawImage(r,0,0)},ae=ie((t,e,r)=>{St(t,e,r),rt++},yt);async function ce(){if(!K)return;const t=K;try{const e=performance.now(),r=new Blob([t],{type:"image/jpeg"}),s=await createImageBitmap(r);St(k,bt,s),et++,ae(tt,vt,s),s.close();const n=performance.now();W.push(n-e)}catch(e){console.error(e),console.error("Decode error:",e)}finally{K=null,he()}}async function le(t){const e=performance.now();let r;try{const o=await(await fetch(t)).blob();w=await createImageBitmap(o),r=performance.now(),_=await fe(w)}catch(n){console.error("Overlay load error:",n),w=null}const s=performance.now();console.log("load overlay took ",(r-e).toFixed(1),"ms and calc transparency box ",_," took ",(s-r).toFixed(1),"ms")}function ue(t,e,r,s){const n=Math.max(r/t,s/e),o=t*n,i=e*n,a=(r-o)/2,c=(s-i)/2;return{drawW:o,drawH:i,offsetX:a,offsetY:c}}async function fe(t,e=5){const r=Math.ceil(t.width/e),s=Math.ceil(t.height/e),n=new OffscreenCanvas(r,s).getContext("2d",{willReadFrequently:!0});n.drawImage(t,0,0,r,s);const o=n.getImageData(0,0,r,s).data;let i=r,a=s,c=-1,l=-1;for(let h=0;h<s;h++)for(let f=0;f<r;f++)o[(h*r+f)*4+3]<128&&(f<i&&(i=f),h<a&&(a=h),f>c&&(c=f),h>l&&(l=h));return{x:i*e,y:a*e,w:(c-i+1)*e,h:(l-a+1)*e}}function he(){const t=performance.now();if(t-Rt>=1e3){const e=et,r=rt,s=W.length?W.reduce((n,o)=>n+o,0)/W.length:0;self.postMessage({type:"stats",fpsPlain:e,fpsAug:r,dropped:nt,avgDecode:s.toFixed(1)}),et=rt=nt=0,W=[],Rt=t}}})();
