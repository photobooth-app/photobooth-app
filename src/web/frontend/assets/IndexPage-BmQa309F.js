import{x as G,y as j,z as F,A as H,d as $,B as P,c as w,l as z,o as D,C as N,D as L,b as v,f as i,E as g,q as s,p as f,F as V,G as C,H as W,I as U,n as b,s as p,v as o,J as q,Q as S,K,L as M,M as T,N as X,m as Y,O as J,P as Z,r as I,g as ee,h as te,R as ne,S as ae,k as oe,_ as Q}from"./index-D9G3xoPe.js";import{Q as x}from"./QPageSticky-tm495Ayg.js";import{Q as ie}from"./QPage-BQu5aT5d.js";import{Q as re}from"./QCircularProgress-DsdCOGbw.js";import{Q as se}from"./QImg-8X7eT4wP.js";import{Q as le}from"./QBadge-BCUffCrM.js";import{I as ce}from"./ItemNotAvailableError-2pHx8UAr.js";import"./format-CJebrXOQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ue='<circle cx="12.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="0s" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="52.5" r="12.5" fill-opacity=".5"><animate attributeName="fill-opacity" begin="100ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="300ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="600ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="800ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="400ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="700ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="500ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="200ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle>',de=G({name:"QSpinnerGrid",props:j,setup(m){const{cSize:e,classes:t}=F(m);return()=>H("svg",{class:t.value,fill:"currentColor",width:e.value,height:e.value,viewBox:"0 0 105 105",xmlns:"http://www.w3.org/2000/svg",innerHTML:ue})}}),me='<g fill="none" fill-rule="evenodd" stroke-width="2"><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="0s" dur="1.8s" values="1; 20" calcMode="spline" keyTimes="0; 1" keySplines="0.165, 0.84, 0.44, 1" repeatCount="indefinite"></animate><animate attributeName="stroke-opacity" begin="0s" dur="1.8s" values="1; 0" calcMode="spline" keyTimes="0; 1" keySplines="0.3, 0.61, 0.355, 1" repeatCount="indefinite"></animate></circle><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="-0.9s" dur="1.8s" values="1; 20" calcMode="spline" keyTimes="0; 1" keySplines="0.165, 0.84, 0.44, 1" repeatCount="indefinite"></animate><animate attributeName="stroke-opacity" begin="-0.9s" dur="1.8s" values="1; 0" calcMode="spline" keyTimes="0; 1" keySplines="0.3, 0.61, 0.355, 1" repeatCount="indefinite"></animate></circle></g>',_e=G({name:"QSpinnerPuff",props:j,setup(m){const{cSize:e,classes:t}=F(m);return()=>H("svg",{class:t.value,stroke:"currentColor",width:e.value,height:e.value,viewBox:"0 0 44 44",xmlns:"http://www.w3.org/2000/svg",innerHTML:me})}}),ge={id:"countdown-timer-container",class:"flex flex-center",style:{width:"70vw",height:"70vh"}},pe=["innerHTML"],fe={style:{height:"100%"}},ve=$({__name:"CountdownTimer",props:{duration:{},messageDuration:{default:.5},messageText:{default:"ðŸ˜ƒ"}},setup(m){let e;const t=P(0),u=P(0),r=m,d=w(()=>t.value>0),c=w(()=>t.value>0),n=w(()=>t.value<=r.messageDuration);z(()=>{k()}),D(()=>{h()});const h=()=>{clearInterval(e),t.value=0},k=()=>{u.value=r.duration,t.value=u.value,console.log(`starting timer, duration=${u.value}`),e=window.setInterval(()=>{t.value-=.05,t.value<=0&&clearInterval(e)},50)};return(B,A)=>N((i(),v("div",ge,[N(g("div",{id:"countdown-timer-message",style:{position:"absolute","font-size":"150px"},innerHTML:m.messageText},null,8,pe),[[L,n.value]]),g("div",fe,[N(s(re,{id:"countdown-circular-progress","show-value":!n.value,style:{width:"100%",height:"100%","text-shadow":"#222 0 0 10px","font-weight":"bold",opacity:"85%"},value:t.value,min:0,max:u.value,reverse:"","animation-speed":"100","font-size":"0.5em",size:"70vh",color:"secondary",class:"text-secondary",thickness:.16},{default:f(()=>[V(C(parseFloat(t.value.toFixed(0))),1)]),_:1},8,["show-value","value","max"]),[[L,c.value]])])],512)),[[L,d.value]])}}),be={class:"row q-gutter-md action-buttons"},he=["src","alt","onClick"],ye={style:{"white-space":"nowrap"},class:"gt-sm"},we=$({__name:"FrontpageTriggerButtons",props:{triggers:{}},emits:["triggerAction"],setup(m,{emit:e}){console.log("Triggers:",m.triggers);const u=e;function r(d,c){u("triggerAction",d,c)}return(d,c)=>(i(),v("div",be,[(i(!0),v(W,null,U(m.triggers,(n,h)=>(i(),v("div",{key:h},[n.show_button&&n.image_path!=null&&n.image_path!==""?(i(),v("img",{key:0,src:n.image_path,alt:n.title||"Action button",class:"action-button-image",onClick:k=>r(n.action,n.config_index),style:{cursor:"pointer","max-width":"150px","max-height":"150px"}},null,8,he)):n.show_button&&(n.image_path==null||n.image_path==="")&&!(o(q.isEmpty)(n.title)&&o(q.isEmpty)(n.icon))?(i(),b(S,{key:1,stack:"",color:n.use_custom_color?"custom":"primary","no-caps":"",rounded:"",class:M(["action-button col-auto glass-effect",["action-button-"+h]]),style:K({"--bg-custom":n.use_custom_color?n.custom_color:null}),onClick:k=>r(n.action,n.config_index)},{default:f(()=>[o(q.isEmpty)(n.icon)?p("",!0):(i(),b(T,{key:0,name:`sym_o_${n.icon}`},null,8,["name"])),g("div",ye,C(n.title),1)]),_:2},1032,["color","class","style","onClick"])):p("",!0)]))),128))]))}}),ke={id:"preview-container",class:""},xe={id:"preview-outer-container",class:"preview-center-element"},Ce=["src"],Se=$({__name:"PreviewStream",props:{index_device:{},enableMirrorEffectStream:{type:Boolean},enableMirrorEffectFrame:{type:Boolean},enableBlurredBackgroundStream:{type:Boolean},blurredbackgroundHighFramerate:{type:Boolean},frameOverlayImage:{}},setup(m){const e=m;let t=null,u=null,r=null,d=null;const c=e.blurredbackgroundHighFramerate===!0?50:300,n=(a,l,_)=>{(a.width!=_.width||a.height!=_.height)&&(a.width=_.width,a.height=_.height),l.drawImage(_,0,0)},h=J((a,l,_)=>{n(a,l,_)},c),k=`${location.protocol==="https:"?"wss":"ws"}://${location.host}/api/aquisition/stream?index_device=${e.index_device}&index_subdevice=0`,{open:B,close:A}=X(k,{immediate:!1,autoReconnect:{retries:-1,delay:1e3},onConnected(){console.log("stream connected via websocket")},onDisconnected(){console.log("stream disconnected from websocket")},async onMessage(a,l){if(!document.hidden)if(t&&u||r&&d){const _=await createImageBitmap(new Blob([l.data],{type:"image/jpeg"}));t&&u&&n(t,u,_),r&&d&&h(r,d,_),_.close()}else console.error("jpeg bytes received but no canvas to draw to.")}}),E=w(()=>e.frameOverlayImage??!0);return z(()=>{console.log("preview stream mounted!");const a=document.getElementById("preview-inner-overlay");a&&(a.onload=function(){console.log(a.naturalWidth/a.naturalHeight);const l=document.getElementById("preview-inner-container");l.style.aspectRatio=Number(a.naturalWidth/a.naturalHeight).toFixed(4)}),t=document.getElementById("preview-inner-stream"),r=document.getElementById("preview-outer-blurred"),t&&(u=t.getContext("2d")),r&&(d=r.getContext("2d")),(t||r)&&B()}),Y(()=>{A(),t=null,u=null,r=null,d=null,console.log("preview stream unmounted!")}),(a,l)=>(i(),v("div",ke,[e.enableBlurredBackgroundStream?(i(),v("canvas",{key:0,id:"preview-outer-blurred",class:M(["preview-center-element",{mirroreffect:e.enableMirrorEffectStream}])},null,2)):p("",!0),g("div",xe,[g("div",{id:"preview-inner-container",class:M(["preview-center-element",{"stream-no-preview":!E.value}])},[g("canvas",{id:"preview-inner-stream",class:M(["preview-center-element",{mirroreffect:e.enableMirrorEffectStream,cover:E.value,contain:!E.value}])},null,2),N(g("img",{id:"preview-inner-overlay",class:M(["preview-center-element contain",{mirroreffect:e.enableMirrorEffectFrame}]),src:e.frameOverlayImage},null,10,Ce),[[L,E.value]])],2)])]))}}),Ee={id:"itemapproval-dialog",class:"absolute-full flex flex-center"},Me={class:"q-mb-lg action-buttons col"},Te={class:"q-mb-sm row flex flex-center"},Ie={class:"row"},$e=$({__name:"MediaItemApprovalViewer",props:{approval_id:{},number_captures_taken:{},total_captures_to_take:{}},setup(m){const e=P(!0);Z(()=>{e.value=!0});const t=()=>{I("/api/processing/confirm")},u=()=>{I("/api/processing/reject")},r=()=>{I("/api/processing/abort")};return(d,c)=>(i(),v("div",Ee,[e.value?(i(),b(se,{key:0,draggable:!1,loading:"eager",src:`/api/processing/approval/${m.approval_id}`,fit:"contain",style:{height:"95%"},onError:c[0]||(c[0]=n=>e.value=!1),"loading-show-delay":"800"},null,8,["src"])):(i(),b(ce,{key:1})),s(x,{position:"top-left",class:"q-ma-lg"},{default:f(()=>[s(S,{id:"layout-button-back",color:"grey",rounded:"","no-caps":"",onClick:c[1]||(c[1]=n=>r()),class:"action-button glass-effect"},{default:f(()=>[s(T,{left:"",name:"sym_o_cancel"}),g("div",null,C(d.$t("MSG_APPROVE_COLLAGE_ITEM_CANCEL_COLLAGE")),1)]),_:1})]),_:1}),s(x,{position:"bottom",class:"q-ma-lg"},{default:f(()=>[g("div",Me,[g("div",Te,[s(le,{color:"grey-8",class:"q-mr-xs"},{default:f(()=>[s(T,{name:"sym_o_tag",color:"white",class:"q-mr-xs"}),V(" "+C(d.$t("LABEL_ELEMENT_X_OF_Y",{no:m.number_captures_taken,total:m.total_captures_to_take})),1)]),_:1})]),g("div",Ie,[s(S,{id:"item-approval-button-reject",stack:"",rounded:"",class:"q-mr-lg action-button col-auto glass-effect",color:"negative","no-caps":"",icon:"sym_o_thumb_down",label:d.$t("MSG_APPROVE_COLLAGE_ITEM_RETRY"),onClick:c[2]||(c[2]=n=>u())},null,8,["label"]),s(S,{id:"item-approval-button-approve",stack:"",rounded:"",class:"q-mr-sm action-button col-auto glass-effect",color:"positive","no-caps":"",icon:"sym_o_thumb_up",label:d.$t("MSG_APPROVE_COLLAGE_ITEM_APPROVE"),onClick:c[3]||(c[3]=n=>t())},null,8,["label"])])])]),_:1})]))}}),Be={key:1,class:"full-height full-width column justify-center content-center",style:{position:"absolute"}},Ae={key:2,id:"frontpage-countdown",class:"full-height full-width column justify-center content-center",style:{position:"absolute"}},Ne=["innerHTML"],Le={key:4},Pe={key:0},Oe={key:0},Re={class:"q-gutter-md"},qe={class:"gt-sm"},Qe={key:0},Ge={class:"q-gutter-md"},je={class:"gt-sm"},Ye=$({__name:"IndexPage",setup(m){const e=ee(),t=te(),u=oe(),r=P(0);ne(r,()=>{r.value>=5&&u.push("/admin"),r.value=0},{debounce:500});const d=w(()=>{const a=[];return Object.entries(t.configuration.actions).forEach(([l,_])=>{_.forEach((y,O)=>{const R={action:`actions/${l}`,config_index:O,show_button:y.trigger.ui_trigger.show_button,title:y.trigger.ui_trigger.title,icon:y.trigger.ui_trigger.icon,use_custom_color:y.trigger.ui_trigger.use_custom_color,custom_color:y.trigger.ui_trigger.custom_color,image_path:y.trigger.ui_trigger.image_path};a.push(R)})}),a}),c=w(()=>t.configuration.uisettings.admin_button_invisible),n=w(()=>{const a=t.configuration.uisettings.enable_livestream_when_idle,l=t.configuration.uisettings.enable_livestream_when_active,_=e.isStateIdle,y=e.isStateRecording,O=e.isStateCountdown,R=e.isStateCapture;return _&&a||(O||R)&&l||y}),h=ae(n,500),k=w(()=>{const a=Q.get(e.jobmodel.configuration_set,"processing.img_frame_enable",!1),l=Q.get(e.jobmodel.configuration_set,"processing.img_frame_file","");return e.isStateCountdown&&a?l:e.isStateIdle&&t.configuration.uisettings.enable_livestream_frameoverlay?t.configuration.uisettings.livestream_frameoverlay_image:""}),B=()=>{c.value?r.value++:u.push("/admin")},A=(a,l)=>{I(`/api/${a}/${l}`)},E=()=>{I("/api/processing/next")};return(a,l)=>(i(),b(ie,{id:"index-page",class:"q-pa-none full-height"},{default:f(()=>[o(h)?(i(),b(Se,{key:0,index_device:o(t).configuration.backends.index_backend_video,"frame-overlay-image":k.value,"enable-blurred-background-stream":o(t).configuration.uisettings.livestream_blurredbackground,"enable-mirror-effect-stream":o(t).configuration.uisettings.livestream_mirror_effect,"enable-mirror-effect-frame":o(t).configuration.uisettings.livestream_frameoverlay_mirror_effect,"blurredbackground-high-framerate":o(t).configuration.uisettings.livestream_blurredbackground_high_framerate},null,8,["index_device","frame-overlay-image","enable-blurred-background-stream","enable-mirror-effect-stream","enable-mirror-effect-frame","blurredbackground-high-framerate"])):p("",!0),o(e).isStateProcessing?(i(),v("div",Be,[s(de,{size:"20em"})])):p("",!0),o(e).isStateCountdown?(i(),v("div",Ae,[s(ve,{ref:"countdowntimer",duration:o(e).jobmodel.duration,"message-duration":o(t).configuration.uisettings.TAKEPIC_MSG_TIME,"message-text":o(t).configuration.uisettings.TAKEPIC_MSG_TEXT},null,8,["duration","message-duration","message-text"])])):p("",!0),o(e).isStateIdle?(i(),v("div",{key:3,id:"frontpage_text",innerHTML:o(t).configuration.uisettings.FRONTPAGE_TEXT},null,8,Ne)):p("",!0),o(e).isStateApproval?(i(),v("div",Le,[s($e,{approval_id:o(e).jobmodel.approval_id,number_captures_taken:o(e).jobmodel.number_captures_taken,total_captures_to_take:o(e).jobmodel.total_captures_to_take},null,8,["approval_id","number_captures_taken","total_captures_to_take"])])):p("",!0),s(x,{position:"bottom",class:"q-mb-lg"},{default:f(()=>[o(e).isStateIdle?(i(),v("div",Pe,[s(we,{triggers:d.value,onTriggerAction:A},null,8,["triggers"])])):p("",!0)]),_:1}),s(x,{position:"top-left",class:"q-ma-lg"},{default:f(()=>[o(e).isStateIdle?(i(),v("div",Oe,[g("div",Re,[o(t).configuration.uisettings.show_gallery_on_frontpage?(i(),b(S,{key:0,id:"frontpage-button-to-gallery",color:"primary","no-caps":"",rounded:"",to:"/gallery",class:"action-button glass-effect"},{default:f(()=>[s(T,{left:"",name:"sym_o_photo_library"}),g("div",qe,C(a.$t("BTN_LABEL_MAINPAGE_TO_GALLERY")),1)]),_:1})):p("",!0)])])):p("",!0)]),_:1}),s(x,{position:"top-right",class:"q-ma-lg"},{default:f(()=>[o(e).isStateIdle?(i(),v("div",Qe,[g("div",Ge,[o(t).configuration.uisettings.show_admin_on_frontpage?(i(),b(S,{key:0,id:"frontpage-button-to-admin",rounded:"",color:"transparent","no-caps":"",class:M(["action-button action-button-admin glass-effect",{"action-button-admin-invisible":c.value}]),onClick:B},{default:f(()=>[s(T,{left:"",name:"sym_o_admin_panel_settings"}),g("div",je,C(a.$t("BTN_LABEL_MAINPAGE_TO_ADMIN")),1)]),_:1},8,["class"])):p("",!0)])])):p("",!0)]),_:1}),o(e).isStateRecording?(i(),b(x,{key:5,id:"frontpage-indicator-recording",position:"top-right",offset:[25,25],align:"center"},{default:f(()=>[s(_e,{color:"red",size:"12em",thickness:"20"})]),_:1})):p("",!0),o(e).isStateRecording?(i(),b(x,{key:6,id:"frontpage-indicator-stop-recording",position:"bottom",offset:[0,25],align:"center"},{default:f(()=>[s(S,{stack:"",rounded:"","no-caps":"",color:"negative",class:"action-button glass-effect",onClick:l[0]||(l[0]=_=>E())},{default:f(()=>[s(T,{name:"sym_o_stop_circle"}),g("div",null,C(a.$t("Stop recording")),1)]),_:1})]),_:1})):p("",!0)]),_:1}))}});export{Ye as default};
