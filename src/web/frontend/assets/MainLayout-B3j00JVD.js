import{Q as S,a as T}from"./QLayout-EFK10iyK.js";import{d as M,u as E,a as C,c as _,o as N,w as b,b as R,e as L,f as c,g as O,h as B,i as P,j as A,k as Q,l as U,m as q,n as p,p as w,r,q as v,s as h,t as H,v as a}from"./index-CaVX-GMa.js";import{_ as W}from"./ReturnButton.vue_vue_type_script_setup_true_lang-Dy6up-Ay.js";import"./QResizeObserver-B6kNhia0.js";import"./QPageSticky-D9sWT7uG.js";const $=M({__name:"RouteAfterTimeout",props:{timeoutMs:{type:Number,required:!0},warningMessage:{type:String,default:"The application has been idle for a long time. Click anywhere to stay on this page..."},warningTimeMs:{type:Number,default:1e4}},emits:["onTimeout"],setup(k,{emit:m}){const g=L(),i=k,{idle:n,lastActive:f}=E(i.timeoutMs),s=C({interval:1e3}),u=_(()=>i.timeoutMs-(s.value-f.value)),o=_(()=>i.warningTimeMs>u.value);let e=null;const t=m;function l(){e=g.notify({progress:!0,message:i.warningMessage,type:"info",multiLine:!0,timeout:u.value})}function y(){e&&e()}return N(()=>{y()}),b(o,d=>{d?l():y()}),b(n,d=>{d&&(y(),t("onTimeout"))}),(d,j)=>(c(),R("div"))}}),G=M({__name:"MainLayout",setup(k){const m=O(),g=Q(),i=A(),n=B(),f=P(),s=_(()=>i.matched.length>1&&i.matched[0].path!=i.matched[1].path);m.$subscribe((o,e)=>{document.hidden||(e.target=="counting"&&i.path!="/"&&(console.log("counting state received, pushing to index page to countdown"),g.push("/")),e.source=="completed"&&e.target=="present"&&g.push({name:"itempresenter",params:{id:m.jobmodel.present_mediaitem_id}}))});const u=o=>{if(!n.configuration.hardwareinputoutput.keyboard_input_enabled){console.log("keyboard input is disabled, to use keyboard input enable it in the configuration and reload the page.");return}n.configuration.actions.image.forEach((e,t)=>{if(e.trigger.keyboard_trigger.keycode==o.key){r(`/api/actions/image/${t}`);return}}),n.configuration.actions.collage.forEach((e,t)=>{if(e.trigger.keyboard_trigger.keycode==o.key){r(`/api/actions/collage/${t}`);return}}),n.configuration.actions.animation.forEach((e,t)=>{if(e.trigger.keyboard_trigger.keycode==o.key){r(`/api/actions/animation/${t}`);return}}),n.configuration.actions.video.forEach((e,t)=>{if(e.trigger.keyboard_trigger.keycode==o.key){r(`/api/actions/video/${t}`);return}}),n.configuration.actions.multicamera.forEach((e,t)=>{if(e.trigger.keyboard_trigger.keycode==o.key){r(`/api/actions/multicamera/${t}`);return}}),n.configuration.share.actions.forEach((e,t)=>{if(e.trigger.keyboard_trigger.keycode==o.key){r(`/api/share/actions/latest/${t}`,"POST");return}})};return U(()=>{console.log("register listener for keyboard input (active only on main layout)"),window.addEventListener("keyup",u)}),q(()=>{console.log("unregister listener for keyboard input"),window.removeEventListener("keyup",u)}),(o,e)=>{const t=H("router-view");return c(),p(S,{id:"main-layout",view:"hHh lpR fFf"},{default:w(()=>[v(T,null,{default:w(()=>[v(t),s.value?(c(),p(W,{key:0,onTriggerReturn:e[0]||(e[0]=l=>o.$router.back())})):h("",!0),s.value&&!a(i).meta.standbyMode?(c(),p($,{key:1,onOnTimeout:e[1]||(e[1]=l=>o.$router.push({path:a(i).matched[0].path})),"timeout-ms":a(n).configuration.uisettings.show_frontpage_timeout*60*1e3},null,8,["timeout-ms"])):h("",!0),!s.value&&!a(i).meta.standbyMode&&a(n).configuration.uisettings.enable_automatic_slideshow&&a(f).collection_number_of_items>0?(c(),p($,{key:2,onOnTimeout:e[2]||(e[2]=l=>o.$router.push({path:"/standby/slideshow/random"})),"timeout-ms":a(n).configuration.uisettings.show_automatic_slideshow_timeout*1e3,"warning-message":o.$t("MSG_WARN_BEFORE_AUTO_SLIDESHOW")},null,8,["timeout-ms","warning-message"])):h("",!0)]),_:1})]),_:1})}}});export{G as default};
