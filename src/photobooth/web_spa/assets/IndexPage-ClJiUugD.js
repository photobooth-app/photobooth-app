import{f as G,g as D,h as H,i as F,d as B,j as P,k as m,l as K,m as U,n as $,v as A,p as l,o as i,q as d,e as u,w as f,s as X,t as M,F as Y,x as J,c as v,y as r,z as c,A as I,Q as T,B as Z,C as Q,D as L,E as ee,u as te,G as ie,H as ne,b as ae,_ as O,I as z}from"./index-BhZkHft5.js";import{Q as S}from"./QPageSticky-CWyWD4Na.js";import{Q as oe}from"./QPage-Cp1FgTNZ.js";import{Q as se}from"./QCircularProgress-BkpbWoV8.js";import{_ as re}from"./RouteAfterTimeout.vue_vue_type_script_setup_true_lang-7a0imUhN.js";import"./format-CJebrXOQ.js";const ce='<circle cx="12.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="0s" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="52.5" r="12.5" fill-opacity=".5"><animate attributeName="fill-opacity" begin="100ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="300ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="600ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="800ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="400ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="700ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="500ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="200ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle>',le=G({name:"QSpinnerGrid",props:D,setup(g){const{cSize:n,classes:e}=H(g);return()=>F("svg",{class:e.value,fill:"currentColor",width:n.value,height:n.value,viewBox:"0 0 105 105",xmlns:"http://www.w3.org/2000/svg",innerHTML:ce})}}),ue='<g fill="none" fill-rule="evenodd" stroke-width="2"><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="0s" dur="1.8s" values="1; 20" calcMode="spline" keyTimes="0; 1" keySplines="0.165, 0.84, 0.44, 1" repeatCount="indefinite"></animate><animate attributeName="stroke-opacity" begin="0s" dur="1.8s" values="1; 0" calcMode="spline" keyTimes="0; 1" keySplines="0.3, 0.61, 0.355, 1" repeatCount="indefinite"></animate></circle><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="-0.9s" dur="1.8s" values="1; 20" calcMode="spline" keyTimes="0; 1" keySplines="0.165, 0.84, 0.44, 1" repeatCount="indefinite"></animate><animate attributeName="stroke-opacity" begin="-0.9s" dur="1.8s" values="1; 0" calcMode="spline" keyTimes="0; 1" keySplines="0.3, 0.61, 0.355, 1" repeatCount="indefinite"></animate></circle></g>',me=G({name:"QSpinnerPuff",props:D,setup(g){const{cSize:n,classes:e}=H(g);return()=>F("svg",{class:e.value,stroke:"currentColor",width:n.value,height:n.value,viewBox:"0 0 44 44",xmlns:"http://www.w3.org/2000/svg",innerHTML:ue})}}),de={id:"countdown-timer-container",class:"flex flex-center",style:{width:"70vw",height:"70vh"}},ge=["innerHTML"],_e={style:{height:"100%"}},pe=B({__name:"CountdownTimer",props:{duration:{},messageDuration:{default:.5},messageText:{default:"ðŸ˜ƒ"}},setup(g){let n;const e=P(0),t=P(0),_=g,p=m(()=>e.value>0),o=m(()=>e.value>0),y=m(()=>e.value<=_.messageDuration);K(()=>{k()}),U(()=>{w()});const w=()=>{clearInterval(n),e.value=0},k=()=>{t.value=_.duration,e.value=t.value,console.log(`starting timer, duration=${t.value}`),n=window.setInterval(()=>{e.value-=.05,e.value<=0&&clearInterval(n)},50)};return(b,q)=>$((i(),l("div",de,[$(d("div",{id:"countdown-timer-message",style:{position:"absolute","font-size":"150px"},innerHTML:b.messageText},null,8,ge),[[A,y.value]]),d("div",_e,[$(u(se,{"show-value":!y.value,style:{width:"100%",height:"100%"},value:e.value,min:0,max:t.value,reverse:"","animation-speed":"100","font-size":"0.5em",size:"70vh",color:"primary",class:"text-secondary"},{default:f(()=>[X(M(parseFloat(e.value.toFixed(0))),1)]),_:1},8,["show-value","value","max"]),[[A,o.value]])])],512)),[[A,p.value]])}}),fe={class:"row q-gutter-md action-buttons"},ve={style:{"white-space":"nowrap"},class:"gt-sm"},ye=B({__name:"FrontpageTriggerButtons",props:{triggers:{}},emits:["triggerAction"],setup(g,{emit:n}){const e=n;function t(_,p){e("triggerAction",_,p)}return(_,p)=>(i(),l("div",fe,[(i(!0),l(Y,null,J(_.triggers,(o,y)=>(i(),l("div",{key:y},[o.show_button&&!(c(I.isEmpty)(o.title)&&c(I.isEmpty)(o.icon))?(i(),v(T,{key:0,stack:"",color:o.use_custom_color?"custom":"primary","no-caps":"",rounded:"",class:Q(["action-button col-auto glass-effect",["action-button-"+y]]),style:Z({"--bg-custom":o.use_custom_color?o.custom_color:null}),onClick:w=>t(o.action,o.config_index)},{default:f(()=>[c(I.isEmpty)(o.icon)?r("",!0):(i(),v(L,{key:0,name:`sym_o_${o.icon}`},null,8,["name"])),d("div",ve,M(o.title),1)]),_:2},1032,["color","class","style","onClick"])):r("",!0)]))),128))]))}}),he={key:0,id:"preview-blurredback",style:{"background-image":"url('/api/aquisition/stream.mjpg')"}},be={key:1,id:"overlay-wrapper"},we=["src"],ke={key:2,id:"stream-wrapper"},Ce=B({__name:"PreviewStream",props:{enableMirrorEffect:{type:Boolean},enableBlurredBackgroundStream:{type:Boolean},frameOverlayImage:{}},setup(g){const n=g;return(e,t)=>(i(),l("div",{id:"preview-container",class:Q({mirroreffect:n.enableMirrorEffect})},[n.enableBlurredBackgroundStream?(i(),l("div",he)):r("",!0),n.frameOverlayImage??!0?(i(),l("div",be,[d("img",{id:"overlay-image",style:{"background-image":"url('/api/aquisition/stream.mjpg')"},src:n.frameOverlayImage},null,8,we)])):(i(),l("div",ke,t[0]||(t[0]=[d("img",{id:"stream-image",src:"/api/aquisition/stream.mjpg"},null,-1)])))],2))}}),xe={key:1,class:"full-height full-width column justify-center content-center",style:{position:"absolute"}},Se={key:2,id:"frontpage-countdown",class:"full-height full-width column justify-center content-center",style:{position:"absolute"}},Te=["innerHTML"],Me={key:0},Be={key:0},Ee={class:"q-gutter-md"},Ne={class:"gt-sm"},$e={key:0},Ae={class:"q-gutter-md"},Ie={class:"gt-sm"},Ge=B({__name:"IndexPage",setup(g){const n=ee(),e=te(),t=ie(),_=ae(),p=P(0);ne(p,()=>{p.value>=5&&_.push("/admin"),p.value=0},{debounce:500});const o=m(()=>{const a=[];return Object.entries(t.configuration.actions).forEach(([s,x])=>{x.forEach((h,E)=>{const N={action:`actions/${s}`,config_index:E,show_button:h.trigger.ui_trigger.show_button,title:h.trigger.ui_trigger.title,icon:h.trigger.ui_trigger.icon,use_custom_color:h.trigger.ui_trigger.use_custom_color,custom_color:h.trigger.ui_trigger.custom_color};a.push(N)})}),console.log(a),a}),y=m(()=>{const a=e.state=="capture";return e.state=="captures_completed"||a&&!b.value}),w=m(()=>e.state=="record"),k=m(()=>t.configuration.uisettings.admin_button_invisible),b=m(()=>{const a=e.state=="counting",s=e.state=="capture";return e.duration&&e.duration>0&&a||s}),q=m(()=>{if(b.value){const a=O.get(e.configuration_set,"processing.img_frame_enable",!1),s=O.get(e.configuration_set,"processing.img_frame_file","");return a?s:t.configuration.uisettings.livestream_frameoverlay_image}else return t.configuration.uisettings.enable_livestream_frameoverlay?t.configuration.uisettings.livestream_frameoverlay_image:""}),R=m(()=>{const a=t.configuration.uisettings.enable_livestream_when_idle,s=t.configuration.uisettings.enable_livestream_when_active,x=!e.state||e.state=="finished",h=e.state=="record",E=e.state=="counting",N=e.state=="capture";return x&&a||(E||N)&&s||h}),C=m(()=>!e.state||e.state=="finished"),j=()=>{k.value?p.value++:_.push("/admin")},V=(a,s)=>{z(`/api/${a}/${s}`)},W=()=>{z("/api/actions/stop")};return(a,s)=>(i(),v(oe,{id:"index-page",class:"q-pa-none column full-height"},{default:f(()=>[R.value?(i(),v(Ce,{key:0,"frame-overlay-image":q.value,"enable-blurred-background-stream":c(t).configuration.uisettings.livestream_blurredbackground,"enable-mirror-effect":c(t).configuration.uisettings.livestream_mirror_effect},null,8,["frame-overlay-image","enable-blurred-background-stream","enable-mirror-effect"])):r("",!0),y.value?(i(),l("div",xe,[u(le,{size:"20em"})])):r("",!0),b.value?(i(),l("div",Se,[u(pe,{ref:"countdowntimer",duration:c(e).duration,"message-duration":c(t).configuration.uisettings.TAKEPIC_MSG_TIME,"message-text":c(t).configuration.uisettings.TAKEPIC_MSG_TEXT},null,8,["duration","message-duration","message-text"])])):r("",!0),C.value?(i(),l("div",{key:3,id:"frontpage_text",innerHTML:c(t).configuration.uisettings.FRONTPAGE_TEXT},null,8,Te)):r("",!0),u(S,{position:"bottom",class:"q-mb-lg"},{default:f(()=>[C.value?(i(),l("div",Me,[u(ye,{triggers:o.value,onTriggerAction:V},null,8,["triggers"])])):r("",!0)]),_:1}),u(S,{position:"top-left",class:"q-ma-lg"},{default:f(()=>[C.value?(i(),l("div",Be,[d("div",Ee,[c(t).configuration.uisettings.show_gallery_on_frontpage?(i(),v(T,{key:0,id:"frontpage-button-to-gallery",color:"primary","no-caps":"",rounded:"",to:"/gallery",class:"action-button glass-effect"},{default:f(()=>[u(L,{left:"",name:"sym_o_photo_library"}),d("div",Ne,M(a.$t("BTN_LABEL_MAINPAGE_TO_GALLERY")),1)]),_:1})):r("",!0)])])):r("",!0)]),_:1}),u(S,{position:"top-right",class:"q-ma-lg"},{default:f(()=>[C.value?(i(),l("div",$e,[d("div",Ae,[c(t).configuration.uisettings.show_admin_on_frontpage?(i(),v(T,{key:0,id:"frontpage-button-to-admin",rounded:"",color:"transparent","no-caps":"",class:Q(["action-button action-button-admin glass-effect",{"action-button-admin-invisible":k.value}]),onClick:j},{default:f(()=>[u(L,{left:"",name:"sym_o_admin_panel_settings"}),d("div",Ie,M(a.$t("BTN_LABEL_MAINPAGE_TO_ADMIN")),1)]),_:1},8,["class"])):r("",!0)])])):r("",!0)]),_:1}),w.value?(i(),v(S,{key:4,id:"frontpage-indicator-recording",position:"top",offset:[0,25],align:"center"},{default:f(()=>[u(me,{color:"red",size:"10em"}),s[1]||(s[1]=d("br",null,null,-1)),u(T,{flat:"",color:"red",label:"Stop recording",onClick:s[0]||(s[0]=x=>W())})]),_:1})):r("",!0),c(t).configuration.uisettings.enable_automatic_slideshow&&c(n).collection_number_of_items>0?(i(),v(re,{key:5,route:"/slideshow/random","timeout-ms":c(t).configuration.uisettings.show_automatic_slideshow_timeout*1e3,"warning-message":a.$t("MSG_WARN_BEFORE_AUTO_SLIDESHOW")},null,8,["timeout-ms","warning-message"])):r("",!0)]),_:1}))}});export{Ge as default};
